/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { MimeTypeMasterData } from './../../pipes-module/mime-type';
import { Component, Input, EventEmitter, Output } from '@angular/core';
import { COMMON_CONSUMPTION_CONSTANTS } from '../../common-consumption.constants';
import { PlatformType, TocCardType } from '../models';
var TocCardComponent = /** @class */ (function () {
    function TocCardComponent() {
        this.type = TocCardType.TEXTBOOK;
        this.contentStatus = [];
        this.trackableDefaultImage = '';
        this.platform = PlatformType.MOBILE;
        this.tocCardClick = new EventEmitter();
        this.playButtonClick = new EventEmitter();
        this.scoreLabel = '';
        this.disabled = '';
        this.fallbackImg = COMMON_CONSUMPTION_CONSTANTS.TOC_CARD_FALLBACK_IMG;
        this.isContentStarted = false;
        this.isCourseCompleted = false;
        this.isLastAttempt = false;
        this.isDisabled = false;
    }
    Object.defineProperty(TocCardComponent.prototype, "TocCardType", {
        get: /**
         * @return {?}
         */
        function () { return TocCardType; },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    TocCardComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.type === TocCardType.COURSE) {
            this.createIconMap();
        }
        this.getBestScore();
        setTimeout((/**
         * @return {?}
         */
        function () {
            if (_this.activeContent && _this.activeContent.sbUniqueIdentifier === _this.content.sbUniqueIdentifier) {
                _this.tocCardClick.emit({ event: {}, data: tslib_1.__assign({}, _this.content) });
            }
        }));
        if (!this.playBtnConfig) {
            this.playBtnConfig = {
                label: 'Play',
                show: false
            };
        }
        if (!this.platform) {
            this.platform = PlatformType.MOBILE;
        }
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    TocCardComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (changes && changes.contentStatus) {
            if (this.type === TocCardType.COURSE) {
                this.createIconMap();
            }
            this.getBestScore();
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    TocCardComponent.prototype.onTocCardClick = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            return tslib_1.__generator(this, function (_a) {
                if (this.isLastAttempt) {
                    event.isLastAttempt = true;
                    this.tocCardClick.emit({ event: event, data: tslib_1.__assign({}, this.content) });
                }
                else if (this.isDisabled) {
                    event.isDisabled = true;
                    this.tocCardClick.emit({ event: event, data: tslib_1.__assign({}, this.content) });
                }
                else if (this.activeContent && this.activeContent.sbUniqueIdentifier !== this.content.sbUniqueIdentifier) {
                    this.tocCardClick.emit({ event: event, data: tslib_1.__assign({}, this.content) });
                }
                else if (this.type = TocCardType.COURSE) {
                    this.tocCardClick.emit({ event: event, data: tslib_1.__assign({}, this.content) });
                }
                return [2 /*return*/];
            });
        });
    };
    /**
     * @return {?}
     */
    TocCardComponent.prototype.createIconMap = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var mimeTypesData = MimeTypeMasterData;
        this.isCourseCompleted = this.contentStatus.find((/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            if (item.contentId === _this.content.identifier && item.status === 2) {
                return true;
            }
        }));
        this.isContentStarted = !!(this.contentStatus.find((/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            if (item.contentId === _this.content.identifier && item.status === 1) {
                return true;
            }
        })));
        if (this.isCourseCompleted) {
            this.content.appIcon = 'assets/common-consumption/images/sprite.svg#circle-with-check-symbol';
        }
        else {
            this.iconPathMap = [
                [mimeTypesData.COLLECTION, 'assets/common-consumption/images/sprite.svg#doc'],
                [mimeTypesData.VIDEO, 'assets/common-consumption/images/sprite.svg#play'],
                [mimeTypesData.AUDIO, 'assets/common-consumption/images/sprite.svg#play'],
                [mimeTypesData.INTERACTIVE, 'assets/common-consumption/images/sprite.svg#touch'],
                [mimeTypesData.DOCS, 'assets/common-consumption/images/sprite.svg#doc'],
            ];
            this.content.appIcon = this.getIconPath(this.content.mimeType);
        }
    };
    /**
     * @return {?}
     */
    TocCardComponent.prototype.getBestScore = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.contentStatus.forEach((/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            if (item.contentId === _this.content.identifier && item.bestScore && _this.scoreLabel && _this.maxAttempts) {
                _this.bestScoreLabel = _this.scoreLabel + ' ' + (Math.round(item.bestScore.totalScore * 100) / 100).toString() + '/' + item.bestScore.totalMaxScore.toString();
                if (_this.maxAttempts - item.score.length === 1) {
                    _this.isLastAttempt = true;
                    _this.isDisabled = false;
                }
                if (item.score.length >= _this.maxAttempts) {
                    _this.isDisabled = true;
                    _this.isLastAttempt = false;
                }
            }
        }));
    };
    /**
     * @param {?} contentMimeType
     * @return {?}
     */
    TocCardComponent.prototype.getIconPath = /**
     * @param {?} contentMimeType
     * @return {?}
     */
    function (contentMimeType) {
        var e_1, _a;
        try {
            for (var _b = tslib_1.__values(this.iconPathMap), _c = _b.next(); !_c.done; _c = _b.next()) {
                var _d = tslib_1.__read(_c.value, 2), key = _d[0], value = _d[1];
                if (key.indexOf(contentMimeType) >= 0) {
                    return value;
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
        return '';
    };
    /**
     * @param {?} event
     * @return {?}
     */
    TocCardComponent.prototype.onPlayButtonClick = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.playButtonClick.emit({ event: event, data: tslib_1.__assign({}, this.content) });
    };
    /**
     * @param {?} content
     * @return {?}
     */
    TocCardComponent.prototype.swapCard = /**
     * @param {?} content
     * @return {?}
     */
    function (content) {
        if (this.platform === PlatformType.MOBILE) {
            return false;
        }
        if (this.isTrackable(content)) {
            return false;
        }
        return true;
    };
    /**
     * @param {?} content
     * @return {?}
     */
    TocCardComponent.prototype.isTrackable = /**
     * @param {?} content
     * @return {?}
     */
    function (content) {
        if ((content.contentData && content.contentData.trackable && content.contentData.trackable.enabled === 'Yes') ||
            (content.trackable && content.trackable.enabled === 'Yes')) {
            return true;
        }
        return false;
    };
    /**
     * @param {?} content
     * @return {?}
     */
    TocCardComponent.prototype.getContentImage = /**
     * @param {?} content
     * @return {?}
     */
    function (content) {
        if (this.isTrackable(content) && this.trackableDefaultImage) {
            return this.trackableDefaultImage;
        }
        return content.appIcon || (content.contentData && content.contentData.appIcon);
    };
    TocCardComponent.decorators = [
        { type: Component, args: [{
                    selector: 'sb-toc-card',
                    template: "<!-- For card type textbook -->\r\n<div *ngIf=\"type === TocCardType.TEXTBOOK\">\r\n  <div class=\"sbchapter__item\" (click)=\"onTocCardClick($event)\"\r\n    [ngClass]=\"{'sbchapter__item--active': activeContent?.sbUniqueIdentifier === content?.sbUniqueIdentifier}\">\r\n    <h4 class=\"sbchapter__item__title sbchapter__item__title text-left sb__ellipsis sb__ellipsis--two mr-8\" title=\"{{content?.name}}\">\r\n      {{content?.name}}\r\n    </h4>\r\n    <div class=\"sbchapter__img\"><img [src]=\"content?.appIcon || fallbackImg\" (error)=\"img.src = fallbackImg\" alt=\"\"\r\n        #img />\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<!-- For card type TRACKABLE -->\r\n<div *ngIf=\"type === TocCardType.TRACKABLE\">\r\n  <div class=\"sbchapter__item\" [ngClass]=\"{'sb-card-swap': swapCard(content)}\" (click)=\"onTocCardClick($event)\"\r\n    [ngClass]=\"{'sbchapter__item--active': activeContent?.sbUniqueIdentifier === content?.sbUniqueIdentifier}\">\r\n    <div class=\"relative\">\r\n      <img src=\"assets/common-consumption/images/completed.svg\" *ngIf=\"content?.isAvailableLocally\" class=\"sb_success_check\" alt=\"\">\r\n      <div class=\"sbchapter__img\">\r\n        <img [src]=\"getContentImage(content) || fallbackImg\" alt=\"\" #img />\r\n      </div>\r\n    </div>\r\n    <div class=\"arrange-card-items certificate-course-contentt pl-8\">\r\n      <h4 class=\"sbchapter__item__title text-left sb__ellipsis sb__ellipsis--two mr-8 ml-8\" title=\"{{content?.name}}\">\r\n        {{content?.name}}\r\n      </h4>\r\n      <h4 *ngIf=\"bestScoreLabel\" class=\"sbchapter__item__score pr-8 ml-auto\" title=\"{{bestScoreLabel}}\">\r\n        {{bestScoreLabel}}\r\n      </h4>\r\n    </div>\r\n    <button class=\"sbchapter__play__btn\" *ngIf=\"!isTrackable(content) && playBtnConfig.show\"\r\n      (click)=\"$event.stopImmediatePropagation(); $event.preventDefault(); onPlayButtonClick($event)\">\r\n      <svg class=\"icon icon-svg--primary\">\r\n        <use xlink:href=\"assets/common-consumption/images/sprite.svg#play\"></use>\r\n      </svg>\r\n      {{playBtnConfig.label}}\r\n    </button>\r\n  </div>\r\n</div>\r\n\r\n<!-- For card type course -->\r\n<div *ngIf=\"type === TocCardType.COURSE\">\r\n  <div class=\"sbchapter__item\"  (click)=\"onTocCardClick($event)\"\r\n  [ngClass]=\"[(activeContent?.sbUniqueIdentifier === content?.sbUniqueIdentifier) ? 'sbchapter__item--active': '', isDisabled ? disabled: '']\">\r\n  <div class=\"sbchapter__img background-transparent\" [ngClass]=\"{'sbchapter__img--inprogress':isContentStarted}\">\r\n    {{createIconMap()}}\r\n    <i class=\"icon-svg icon-svg--sm\" *ngIf=\"content?.appIcon\">\r\n      <svg class=\"icon icon-svg--primary\">\r\n        <use [attr.xlink:href]=\"content?.appIcon\"></use>\r\n      </svg>\r\n    </i>\r\n    <img [src]=\"fallbackImg\" *ngIf=\"!content?.appIcon\" alt=\"\" #img />\r\n  </div>\r\n  <div class=\"certificate-course-content pl-8\">\r\n    <div class=\"sbchapter__item__title text-left sb__ellipsis sb__ellipsis--two mr-8 pt-4\" title=\"{{content?.name}}\">\r\n      {{content?.name}}\r\n    </div>\r\n      <div *ngIf=\"bestScoreLabel\" class=\"sbchapter__item__score pr-8 ml-auto\" title=\"{{bestScoreLabel}}\">\r\n        {{bestScoreLabel}}\r\n      </div>\r\n  </div>\r\n  </div>\r\n</div>\r\n\r\n<!-- For card type NON TRACKABLE -->\r\n<div *ngIf=\"type === TocCardType.NON_TRACKABLE\">\r\n  <div class=\"sbchapter__item\"  (click)=\"onTocCardClick($event)\"\r\n    [ngClass]=\"[(activeContent?.sbUniqueIdentifier === content?.sbUniqueIdentifier) ? 'sbchapter__item--active': '', isDisabled ? disabled: '']\">\r\n    <div class=\"sbchapter__img background-transparent\" [ngClass]=\"{'sbchapter__img--inprogress':isContentStarted}\">\r\n      {{createIconMap()}}\r\n      <i class=\"icon-svg icon-svg--sm\" *ngIf=\"content?.appIcon\">\r\n        <svg class=\"icon icon-svg--primary\">\r\n          <use [attr.xlink:href]=\"content?.appIcon\"></use>\r\n        </svg>\r\n      </i>\r\n      <img [src]=\"fallbackImg\" *ngIf=\"!content?.appIcon\" alt=\"\" #img />\r\n    </div>\r\n    <div class=\"certificate-course-content pl-8\">\r\n      <div class=\"sbchapter__item__title text-left sb__ellipsis sb__ellipsis--two mr-8 pt-4\" title=\"{{content?.name}}\">\r\n        {{content?.name}}\r\n      </div>\r\n      <div *ngIf=\"bestScoreLabel\" class=\"sbchapter__item__score pr-8 ml-auto\" title=\"{{bestScoreLabel}}\">\r\n        {{bestScoreLabel}}\r\n      </div> \r\n    </div>\r\n    <button class=\"sbchapter__play__btn\" *ngIf=\"!(content?.contentData?.trackable?.enabled === 'Yes') && playBtnConfig.show\" \r\n      (click)=\"$event.stopImmediatePropagation(); $event.preventDefault(); onPlayButtonClick($event)\">\r\n      <svg class=\"icon icon-svg--primary\">\r\n        <use xlink:href=\"assets/common-consumption/images/sprite.svg#play\"></use>\r\n      </svg>\r\n      {{playBtnConfig.label}}\r\n    </button>\r\n  </div>\r\n</div>",
                    styles: [".sbchapter__item{background:var(--white);border:.0625rem solid var(--primary-300);box-shadow:0 .1875rem .25rem 0 rgba(var(--rc-rgba-primary),.1);display:flex;align-items:center;margin-bottom:.5rem;padding:.5rem;cursor:pointer;min-height:3.5rem;transition:.2s ease-in}.sbchapter__item .sbchapter__img{width:1.5rem;height:1.5rem;flex:0 0 1.5rem;display:flex;align-items:center;background:var(--rc-dddddd)}.sbchapter__item .sbchapter__img img{width:100%;max-height:100%;-o-object-fit:cover;object-fit:cover}.sbchapter__item .sbchapter__img .icon-svg svg.icon.icon-svg--primary{fill:#9cb9ff}.sbchapter__item .sbchapter__img--inprogress .icon-svg svg.icon.icon-svg--primary{fill:var(--primary-color)}.sbchapter__item--active,.sbchapter__item--active:hover,.sbchapter__item:hover{background:var(--primary-100)}.sbchapter__item--active .sbchapter__item__title{font-weight:700}.sbchapter__item__title{font-size:.75rem;line-height:1.25rem;color:var(--primary-400);margin:0 2rem 0 0;padding:0;font-weight:400}.sbchapter__item__score{text-transform:uppercase;color:#3f19c3;font-size:.6875rem;text-align:right;white-space:nowrap}.certificate-course-content{display:flex;align-items:center;width:100%}@media (max-width:767px){.sbchapter__item__title{margin-right:0;margin-bottom:.5rem}.sbchapter__item__score{text-align:left}.certificate-course-content{display:block}}.pl-8{padding-left:.5rem}.background-transparent{background:0 0!important}.sbchapter__play__btn{border:.0625rem solid var(--primary-color);border-radius:1rem;color:var(--primary-color);background-color:var(--white);padding:.25rem}.sbchapter__play__btn svg{height:1rem;width:1rem;vertical-align:middle}.sb-card-swap{flex-direction:row-reverse}.sb-card-swap .arrange-card-items{display:contents}.sb_success_check{position:absolute;top:-.3rem;right:-.3rem}.pr-8{padding-right:.5rem}.ml-auto{margin-left:auto}"]
                }] }
    ];
    TocCardComponent.propDecorators = {
        content: [{ type: Input }],
        activeContent: [{ type: Input }],
        type: [{ type: Input }],
        contentStatus: [{ type: Input }],
        refresh: [{ type: Input }],
        playBtnConfig: [{ type: Input }],
        trackableDefaultImage: [{ type: Input }],
        platform: [{ type: Input }],
        tocCardClick: [{ type: Output }],
        playButtonClick: [{ type: Output }],
        scoreLabel: [{ type: Input }],
        maxAttempts: [{ type: Input }],
        disabled: [{ type: Input }]
    };
    return TocCardComponent;
}());
export { TocCardComponent };
if (false) {
    /** @type {?} */
    TocCardComponent.prototype.content;
    /** @type {?} */
    TocCardComponent.prototype.activeContent;
    /** @type {?} */
    TocCardComponent.prototype.type;
    /** @type {?} */
    TocCardComponent.prototype.contentStatus;
    /** @type {?} */
    TocCardComponent.prototype.refresh;
    /** @type {?} */
    TocCardComponent.prototype.playBtnConfig;
    /** @type {?} */
    TocCardComponent.prototype.trackableDefaultImage;
    /** @type {?} */
    TocCardComponent.prototype.platform;
    /** @type {?} */
    TocCardComponent.prototype.tocCardClick;
    /** @type {?} */
    TocCardComponent.prototype.playButtonClick;
    /** @type {?} */
    TocCardComponent.prototype.scoreLabel;
    /** @type {?} */
    TocCardComponent.prototype.maxAttempts;
    /** @type {?} */
    TocCardComponent.prototype.disabled;
    /** @type {?} */
    TocCardComponent.prototype.fallbackImg;
    /** @type {?} */
    TocCardComponent.prototype.iconPathMap;
    /** @type {?} */
    TocCardComponent.prototype.isContentStarted;
    /** @type {?} */
    TocCardComponent.prototype.isCourseCompleted;
    /** @type {?} */
    TocCardComponent.prototype.bestScoreLabel;
    /** @type {?} */
    TocCardComponent.prototype.isLastAttempt;
    /** @type {?} */
    TocCardComponent.prototype.isDisabled;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9jLWNhcmQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHByb2plY3Qtc3VuYmlyZC9jb21tb24tY29uc3VtcHRpb24tdjgvIiwic291cmNlcyI6WyJsaWIvY2FyZC90b2MtY2FyZC90b2MtY2FyZC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUNwRSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUEwRCxNQUFNLGVBQWUsQ0FBQztBQUN2SSxPQUFPLEVBQUUsNEJBQTRCLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUNsRixPQUFPLEVBQWlCLFlBQVksRUFBRSxXQUFXLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFFckU7SUFBQTtRQVFXLFNBQUksR0FBZ0IsV0FBVyxDQUFDLFFBQVEsQ0FBQztRQUN6QyxrQkFBYSxHQUFHLEVBQUUsQ0FBQztRQUduQiwwQkFBcUIsR0FBRyxFQUFFLENBQUM7UUFDM0IsYUFBUSxHQUFHLFlBQVksQ0FBQyxNQUFNLENBQUM7UUFDOUIsaUJBQVksR0FBc0IsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUNyRCxvQkFBZSxHQUFzQixJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ3pELGVBQVUsR0FBRyxFQUFFLENBQUM7UUFFaEIsYUFBUSxHQUFHLEVBQUUsQ0FBQztRQUV2QixnQkFBVyxHQUFHLDRCQUE0QixDQUFDLHFCQUFxQixDQUFDO1FBRWpFLHFCQUFnQixHQUFJLEtBQUssQ0FBQztRQUMxQixzQkFBaUIsR0FBRyxLQUFLLENBQUM7UUFFMUIsa0JBQWEsR0FBWSxLQUFLLENBQUM7UUFDL0IsZUFBVSxHQUFZLEtBQUssQ0FBQztJQWdJOUIsQ0FBQztJQS9IQyxzQkFBSSx5Q0FBVzs7OztRQUFmLGNBQW9CLE9BQU8sV0FBVyxDQUFDLENBQUMsQ0FBQzs7O09BQUE7Ozs7SUFFekMs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ekM7OzswQkFFRSxLQUFLO2dDQUNMLEtBQUs7dUJBQ0wsS0FBSztnQ0FDTCxLQUFLOzBCQUNMLEtBQUs7Z0NBQ0wsS0FBSzt3Q0FDTCxLQUFLOzJCQUNMLEtBQUs7K0JBQ0wsTUFBTTtrQ0FDTixNQUFNOzZCQUNOLEtBQUs7OEJBQ0wsS0FBSzsyQkFDTCxLQUFLOztJQXdJUix1QkFBQztDQUFBLEFBMUpELElBMEpDO1NBckpZLGdCQUFnQjs7O0lBQzNCLG1DQUFpQjs7SUFDakIseUNBQXVCOztJQUN2QixnQ0FBa0Q7O0lBQ2xELHlDQUE0Qjs7SUFDNUIsbUNBQTBCOztJQUMxQix5Q0FBc0M7O0lBQ3RDLGlEQUFvQzs7SUFDcEMsb0NBQXdDOztJQUN4Qyx3Q0FBK0Q7O0lBQy9ELDJDQUFrRTs7SUFDbEUsc0NBQXlCOztJQUN6Qix1Q0FBcUI7O0lBQ3JCLG9DQUF1Qjs7SUFFdkIsdUNBQWlFOztJQUNqRSx1Q0FBaUI7O0lBQ2pCLDRDQUEwQjs7SUFDMUIsNkNBQTBCOztJQUMxQiwwQ0FBdUI7O0lBQ3ZCLHlDQUErQjs7SUFDL0Isc0NBQTRCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTWltZVR5cGVNYXN0ZXJEYXRhIH0gZnJvbSAnLi8uLi8uLi9waXBlcy1tb2R1bGUvbWltZS10eXBlJztcclxuaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBFdmVudEVtaXR0ZXIsIE91dHB1dCwgUXVlcnlMaXN0LCBWaWV3Q2hpbGQsIEVsZW1lbnRSZWYsIFJlbmRlcmVyMiwgT25DaGFuZ2VzIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IENPTU1PTl9DT05TVU1QVElPTl9DT05TVEFOVFMgfSBmcm9tICcuLi8uLi9jb21tb24tY29uc3VtcHRpb24uY29uc3RhbnRzJztcclxuaW1wb3J0IHsgSUJ1dHRvbkNvbmZpZywgUGxhdGZvcm1UeXBlLCBUb2NDYXJkVHlwZSB9IGZyb20gJy4uL21vZGVscyc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ3NiLXRvYy1jYXJkJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vdG9jLWNhcmQuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL3RvYy1jYXJkLmNvbXBvbmVudC5zY3NzJ11cclxufSlcclxuZXhwb3J0IGNsYXNzIFRvY0NhcmRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XHJcbiAgQElucHV0KCkgY29udGVudDtcclxuICBASW5wdXQoKSBhY3RpdmVDb250ZW50O1xyXG4gIEBJbnB1dCgpIHR5cGU6IFRvY0NhcmRUeXBlID0gVG9jQ2FyZFR5cGUuVEVYVEJPT0s7XHJcbiAgQElucHV0KCkgY29udGVudFN0YXR1cyA9IFtdO1xyXG4gIEBJbnB1dCgpIHJlZnJlc2g6IGJvb2xlYW47XHJcbiAgQElucHV0KCkgcGxheUJ0bkNvbmZpZzogSUJ1dHRvbkNvbmZpZztcclxuICBASW5wdXQoKSB0cmFja2FibGVEZWZhdWx0SW1hZ2UgPSAnJztcclxuICBASW5wdXQoKSBwbGF0Zm9ybSA9IFBsYXRmb3JtVHlwZS5NT0JJTEU7XHJcbiAgQE91dHB1dCgpIHRvY0NhcmRDbGljazogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgQE91dHB1dCgpIHBsYXlCdXR0b25DbGljazogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgQElucHV0KCkgc2NvcmVMYWJlbCA9ICcnO1xyXG4gIEBJbnB1dCgpIG1heEF0dGVtcHRzO1xyXG4gIEBJbnB1dCgpIGRpc2FibGVkID0gJyc7XHJcblxyXG4gIGZhbGxiYWNrSW1nID0gQ09NTU9OX0NPTlNVTVBUSU9OX0NPTlNUQU5UUy5UT0NfQ0FSRF9GQUxMQkFDS19JTUc7XHJcbiAgaWNvblBhdGhNYXA6IGFueTtcclxuICBpc0NvbnRlbnRTdGFydGVkICA9IGZhbHNlO1xyXG4gIGlzQ291cnNlQ29tcGxldGVkID0gZmFsc2U7XHJcbiAgYmVzdFNjb3JlTGFiZWw6IHN0cmluZztcclxuICBpc0xhc3RBdHRlbXB0OiBib29sZWFuID0gZmFsc2U7XHJcbiAgaXNEaXNhYmxlZDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gIGdldCBUb2NDYXJkVHlwZSgpIHsgcmV0dXJuIFRvY0NhcmRUeXBlOyB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgaWYgKHRoaXMudHlwZSA9PT0gVG9jQ2FyZFR5cGUuQ09VUlNFKSB7XHJcbiAgICAgIHRoaXMuY3JlYXRlSWNvbk1hcCgpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5nZXRCZXN0U2NvcmUoKTtcclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICBpZiAodGhpcy5hY3RpdmVDb250ZW50ICYmIHRoaXMuYWN0aXZlQ29udGVudC5zYlVuaXF1ZUlkZW50aWZpZXIgPT09IHRoaXMuY29udGVudC5zYlVuaXF1ZUlkZW50aWZpZXIpIHtcclxuICAgICAgICB0aGlzLnRvY0NhcmRDbGljay5lbWl0KHsgZXZlbnQ6IHt9LCBkYXRhOiB7IC4uLnRoaXMuY29udGVudCB9IH0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIGlmICghdGhpcy5wbGF5QnRuQ29uZmlnKSB7XHJcbiAgICAgIHRoaXMucGxheUJ0bkNvbmZpZyA9IHtcclxuICAgICAgICBsYWJlbDogJ1BsYXknLFxyXG4gICAgICAgIHNob3c6IGZhbHNlXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIXRoaXMucGxhdGZvcm0pIHtcclxuICAgICAgdGhpcy5wbGF0Zm9ybSA9IFBsYXRmb3JtVHlwZS5NT0JJTEU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzKSB7XHJcbiAgICBpZiAoY2hhbmdlcyAmJiBjaGFuZ2VzLmNvbnRlbnRTdGF0dXMpIHtcclxuICAgICAgaWYgKHRoaXMudHlwZSA9PT0gVG9jQ2FyZFR5cGUuQ09VUlNFKSB7XHJcbiAgICAgICAgdGhpcy5jcmVhdGVJY29uTWFwKCk7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5nZXRCZXN0U2NvcmUoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBhc3luYyBvblRvY0NhcmRDbGljayhldmVudCkge1xyXG4gICAgaWYgKHRoaXMuaXNMYXN0QXR0ZW1wdCkge1xyXG4gICAgICBldmVudC5pc0xhc3RBdHRlbXB0ID0gdHJ1ZTtcclxuICAgICAgdGhpcy50b2NDYXJkQ2xpY2suZW1pdCh7IGV2ZW50OiBldmVudCwgZGF0YTogeyAuLi50aGlzLmNvbnRlbnQgfSB9KTtcclxuICAgIH0gZWxzZSBpZiAodGhpcy5pc0Rpc2FibGVkKSB7XHJcbiAgICAgIGV2ZW50LmlzRGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgICB0aGlzLnRvY0NhcmRDbGljay5lbWl0KHsgZXZlbnQ6IGV2ZW50LCBkYXRhOiB7IC4uLnRoaXMuY29udGVudCB9IH0pO1xyXG4gICAgfSBlbHNlIGlmICh0aGlzLmFjdGl2ZUNvbnRlbnQgJiYgdGhpcy5hY3RpdmVDb250ZW50LnNiVW5pcXVlSWRlbnRpZmllciAhPT0gdGhpcy5jb250ZW50LnNiVW5pcXVlSWRlbnRpZmllcikge1xyXG4gICAgICB0aGlzLnRvY0NhcmRDbGljay5lbWl0KHsgZXZlbnQ6IGV2ZW50LCBkYXRhOiB7IC4uLnRoaXMuY29udGVudCB9IH0pO1xyXG4gICAgfSBlbHNlIGlmICh0aGlzLnR5cGUgPSBUb2NDYXJkVHlwZS5DT1VSU0UpIHtcclxuICAgICAgdGhpcy50b2NDYXJkQ2xpY2suZW1pdCh7IGV2ZW50OiBldmVudCwgZGF0YTogeyAuLi50aGlzLmNvbnRlbnQgfSB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNyZWF0ZUljb25NYXAoKSB7XHJcbiAgICBjb25zdCBtaW1lVHlwZXNEYXRhID0gTWltZVR5cGVNYXN0ZXJEYXRhO1xyXG4gICAgdGhpcy5pc0NvdXJzZUNvbXBsZXRlZCA9IHRoaXMuY29udGVudFN0YXR1cy5maW5kKChpdGVtKSA9PiB7XHJcbiAgICAgIGlmIChpdGVtLmNvbnRlbnRJZCA9PT0gdGhpcy5jb250ZW50LmlkZW50aWZpZXIgJiYgaXRlbS5zdGF0dXMgPT09IDIpIHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5pc0NvbnRlbnRTdGFydGVkID0gISEodGhpcy5jb250ZW50U3RhdHVzLmZpbmQoKGl0ZW0pID0+IHtcclxuICAgICAgaWYgKGl0ZW0uY29udGVudElkID09PSB0aGlzLmNvbnRlbnQuaWRlbnRpZmllciAmJiBpdGVtLnN0YXR1cyA9PT0gMSkge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9KSk7XHJcblxyXG4gICAgaWYgKHRoaXMuaXNDb3Vyc2VDb21wbGV0ZWQpIHtcclxuICAgICAgdGhpcy5jb250ZW50LmFwcEljb24gPSAnYXNzZXRzL2NvbW1vbi1jb25zdW1wdGlvbi9pbWFnZXMvc3ByaXRlLnN2ZyNjaXJjbGUtd2l0aC1jaGVjay1zeW1ib2wnO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5pY29uUGF0aE1hcCA9IFtcclxuICAgICAgICBbbWltZVR5cGVzRGF0YS5DT0xMRUNUSU9OLCAnYXNzZXRzL2NvbW1vbi1jb25zdW1wdGlvbi9pbWFnZXMvc3ByaXRlLnN2ZyNkb2MnXSxcclxuICAgICAgICBbbWltZVR5cGVzRGF0YS5WSURFTywgJ2Fzc2V0cy9jb21tb24tY29uc3VtcHRpb24vaW1hZ2VzL3Nwcml0ZS5zdmcjcGxheSddLFxyXG4gICAgICAgIFttaW1lVHlwZXNEYXRhLkFVRElPLCAnYXNzZXRzL2NvbW1vbi1jb25zdW1wdGlvbi9pbWFnZXMvc3ByaXRlLnN2ZyNwbGF5J10sXHJcbiAgICAgICAgW21pbWVUeXBlc0RhdGEuSU5URVJBQ1RJVkUsICdhc3NldHMvY29tbW9uLWNvbnN1bXB0aW9uL2ltYWdlcy9zcHJpdGUuc3ZnI3RvdWNoJ10sXHJcbiAgICAgICAgW21pbWVUeXBlc0RhdGEuRE9DUywgJ2Fzc2V0cy9jb21tb24tY29uc3VtcHRpb24vaW1hZ2VzL3Nwcml0ZS5zdmcjZG9jJ10sXHJcbiAgICAgIF07XHJcbiAgICAgIHRoaXMuY29udGVudC5hcHBJY29uID0gdGhpcy5nZXRJY29uUGF0aCh0aGlzLmNvbnRlbnQubWltZVR5cGUpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZ2V0QmVzdFNjb3JlKCkge1xyXG4gICAgdGhpcy5jb250ZW50U3RhdHVzLmZvckVhY2goKGl0ZW0pID0+IHtcclxuICAgICAgaWYgKGl0ZW0uY29udGVudElkID09PSB0aGlzLmNvbnRlbnQuaWRlbnRpZmllciAmJiBpdGVtLmJlc3RTY29yZSAmJiB0aGlzLnNjb3JlTGFiZWwgJiYgdGhpcy5tYXhBdHRlbXB0cykge1xyXG4gICAgICAgIHRoaXMuYmVzdFNjb3JlTGFiZWwgPSB0aGlzLnNjb3JlTGFiZWwgKyAnICcgKyAoTWF0aC5yb3VuZChpdGVtLmJlc3RTY29yZS50b3RhbFNjb3JlKjEwMCkvMTAwKS50b1N0cmluZygpICsgJy8nICsgaXRlbS5iZXN0U2NvcmUudG90YWxNYXhTY29yZS50b1N0cmluZygpO1xyXG4gICAgICAgIGlmICh0aGlzLm1heEF0dGVtcHRzIC0gaXRlbS5zY29yZS5sZW5ndGggPT09IDEpIHtcclxuICAgICAgICAgIHRoaXMuaXNMYXN0QXR0ZW1wdCA9IHRydWU7XHJcbiAgICAgICAgICB0aGlzLmlzRGlzYWJsZWQgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGl0ZW0uc2NvcmUubGVuZ3RoID49IHRoaXMubWF4QXR0ZW1wdHMpIHtcclxuICAgICAgICAgIHRoaXMuaXNEaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgICAgICB0aGlzLmlzTGFzdEF0dGVtcHQgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZ2V0SWNvblBhdGgoY29udGVudE1pbWVUeXBlOiBzdHJpbmcpIHtcclxuICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIHRoaXMuaWNvblBhdGhNYXApIHtcclxuICAgICAgaWYgKGtleS5pbmRleE9mKGNvbnRlbnRNaW1lVHlwZSkgPj0gMCkge1xyXG4gICAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuICcnO1xyXG4gIH1cclxuXHJcbiAgb25QbGF5QnV0dG9uQ2xpY2soZXZlbnQpIHtcclxuICAgIHRoaXMucGxheUJ1dHRvbkNsaWNrLmVtaXQoeyBldmVudDogZXZlbnQsIGRhdGE6IHsgLi4udGhpcy5jb250ZW50IH0gfSk7XHJcbiAgfVxyXG5cclxuICBzd2FwQ2FyZChjb250ZW50KSB7XHJcbiAgICBpZiAodGhpcy5wbGF0Zm9ybSA9PT0gUGxhdGZvcm1UeXBlLk1PQklMRSkge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5pc1RyYWNrYWJsZShjb250ZW50KSkge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcblxyXG4gIGlzVHJhY2thYmxlKGNvbnRlbnQpIHtcclxuICAgIGlmICgoY29udGVudC5jb250ZW50RGF0YSAmJiBjb250ZW50LmNvbnRlbnREYXRhLnRyYWNrYWJsZSAmJiBjb250ZW50LmNvbnRlbnREYXRhLnRyYWNrYWJsZS5lbmFibGVkID09PSAnWWVzJykgfHxcclxuICAgICAgKGNvbnRlbnQudHJhY2thYmxlICYmIGNvbnRlbnQudHJhY2thYmxlLmVuYWJsZWQgPT09ICdZZXMnKSkge1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcblxyXG4gIGdldENvbnRlbnRJbWFnZShjb250ZW50KSB7XHJcbiAgICBpZiAodGhpcy5pc1RyYWNrYWJsZShjb250ZW50KSAmJiB0aGlzLnRyYWNrYWJsZURlZmF1bHRJbWFnZSkge1xyXG4gICAgICByZXR1cm4gdGhpcy50cmFja2FibGVEZWZhdWx0SW1hZ2U7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gY29udGVudC5hcHBJY29uIHx8IChjb250ZW50LmNvbnRlbnREYXRhICYmIGNvbnRlbnQuY29udGVudERhdGEuYXBwSWNvbik7XHJcbiAgfVxyXG59XHJcbiJdfQ==