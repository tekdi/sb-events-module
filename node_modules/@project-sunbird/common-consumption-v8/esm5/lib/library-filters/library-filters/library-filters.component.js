/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input, Output, EventEmitter } from '@angular/core';
import { LibraryFiltersLayout, TocMimeTypes } from './models';
var LibraryFiltersComponent = /** @class */ (function () {
    function LibraryFiltersComponent() {
        this.selectedFilter = new EventEmitter();
        this.selectedMimeType = new EventEmitter();
        this.TocMimeTypesMaster = [
            { name: 'all', value: ['all'] },
            {
                name: 'video', value: ['video/mp4', 'video/x-youtube', 'video/webm']
            },
            {
                name: 'docs', value: ['application/pdf', 'application/epub', 'application/msword']
            },
            {
                name: 'interactive',
                value: ['application/vnd.ekstep.ecml-archive', 'application/vnd.ekstep.h5p-archive', 'application/vnd.ekstep.html-archive'],
            },
        ];
    }
    Object.defineProperty(LibraryFiltersComponent.prototype, "LibraryFiltersLayout", {
        get: /**
         * @return {?}
         */
        function () { return LibraryFiltersLayout; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LibraryFiltersComponent.prototype, "TocMimeTypes", {
        get: /**
         * @return {?}
         */
        function () { return TocMimeTypes; },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} input
     * @return {?}
     */
    LibraryFiltersComponent.prototype.fetchCorrespondingTypes = /**
     * @param {?} input
     * @return {?}
     */
    function (input) {
        /** @type {?} */
        var type = '';
        switch (input) {
            case TocMimeTypes.ALL:
                type = TocMimeTypes.ALL;
                break;
            case TocMimeTypes.AUDIO:
                type = TocMimeTypes.AUDIO;
                break;
            case TocMimeTypes.COLLECTION:
                type = TocMimeTypes.COLLECTION;
                break;
            case TocMimeTypes.DOCS:
                type = TocMimeTypes.DOCS;
                break;
            case TocMimeTypes.INTERACTIVE:
                type = TocMimeTypes.INTERACTIVE;
                break;
            case TocMimeTypes.VIDEO:
                type = TocMimeTypes.VIDEO;
                break;
        }
        return type;
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    LibraryFiltersComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        var _this = this;
        if (this.layout === LibraryFiltersLayout.ROUND_WITH_ICONS) {
            if (this.tocList) {
                this.filterList = this.tocList.map((/**
                 * @param {?} item
                 * @param {?} index
                 * @return {?}
                 */
                function (item, index) {
                    /** @type {?} */
                    var type = _this.fetchCorrespondingTypes(item.value);
                    if (_this.selectedItems && _this.selectedItems.includes(index)) {
                        return ({ text: item.text, selected: true, type: type });
                    }
                    else if (!_this.selectedItems && type === TocMimeTypes.ALL) {
                        return ({ text: item.text, selected: true, type: type });
                    }
                    else {
                        return ({ text: item.text, selected: false, type: type });
                    }
                }));
            }
            else if (this.list) {
                this.filterList = this.list.map((/**
                 * @param {?} item
                 * @param {?} index
                 * @return {?}
                 */
                function (item, index) {
                    /** @type {?} */
                    var type = _this.fetchCorrespondingTypes(item);
                    if (_this.selectedItems && _this.selectedItems.includes(index)) {
                        return ({ text: item, selected: true, type: type });
                    }
                    else if (!_this.selectedItems && item === TocMimeTypes.ALL) {
                        return ({ text: item, selected: true, type: type });
                    }
                    else {
                        return ({ text: item, selected: false, type: type });
                    }
                }));
            }
        }
        else {
            if (this.list) {
                this.filterList = this.list.map((/**
                 * @param {?} item
                 * @param {?} index
                 * @return {?}
                 */
                function (item, index) {
                    if (_this.selectedItems && _this.selectedItems.includes(index)) {
                        return ({ text: item, selected: true });
                    }
                    else {
                        return ({ text: item, selected: false });
                    }
                }));
            }
        }
    };
    /**
     * @param {?} event
     * @param {?} index
     * @return {?}
     */
    LibraryFiltersComponent.prototype.selectPill = /**
     * @param {?} event
     * @param {?} index
     * @return {?}
     */
    function (event, index) {
        this.filterList = this.filterList.map((/**
         * @param {?} e
         * @return {?}
         */
        function (e) { return (tslib_1.__assign({}, e, { selected: false })); }));
        try {
            this.filterList[index].selected = true;
            this.selectedFilter.emit({ event: event, data: tslib_1.__assign({}, this.filterList[index], { index: index }) });
            // animation code
            /** @type {?} */
            var el_1 = document.getElementById('class' + index);
            if (el_1) {
                el_1.scrollIntoView({ behavior: 'smooth', block: 'end', inline: 'start' });
            }
            else {
                setTimeout((/**
                 * @return {?}
                 */
                function () {
                    el_1 = document.getElementById('class' + index);
                    if (el_1) {
                        el_1.scrollIntoView({ behavior: 'smooth', block: 'end', inline: 'start' });
                    }
                }), 1000);
            }
        }
        catch (error) {
            console.error('Error in selectPill method', error);
        }
    };
    /**
     * @param {?} event
     * @param {?} index
     * @return {?}
     */
    LibraryFiltersComponent.prototype.selectMimeFilter = /**
     * @param {?} event
     * @param {?} index
     * @return {?}
     */
    function (event, index) {
        var _this = this;
        /** @type {?} */
        var outputType = {};
        this.filterList = this.filterList.map((/**
         * @param {?} e
         * @return {?}
         */
        function (e) { return (tslib_1.__assign({}, e, { selected: false })); }));
        try {
            this.filterList[index].selected = true;
            this.TocMimeTypesMaster.map((/**
             * @param {?} mimeType
             * @return {?}
             */
            function (mimeType) {
                if (mimeType.name === _this.filterList[index].type) {
                    outputType = {
                        event: event,
                        data: tslib_1.__assign({ value: mimeType.value }, _this.filterList[index], { index: index })
                    };
                }
            }));
            this.selectedMimeType.emit(tslib_1.__assign({}, outputType));
            // animation code
            /** @type {?} */
            var el_2 = document.getElementById('mimeType' + index);
            if (el_2) {
                el_2.scrollIntoView({ behavior: 'smooth', block: 'end', inline: 'start' });
            }
            else {
                setTimeout((/**
                 * @return {?}
                 */
                function () {
                    el_2 = document.getElementById('mimeType' + index);
                    if (el_2) {
                        el_2.scrollIntoView({ behavior: 'smooth', block: 'end', inline: 'start' });
                    }
                }), 1000);
            }
        }
        catch (error) {
            console.error('Error in selectPill method', error);
        }
    };
    LibraryFiltersComponent.decorators = [
        { type: Component, args: [{
                    selector: 'sb-library-filters',
                    template: "<div class=\"fixed-container\">\r\n    <!-- Library medium filter -->\r\n    <div *ngIf=\"layout === LibraryFiltersLayout.SQUARE\" class=\"sb-slider-pills-container\">\r\n        <div class=\"sb-pills-container sb-medium-pills-container\" id=\"mediumScroll\">\r\n            <div class=\"pill\" *ngFor=\"let item of filterList; let i = index;\" [ngClass]=\"{'active': item?.selected}\"\r\n                attr.id=\"medium{{i}}\" (click)=\"selectPill($event, i)\">{{item.text}} medium\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <!-- Library class/grade filter -->\r\n    <div *ngIf=\"layout === LibraryFiltersLayout.ROUND\" class=\"sb-slider-pills-container\">\r\n        <div class=\"sb-pills-container sb-grade-pills-container\" id=\"gradeScroll\">\r\n            <div class=\"pill rounded\" *ngFor=\"let item of filterList; let i = index;\"\r\n                [ngClass]=\"{'active': item?.selected}\" attr.id=\"class{{i}}\" (click)=\"selectPill($event, i)\">\r\n                {{item.text}}</div>\r\n        </div>\r\n    </div>\r\n    <!-- Player page content filters -->\r\n    <div *ngIf=\"layout === LibraryFiltersLayout.ROUND_WITH_ICONS\" class=\"sb-slider-pills-container\">\r\n        <div class=\"sb-pills-container sb-grade-pills-container\" id=\"gradeScroll\">\r\n            <div class=\"pill rounded rounded-with-icon\" *ngFor=\"let item of filterList; let i = index;\"\r\n                [ngClass]=\"{'active': item?.selected}\" attr.id=\"mimeType{{i}}\" (click)=\"selectMimeFilter($event, i)\">\r\n                <ng-container *ngIf=\"item?.type === TocMimeTypes.VIDEO \">\r\n                    <i class=\"icon-svg icon-svg--xs icon-videos\" >\r\n                        <svg class=\"icon icon-svg--primary\">\r\n                            <use xlink:href=\"assets/common-consumption/images/sprite.svg#play\"></use>\r\n                        </svg>\r\n                    </i>\r\n                </ng-container>\r\n                <ng-container *ngIf=\"item?.type === TocMimeTypes.DOCS \">\r\n                    <i class=\"icon-svg icon-svg--xs icon-docs\" >\r\n                        <svg class=\"icon icon-svg--primary\">\r\n                            <use xlink:href=\"assets/common-consumption/images/sprite.svg#doc\"></use>\r\n                        </svg>\r\n                    </i>\r\n                </ng-container>\r\n                <ng-container *ngIf=\"item?.type === TocMimeTypes.INTERACTIVE \">\r\n                    <i class=\"icon-svg icon-svg--xs icon-touch\" >\r\n                        <svg class=\"icon icon-svg--primary\">\r\n                            <use xlink:href=\"assets/common-consumption/images/sprite.svg#touch\"></use>\r\n                        </svg>\r\n                    </i>\r\n                </ng-container>\r\n                <span class=\"name\">{{item.text}}</span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>",
                    styles: [":host .fixed-container{width:100%;position:relative;z-index:2}:host .sb-slider-pills-container{overflow-x:auto}:host .sb-slider-pills-container .sb-pills-container{display:inline-flex;align-items:center;box-sizing:border-box}[dir=ltr] :host .sb-slider-pills-container .sb-pills-container,[dir=rtl] :host .sb-slider-pills-container .sb-pills-container{padding:1rem}:host .sb-slider-pills-container .sb-pills-container .pill{background-color:var(--white);white-space:nowrap;-webkit-appearance:none;text-overflow:ellipsis;min-height:2rem;cursor:pointer;transition:.25s ease-in-out;border-radius:.125rem;text-transform:capitalize;text-decoration:none;text-align:center;font-weight:400;font-style:normal;font-stretch:normal;font-size:.75rem;box-sizing:border-box;display:flex;align-items:center;line-height:1rem}[dir=ltr] :host .sb-slider-pills-container .sb-pills-container .pill{margin-right:.5rem}[dir=rtl] :host .sb-slider-pills-container .sb-pills-container .pill{margin-left:.5rem}[dir=ltr] :host .sb-slider-pills-container .sb-pills-container .pill,[dir=rtl] :host .sb-slider-pills-container .sb-pills-container .pill{padding:.25rem .5rem}[dir=ltr] :host .sb-slider-pills-container .sb-pills-container .pill:last-child{margin-right:.5rem}[dir=rtl] :host .sb-slider-pills-container .sb-pills-container .pill:last-child{margin-left:.5rem}:host .sb-slider-pills-container .sb-medium-pills-container{min-height:4rem;background:var(--white);min-width:100%}:host .sb-slider-pills-container .sb-medium-pills-container .pill{border:var(--secondary-color) .0625rem solid;color:var(--secondary-color)}:host .sb-slider-pills-container .sb-medium-pills-container .pill.active,:host .sb-slider-pills-container .sb-medium-pills-container .pill:active,:host .sb-slider-pills-container .sb-medium-pills-container .pill:hover{color:var(--white);background-color:var(--secondary-color);box-shadow:0 3px 4px 0 rgba(var(--rc-rgba-black),.19)}:host .sb-slider-pills-container .sb-grade-pills-container{min-height:3rem;background:var(--gray-0);min-width:100%}:host .sb-slider-pills-container .sb-grade-pills-container .pill{border-radius:1rem;color:var(--primary-color);min-height:2rem}[dir=ltr] :host .sb-slider-pills-container .sb-grade-pills-container .pill,[dir=rtl] :host .sb-slider-pills-container .sb-grade-pills-container .pill{padding:.25rem 1rem}:host .sb-slider-pills-container .sb-grade-pills-container .pill.active,:host .sb-slider-pills-container .sb-grade-pills-container .pill:active,:host .sb-slider-pills-container .sb-grade-pills-container .pill:hover{background-color:var(--primary-color);color:var(--white);box-shadow:0 3px 4px 0 rgba(var(--rc-rgba-black),.19)}:host .sb-slider-pills-container .sb-grade-pills-container .pill.active .icon-svg svg,:host .sb-slider-pills-container .sb-grade-pills-container .pill:active .icon-svg svg,:host .sb-slider-pills-container .sb-grade-pills-container .pill:hover .icon-svg svg{fill:var(--white)}:host .sb-slider-pills-container .sb-grade-pills-container .pill.rounded{font-size:.875rem}:host .sb-slider-pills-container .sb-grade-pills-container .pill.rounded-with-icon .icon-svg{margin-right:.25rem;top:0}html[dir=rtl] :host .sb-slider-pills-container .sb-grade-pills-container .pill.rounded-with-icon .icon-svg{margin-left:.25rem;margin-right:inherit}:host .sb-slider-pills-container .sb-grade-pills-container .pill.rounded-with-icon .name{-ms-grid-row-align:center;align-self:center;display:inline-block;line-height:1rem}"]
                }] }
    ];
    LibraryFiltersComponent.propDecorators = {
        list: [{ type: Input }],
        tocList: [{ type: Input }],
        selectedItems: [{ type: Input }],
        layout: [{ type: Input }],
        selectedFilter: [{ type: Output }],
        selectedMimeType: [{ type: Output }]
    };
    return LibraryFiltersComponent;
}());
export { LibraryFiltersComponent };
if (false) {
    /** @type {?} */
    LibraryFiltersComponent.prototype.list;
    /** @type {?} */
    LibraryFiltersComponent.prototype.tocList;
    /** @type {?} */
    LibraryFiltersComponent.prototype.selectedItems;
    /** @type {?} */
    LibraryFiltersComponent.prototype.layout;
    /** @type {?} */
    LibraryFiltersComponent.prototype.selectedFilter;
    /** @type {?} */
    LibraryFiltersComponent.prototype.selectedMimeType;
    /** @type {?} */
    LibraryFiltersComponent.prototype.TocMimeTypesMaster;
    /** @type {?} */
    LibraryFiltersComponent.prototype.filterList;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlicmFyeS1maWx0ZXJzLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bwcm9qZWN0LXN1bmJpcmQvY29tbW9uLWNvbnN1bXB0aW9uLXY4LyIsInNvdXJjZXMiOlsibGliL2xpYnJhcnktZmlsdGVycy9saWJyYXJ5LWZpbHRlcnMvbGlicmFyeS1maWx0ZXJzLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQWEsTUFBTSxlQUFlLENBQUM7QUFDbEYsT0FBTyxFQUFFLG9CQUFvQixFQUFnQyxZQUFZLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFFNUY7SUFBQTtRQVljLG1CQUFjLEdBQWtDLElBQUksWUFBWSxFQUFtQixDQUFDO1FBQ3BGLHFCQUFnQixHQUFzQixJQUFJLFlBQVksRUFBRSxDQUFDO1FBRTVELHVCQUFrQixHQUFHO1lBQ3hCLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsQ0FBQyxLQUFLLENBQUMsRUFBRTtZQUMvQjtnQkFDRSxJQUFJLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxDQUFDLFdBQVcsRUFBRSxpQkFBaUIsRUFBRSxZQUFZLENBQUM7YUFDckU7WUFDRDtnQkFDRSxJQUFJLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxDQUFDLGlCQUFpQixFQUFFLGtCQUFrQixFQUFFLG9CQUFvQixDQUFDO2FBQ25GO1lBQ0Q7Z0JBQ0UsSUFBSSxFQUFFLGFBQWE7Z0JBQ25CLEtBQUssRUFBRSxDQUFDLHFDQUFxQyxFQUFFLG9DQUFvQyxFQUFFLHFDQUFxQyxDQUFDO2FBQzVIO1NBRUYsQ0FBQztJQTJIUixDQUFDO0lBdkhHLHNCQUFJLHlEQUFvQjs7OztRQUF4QixjQUE2QixPQUFPLG9CQUFvQixDQUFDLENBQUMsQ0FBQzs7O09BQUE7SUFDM0Qsc0JBQUksaURBQVk7Ozs7UUFBaEIsY0FBcUIsT0FBTyxZ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U0FBUyxTQUFDO29CQUNQLFFBQVEsRUFBRSxvQkFBb0I7b0JBQzlCLG0zRkFBK0M7O2lCQUVsRDs7O3VCQUlJLEtBQUs7MEJBQ0wsS0FBSztnQ0FDTCxLQUFLO3lCQUNMLEtBQUs7aUNBQ0wsTUFBTTttQ0FDTixNQUFNOztJQTBJWCw4QkFBQztDQUFBLEFBdkpELElBdUpDO1NBakpZLHVCQUF1Qjs7O0lBRWhDLHVDQUF3Qjs7SUFDeEIsMENBQWlCOztJQUNqQixnREFBaUM7O0lBQ2pDLHlDQUFzQzs7SUFDdEMsaURBQThGOztJQUM5RixtREFBbUU7O0lBRW5FLHFEQWFJOztJQUVKLDZDQUEwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBPbkNoYW5nZXMgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgTGlicmFyeUZpbHRlcnNMYXlvdXQsIElGaWx0ZXJJdGVtLCBJU2VsZWN0ZWRGaWx0ZXIsIFRvY01pbWVUeXBlcyB9IGZyb20gJy4vbW9kZWxzJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdzYi1saWJyYXJ5LWZpbHRlcnMnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL2xpYnJhcnktZmlsdGVycy5jb21wb25lbnQuaHRtbCcsXHJcbiAgICBzdHlsZVVybHM6IFsnLi9saWJyYXJ5LWZpbHRlcnMuY29tcG9uZW50LnNjc3MnXVxyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIExpYnJhcnlGaWx0ZXJzQ29tcG9uZW50IGltcGxlbWVudHMgT25DaGFuZ2VzIHtcclxuXHJcbiAgICBASW5wdXQoKSBsaXN0OiBzdHJpbmdbXTtcclxuICAgIEBJbnB1dCgpIHRvY0xpc3Q7XHJcbiAgICBASW5wdXQoKSBzZWxlY3RlZEl0ZW1zOiBudW1iZXJbXTtcclxuICAgIEBJbnB1dCgpIGxheW91dDogTGlicmFyeUZpbHRlcnNMYXlvdXQ7XHJcbiAgICBAT3V0cHV0KCkgc2VsZWN0ZWRGaWx0ZXI6IEV2ZW50RW1pdHRlcjxJU2VsZWN0ZWRGaWx0ZXI+ID0gbmV3IEV2ZW50RW1pdHRlcjxJU2VsZWN0ZWRGaWx0ZXI+KCk7XHJcbiAgICBAT3V0cHV0KCkgc2VsZWN0ZWRNaW1lVHlwZTogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gICAgcHVibGljIFRvY01pbWVUeXBlc01hc3RlciA9IFtcclxuICAgICAgICB7IG5hbWU6ICdhbGwnLCB2YWx1ZTogWydhbGwnXSB9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIG5hbWU6ICd2aWRlbycsIHZhbHVlOiBbJ3ZpZGVvL21wNCcsICd2aWRlby94LXlvdXR1YmUnLCAndmlkZW8vd2VibSddXHJcbiAgICAgICAgfSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICBuYW1lOiAnZG9jcycsIHZhbHVlOiBbJ2FwcGxpY2F0aW9uL3BkZicsICdhcHBsaWNhdGlvbi9lcHViJywgJ2FwcGxpY2F0aW9uL21zd29yZCddXHJcbiAgICAgICAgfSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICBuYW1lOiAnaW50ZXJhY3RpdmUnLFxyXG4gICAgICAgICAgdmFsdWU6IFsnYXBwbGljYXRpb24vdm5kLmVrc3RlcC5lY21sLWFyY2hpdmUnLCAnYXBwbGljYXRpb24vdm5kLmVrc3RlcC5oNXAtYXJjaGl2ZScsICdhcHBsaWNhdGlvbi92bmQuZWtzdGVwLmh0bWwtYXJjaGl2ZSddLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgLy8geyBuYW1lOiAnQVVESU9TJywgdmFsdWU6IE1pbWVUeXBlLkFVRElPLCBpY29uTm9ybWFsOiAnLi9hc3NldHMvaW1ncy9hdWRpby5zdmcnLCBpY29uQWN0aXZlOiAnLi9hc3NldHMvaW1ncy9hdWRpby1hY3RpdmUuc3ZnJ30sXHJcbiAgICAgIF07XHJcblxyXG4gICAgZmlsdGVyTGlzdDogSUZpbHRlckl0ZW1bXTtcclxuXHJcbiAgICBnZXQgTGlicmFyeUZpbHRlcnNMYXlvdXQoKSB7IHJldHVybiBMaWJyYXJ5RmlsdGVyc0xheW91dDsgfVxyXG4gICAgZ2V0IFRvY01pbWVUeXBlcygpIHsgcmV0dXJuIFRvY01pbWVUeXBlczsgfVxyXG4gICAgXHJcbiAgICBmZXRjaENvcnJlc3BvbmRpbmdUeXBlcyhpbnB1dDpTdHJpbmcpIHtcclxuICAgICAgICBsZXQgdHlwZSA9ICcnO1xyXG4gICAgICAgIHN3aXRjaCAoaW5wdXQpIHtcclxuICAgICAgICAgICAgY2FzZSBUb2NNaW1lVHlwZXMuQUxMOiB0eXBlID0gVG9jTWltZVR5cGVzLkFMTDtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFRvY01pbWVUeXBlcy5BVURJTzogdHlwZSA9IFRvY01pbWVUeXBlcy5BVURJTztcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFRvY01pbWVUeXBlcy5DT0xMRUNUSU9OOiB0eXBlID0gVG9jTWltZVR5cGVzLkNPTExFQ1RJT047XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBUb2NNaW1lVHlwZXMuRE9DUzogdHlwZSA9IFRvY01pbWVUeXBlcy5ET0NTO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgVG9jTWltZVR5cGVzLklOVEVSQUNUSVZFOiB0eXBlID0gVG9jTWltZVR5cGVzLklOVEVSQUNUSVZFO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgVG9jTWltZVR5cGVzLlZJREVPOiB0eXBlID0gVG9jTWltZVR5cGVzLlZJREVPO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0eXBlO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXMpIHtcclxuICAgICAgICBpZiAodGhpcy5sYXlvdXQgPT09IExpYnJhcnlGaWx0ZXJzTGF5b3V0LlJPVU5EX1dJVEhfSUNPTlMpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMudG9jTGlzdCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5maWx0ZXJMaXN0ID0gdGhpcy50b2NMaXN0Lm1hcCgoaXRlbSwgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgdHlwZSA9IHRoaXMuZmV0Y2hDb3JyZXNwb25kaW5nVHlwZXMoaXRlbS52YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRJdGVtcyAmJiB0aGlzLnNlbGVjdGVkSXRlbXMuaW5jbHVkZXMoaW5kZXgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoeyB0ZXh0OiBpdGVtLnRleHQsIHNlbGVjdGVkOiB0cnVlLCB0eXBlOiB0eXBlIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIXRoaXMuc2VsZWN0ZWRJdGVtcyAmJiB0eXBlID09PSBUb2NNaW1lVHlwZXMuQUxMKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoeyB0ZXh0OiBpdGVtLnRleHQsIHNlbGVjdGVkOiB0cnVlLCB0eXBlOiB0eXBlIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoeyB0ZXh0OiBpdGVtLnRleHQsIHNlbGVjdGVkOiBmYWxzZSwgdHlwZTogdHlwZSB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmKHRoaXMubGlzdCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5maWx0ZXJMaXN0ID0gdGhpcy5saXN0Lm1hcCgoaXRlbSwgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgdHlwZSA9IHRoaXMuZmV0Y2hDb3JyZXNwb25kaW5nVHlwZXMoaXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRJdGVtcyAmJiB0aGlzLnNlbGVjdGVkSXRlbXMuaW5jbHVkZXMoaW5kZXgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoeyB0ZXh0OiBpdGVtLCBzZWxlY3RlZDogdHJ1ZSwgdHlwZTogdHlwZSB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCF0aGlzLnNlbGVjdGVkSXRlbXMgJiYgaXRlbSA9PT0gVG9jTWltZVR5cGVzLkFMTCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKHsgdGV4dDogaXRlbSwgc2VsZWN0ZWQ6IHRydWUsIHR5cGU6IHR5cGUgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICh7IHRleHQ6IGl0ZW0sIHNlbGVjdGVkOiBmYWxzZSwgdHlwZTogdHlwZSB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmxpc3QpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVyTGlzdCA9IHRoaXMubGlzdC5tYXAoKGl0ZW0sIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRJdGVtcyAmJiB0aGlzLnNlbGVjdGVkSXRlbXMuaW5jbHVkZXMoaW5kZXgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoeyB0ZXh0OiBpdGVtLCBzZWxlY3RlZDogdHJ1ZSB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKHsgdGV4dDogaXRlbSwgc2VsZWN0ZWQ6IGZhbHNlIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNlbGVjdFBpbGwoZXZlbnQ6IE1vdXNlRXZlbnQsIGluZGV4OiBudW1iZXIpIHtcclxuICAgICAgICB0aGlzLmZpbHRlckxpc3QgPSB0aGlzLmZpbHRlckxpc3QubWFwKGUgPT4gKHsgLi4uZSwgc2VsZWN0ZWQ6IGZhbHNlIH0pKTtcclxuXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgdGhpcy5maWx0ZXJMaXN0W2luZGV4XS5zZWxlY3RlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRGaWx0ZXIuZW1pdCh7IGV2ZW50OiBldmVudCwgZGF0YTogeyAuLi50aGlzLmZpbHRlckxpc3RbaW5kZXhdLCBpbmRleCB9IH0pO1xyXG5cclxuICAgICAgICAgICAgLy8gYW5pbWF0aW9uIGNvZGVcclxuICAgICAgICAgICAgbGV0IGVsOiBIVE1MRWxlbWVudCB8IG51bGwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2xhc3MnICsgaW5kZXgpO1xyXG4gICAgICAgICAgICBpZiAoZWwpIHtcclxuICAgICAgICAgICAgICAgIGVsLnNjcm9sbEludG9WaWV3KHsgYmVoYXZpb3I6ICdzbW9vdGgnLCBibG9jazogJ2VuZCcsIGlubGluZTogJ3N0YXJ0JyB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NsYXNzJyArIGluZGV4KTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZWwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWwuc2Nyb2xsSW50b1ZpZXcoeyBiZWhhdmlvcjogJ3Ntb290aCcsIGJsb2NrOiAnZW5kJywgaW5saW5lOiAnc3RhcnQnIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sIDEwMDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gc2VsZWN0UGlsbCBtZXRob2QnLCBlcnJvcik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNlbGVjdE1pbWVGaWx0ZXIoZXZlbnQsIGluZGV4KSB7XHJcbiAgICAgICBsZXQgb3V0cHV0VHlwZSA9IHt9O1xyXG4gICAgICAgIHRoaXMuZmlsdGVyTGlzdCA9IHRoaXMuZmlsdGVyTGlzdC5tYXAoZSA9PiAoeyAuLi5lLCBzZWxlY3RlZDogZmFsc2UgfSkpO1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyTGlzdFtpbmRleF0uc2VsZWN0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzLlRvY01pbWVUeXBlc01hc3Rlci5tYXAobWltZVR5cGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKG1pbWVUeXBlLm5hbWUgPT09IHRoaXMuZmlsdGVyTGlzdFtpbmRleF0udHlwZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG91dHB1dFR5cGUgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50OiBldmVudCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IG1pbWVUeXBlLnZhbHVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLi4udGhpcy5maWx0ZXJMaXN0W2luZGV4XSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRNaW1lVHlwZS5lbWl0KHsuLi5vdXRwdXRUeXBlfSk7XHJcbiAgICAgICAgICAgIC8vIGFuaW1hdGlvbiBjb2RlXHJcbiAgICAgICAgICAgIGxldCBlbDogSFRNTEVsZW1lbnQgfCBudWxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21pbWVUeXBlJyArIGluZGV4KTtcclxuICAgICAgICAgICAgaWYgKGVsKSB7XHJcbiAgICAgICAgICAgICAgICBlbC5zY3JvbGxJbnRvVmlldyh7IGJlaGF2aW9yOiAnc21vb3RoJywgYmxvY2s6ICdlbmQnLCBpbmxpbmU6ICdzdGFydCcgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtaW1lVHlwZScgKyBpbmRleCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsLnNjcm9sbEludG9WaWV3KHsgYmVoYXZpb3I6ICdzbW9vdGgnLCBibG9jazogJ2VuZCcsIGlubGluZTogJ3N0YXJ0JyB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LCAxMDAwKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBzZWxlY3RQaWxsIG1ldGhvZCcsIGVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl19