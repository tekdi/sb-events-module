/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { MimeTypeMasterData } from './../../pipes-module/mime-type';
import { Component, Input, EventEmitter, Output } from '@angular/core';
import { COMMON_CONSUMPTION_CONSTANTS } from '../../common-consumption.constants';
import { PlatformType, TocCardType } from '../models';
export class TocCardComponent {
    constructor() {
        this.type = TocCardType.TEXTBOOK;
        this.contentStatus = [];
        this.trackableDefaultImage = '';
        this.platform = PlatformType.MOBILE;
        this.tocCardClick = new EventEmitter();
        this.playButtonClick = new EventEmitter();
        this.scoreLabel = '';
        this.disabled = '';
        this.fallbackImg = COMMON_CONSUMPTION_CONSTANTS.TOC_CARD_FALLBACK_IMG;
        this.isContentStarted = false;
        this.isCourseCompleted = false;
        this.isLastAttempt = false;
        this.isDisabled = false;
    }
    /**
     * @return {?}
     */
    get TocCardType() { return TocCardType; }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (this.type === TocCardType.COURSE) {
            this.createIconMap();
        }
        this.getBestScore();
        setTimeout((/**
         * @return {?}
         */
        () => {
            if (this.activeContent && this.activeContent.sbUniqueIdentifier === this.content.sbUniqueIdentifier) {
                this.tocCardClick.emit({ event: {}, data: Object.assign({}, this.content) });
            }
        }));
        if (!this.playBtnConfig) {
            this.playBtnConfig = {
                label: 'Play',
                show: false
            };
        }
        if (!this.platform) {
            this.platform = PlatformType.MOBILE;
        }
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes && changes.contentStatus) {
            if (this.type === TocCardType.COURSE) {
                this.createIconMap();
            }
            this.getBestScore();
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onTocCardClick(event) {
        return tslib_1.__awaiter(this, void 0, void 0, /** @this {!TocCardComponent} */ function* () {
            if (this.isLastAttempt) {
                event.isLastAttempt = true;
                this.tocCardClick.emit({ event: event, data: Object.assign({}, this.content) });
            }
            else if (this.isDisabled) {
                event.isDisabled = true;
                this.tocCardClick.emit({ event: event, data: Object.assign({}, this.content) });
            }
            else if (this.activeContent && this.activeContent.sbUniqueIdentifier !== this.content.sbUniqueIdentifier) {
                this.tocCardClick.emit({ event: event, data: Object.assign({}, this.content) });
            }
            else if (this.type = TocCardType.COURSE) {
                this.tocCardClick.emit({ event: event, data: Object.assign({}, this.content) });
            }
        });
    }
    /**
     * @return {?}
     */
    createIconMap() {
        /** @type {?} */
        const mimeTypesData = MimeTypeMasterData;
        this.isCourseCompleted = this.contentStatus.find((/**
         * @param {?} item
         * @return {?}
         */
        (item) => {
            if (item.contentId === this.content.identifier && item.status === 2) {
                return true;
            }
        }));
        this.isContentStarted = !!(this.contentStatus.find((/**
         * @param {?} item
         * @return {?}
         */
        (item) => {
            if (item.contentId === this.content.identifier && item.status === 1) {
                return true;
            }
        })));
        if (this.isCourseCompleted) {
            this.content.appIcon = 'assets/common-consumption/images/sprite.svg#circle-with-check-symbol';
        }
        else {
            this.iconPathMap = [
                [mimeTypesData.COLLECTION, 'assets/common-consumption/images/sprite.svg#doc'],
                [mimeTypesData.VIDEO, 'assets/common-consumption/images/sprite.svg#play'],
                [mimeTypesData.AUDIO, 'assets/common-consumption/images/sprite.svg#play'],
                [mimeTypesData.INTERACTIVE, 'assets/common-consumption/images/sprite.svg#touch'],
                [mimeTypesData.DOCS, 'assets/common-consumption/images/sprite.svg#doc'],
            ];
            this.content.appIcon = this.getIconPath(this.content.mimeType);
        }
    }
    /**
     * @return {?}
     */
    getBestScore() {
        this.contentStatus.forEach((/**
         * @param {?} item
         * @return {?}
         */
        (item) => {
            if (item.contentId === this.content.identifier && item.bestScore && this.scoreLabel && this.maxAttempts) {
                this.bestScoreLabel = this.scoreLabel + ' ' + (Math.round(item.bestScore.totalScore * 100) / 100).toString() + '/' + item.bestScore.totalMaxScore.toString();
                if (this.maxAttempts - item.score.length === 1) {
                    this.isLastAttempt = true;
                    this.isDisabled = false;
                }
                if (item.score.length >= this.maxAttempts) {
                    this.isDisabled = true;
                    this.isLastAttempt = false;
                }
            }
        }));
    }
    /**
     * @param {?} contentMimeType
     * @return {?}
     */
    getIconPath(contentMimeType) {
        for (const [key, value] of this.iconPathMap) {
            if (key.indexOf(contentMimeType) >= 0) {
                return value;
            }
        }
        return '';
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onPlayButtonClick(event) {
        this.playButtonClick.emit({ event: event, data: Object.assign({}, this.content) });
    }
    /**
     * @param {?} content
     * @return {?}
     */
    swapCard(content) {
        if (this.platform === PlatformType.MOBILE) {
            return false;
        }
        if (this.isTrackable(content)) {
            return false;
        }
        return true;
    }
    /**
     * @param {?} content
     * @return {?}
     */
    isTrackable(content) {
        if ((content.contentData && content.contentData.trackable && content.contentData.trackable.enabled === 'Yes') ||
            (content.trackable && content.trackable.enabled === 'Yes')) {
            return true;
        }
        return false;
    }
    /**
     * @param {?} content
     * @return {?}
     */
    getContentImage(content) {
        if (this.isTrackable(content) && this.trackableDefaultImage) {
            return this.trackableDefaultImage;
        }
        return content.appIcon || (content.contentData && content.contentData.appIcon);
    }
}
TocCardComponent.decorators = [
    { type: Component, args: [{
                selector: 'sb-toc-card',
                template: "<!-- For card type textbook -->\r\n<div *ngIf=\"type === TocCardType.TEXTBOOK\">\r\n  <div class=\"sbchapter__item\" (click)=\"onTocCardClick($event)\"\r\n    [ngClass]=\"{'sbchapter__item--active': activeContent?.sbUniqueIdentifier === content?.sbUniqueIdentifier}\">\r\n    <h4 class=\"sbchapter__item__title sbchapter__item__title text-left sb__ellipsis sb__ellipsis--two mr-8\" title=\"{{content?.name}}\">\r\n      {{content?.name}}\r\n    </h4>\r\n    <div class=\"sbchapter__img\"><img [src]=\"content?.appIcon || fallbackImg\" (error)=\"img.src = fallbackImg\" alt=\"\"\r\n        #img />\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<!-- For card type TRACKABLE -->\r\n<div *ngIf=\"type === TocCardType.TRACKABLE\">\r\n  <div class=\"sbchapter__item\" [ngClass]=\"{'sb-card-swap': swapCard(content)}\" (click)=\"onTocCardClick($event)\"\r\n    [ngClass]=\"{'sbchapter__item--active': activeContent?.sbUniqueIdentifier === content?.sbUniqueIdentifier}\">\r\n    <div class=\"relative\">\r\n      <img src=\"assets/common-consumption/images/completed.svg\" *ngIf=\"content?.isAvailableLocally\" class=\"sb_success_check\" alt=\"\">\r\n      <div class=\"sbchapter__img\">\r\n        <img [src]=\"getContentImage(content) || fallbackImg\" alt=\"\" #img />\r\n      </div>\r\n    </div>\r\n    <div class=\"arrange-card-items certificate-course-contentt pl-8\">\r\n      <h4 class=\"sbchapter__item__title text-left sb__ellipsis sb__ellipsis--two mr-8 ml-8\" title=\"{{content?.name}}\">\r\n        {{content?.name}}\r\n      </h4>\r\n      <h4 *ngIf=\"bestScoreLabel\" class=\"sbchapter__item__score pr-8 ml-auto\" title=\"{{bestScoreLabel}}\">\r\n        {{bestScoreLabel}}\r\n      </h4>\r\n    </div>\r\n    <button class=\"sbchapter__play__btn\" *ngIf=\"!isTrackable(content) && playBtnConfig.show\"\r\n      (click)=\"$event.stopImmediatePropagation(); $event.preventDefault(); onPlayButtonClick($event)\">\r\n      <svg class=\"icon icon-svg--primary\">\r\n        <use xlink:href=\"assets/common-consumption/images/sprite.svg#play\"></use>\r\n      </svg>\r\n      {{playBtnConfig.label}}\r\n    </button>\r\n  </div>\r\n</div>\r\n\r\n<!-- For card type course -->\r\n<div *ngIf=\"type === TocCardType.COURSE\">\r\n  <div class=\"sbchapter__item\"  (click)=\"onTocCardClick($event)\"\r\n  [ngClass]=\"[(activeContent?.sbUniqueIdentifier === content?.sbUniqueIdentifier) ? 'sbchapter__item--active': '', isDisabled ? disabled: '']\">\r\n  <div class=\"sbchapter__img background-transparent\" [ngClass]=\"{'sbchapter__img--inprogress':isContentStarted}\">\r\n    {{createIconMap()}}\r\n    <i class=\"icon-svg icon-svg--sm\" *ngIf=\"content?.appIcon\">\r\n      <svg class=\"icon icon-svg--primary\">\r\n        <use [attr.xlink:href]=\"content?.appIcon\"></use>\r\n      </svg>\r\n    </i>\r\n    <img [src]=\"fallbackImg\" *ngIf=\"!content?.appIcon\" alt=\"\" #img />\r\n  </div>\r\n  <div class=\"certificate-course-content pl-8\">\r\n    <div class=\"sbchapter__item__title text-left sb__ellipsis sb__ellipsis--two mr-8 pt-4\" title=\"{{content?.name}}\">\r\n      {{content?.name}}\r\n    </div>\r\n      <div *ngIf=\"bestScoreLabel\" class=\"sbchapter__item__score pr-8 ml-auto\" title=\"{{bestScoreLabel}}\">\r\n        {{bestScoreLabel}}\r\n      </div>\r\n  </div>\r\n  </div>\r\n</div>\r\n\r\n<!-- For card type NON TRACKABLE -->\r\n<div *ngIf=\"type === TocCardType.NON_TRACKABLE\">\r\n  <div class=\"sbchapter__item\"  (click)=\"onTocCardClick($event)\"\r\n    [ngClass]=\"[(activeContent?.sbUniqueIdentifier === content?.sbUniqueIdentifier) ? 'sbchapter__item--active': '', isDisabled ? disabled: '']\">\r\n    <div class=\"sbchapter__img background-transparent\" [ngClass]=\"{'sbchapter__img--inprogress':isContentStarted}\">\r\n      {{createIconMap()}}\r\n      <i class=\"icon-svg icon-svg--sm\" *ngIf=\"content?.appIcon\">\r\n        <svg class=\"icon icon-svg--primary\">\r\n          <use [attr.xlink:href]=\"content?.appIcon\"></use>\r\n        </svg>\r\n      </i>\r\n      <img [src]=\"fallbackImg\" *ngIf=\"!content?.appIcon\" alt=\"\" #img />\r\n    </div>\r\n    <div class=\"certificate-course-content pl-8\">\r\n      <div class=\"sbchapter__item__title text-left sb__ellipsis sb__ellipsis--two mr-8 pt-4\" title=\"{{content?.name}}\">\r\n        {{content?.name}}\r\n      </div>\r\n      <div *ngIf=\"bestScoreLabel\" class=\"sbchapter__item__score pr-8 ml-auto\" title=\"{{bestScoreLabel}}\">\r\n        {{bestScoreLabel}}\r\n      </div> \r\n    </div>\r\n    <button class=\"sbchapter__play__btn\" *ngIf=\"!(content?.contentData?.trackable?.enabled === 'Yes') && playBtnConfig.show\" \r\n      (click)=\"$event.stopImmediatePropagation(); $event.preventDefault(); onPlayButtonClick($event)\">\r\n      <svg class=\"icon icon-svg--primary\">\r\n        <use xlink:href=\"assets/common-consumption/images/sprite.svg#play\"></use>\r\n      </svg>\r\n      {{playBtnConfig.label}}\r\n    </button>\r\n  </div>\r\n</div>",
                styles: [".sbchapter__item{background:var(--white);border:.0625rem solid var(--primary-300);box-shadow:0 .1875rem .25rem 0 rgba(var(--rc-rgba-primary),.1);display:flex;align-items:center;margin-bottom:.5rem;padding:.5rem;cursor:pointer;min-height:3.5rem;transition:.2s ease-in}.sbchapter__item .sbchapter__img{width:1.5rem;height:1.5rem;flex:0 0 1.5rem;display:flex;align-items:center;background:var(--rc-dddddd)}.sbchapter__item .sbchapter__img img{width:100%;max-height:100%;-o-object-fit:cover;object-fit:cover}.sbchapter__item .sbchapter__img .icon-svg svg.icon.icon-svg--primary{fill:#9cb9ff}.sbchapter__item .sbchapter__img--inprogress .icon-svg svg.icon.icon-svg--primary{fill:var(--primary-color)}.sbchapter__item--active,.sbchapter__item--active:hover,.sbchapter__item:hover{background:var(--primary-100)}.sbchapter__item--active .sbchapter__item__title{font-weight:700}.sbchapter__item__title{font-size:.75rem;line-height:1.25rem;color:var(--primary-400);margin:0 2rem 0 0;padding:0;font-weight:400}.sbchapter__item__score{text-transform:uppercase;color:#3f19c3;font-size:.6875rem;text-align:right;white-space:nowrap}.certificate-course-content{display:flex;align-items:center;width:100%}@media (max-width:767px){.sbchapter__item__title{margin-right:0;margin-bottom:.5rem}.sbchapter__item__score{text-align:left}.certificate-course-content{display:block}}.pl-8{padding-left:.5rem}.background-transparent{background:0 0!important}.sbchapter__play__btn{border:.0625rem solid var(--primary-color);border-radius:1rem;color:var(--primary-color);background-color:var(--white);padding:.25rem}.sbchapter__play__btn svg{height:1rem;width:1rem;vertical-align:middle}.sb-card-swap{flex-direction:row-reverse}.sb-card-swap .arrange-card-items{display:contents}.sb_success_check{position:absolute;top:-.3rem;right:-.3rem}.pr-8{padding-right:.5rem}.ml-auto{margin-left:auto}"]
            }] }
];
TocCardComponent.propDecorators = {
    content: [{ type: Input }],
    activeContent: [{ type: Input }],
    type: [{ type: Input }],
    contentStatus: [{ type: Input }],
    refresh: [{ type: Input }],
    playBtnConfig: [{ type: Input }],
    trackableDefaultImage: [{ type: Input }],
    platform: [{ type: Input }],
    tocCardClick: [{ type: Output }],
    playButtonClick: [{ type: Output }],
    scoreLabel: [{ type: Input }],
    maxAttempts: [{ type: Input }],
    disabled: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    TocCardComponent.prototype.content;
    /** @type {?} */
    TocCardComponent.prototype.activeContent;
    /** @type {?} */
    TocCardComponent.prototype.type;
    /** @type {?} */
    TocCardComponent.prototype.contentStatus;
    /** @type {?} */
    TocCardComponent.prototype.refresh;
    /** @type {?} */
    TocCardComponent.prototype.playBtnConfig;
    /** @type {?} */
    TocCardComponent.prototype.trackableDefaultImage;
    /** @type {?} */
    TocCardComponent.prototype.platform;
    /** @type {?} */
    TocCardComponent.prototype.tocCardClick;
    /** @type {?} */
    TocCardComponent.prototype.playButtonClick;
    /** @type {?} */
    TocCardComponent.prototype.scoreLabel;
    /** @type {?} */
    TocCardComponent.prototype.maxAttempts;
    /** @type {?} */
    TocCardComponent.prototype.disabled;
    /** @type {?} */
    TocCardComponent.prototype.fallbackImg;
    /** @type {?} */
    TocCardComponent.prototype.iconPathMap;
    /** @type {?} */
    TocCardComponent.prototype.isContentStarted;
    /** @type {?} */
    TocCardComponent.prototype.isCourseCompleted;
    /** @type {?} */
    TocCardComponent.prototype.bestScoreLabel;
    /** @type {?} */
    TocCardComponent.prototype.isLastAttempt;
    /** @type {?} */
    TocCardComponent.prototype.isDisabled;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9jLWNhcmQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHByb2plY3Qtc3VuYmlyZC9jb21tb24tY29uc3VtcHRpb24tdjgvIiwic291cmNlcyI6WyJsaWIvY2FyZC90b2MtY2FyZC90b2MtY2FyZC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUNwRSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUEwRCxNQUFNLGVBQWUsQ0FBQztBQUN2SSxPQUFPLEVBQUUsNEJBQTRCLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUNsRixPQUFPLEVBQWlCLFlBQVksRUFBRSxXQUFXLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFPckUsTUFBTSxPQUFPLGdCQUFnQjtJQUw3QjtRQVFXLFNBQUksR0FBZ0IsV0FBVyxDQUFDLFFBQVEsQ0FBQztRQUN6QyxrQkFBYSxHQUFHLEVBQUUsQ0FBQztRQUduQiwwQkFBcUIsR0FBRyxFQUFFLENBQUM7UUFDM0IsYUFBUSxHQUFHLFlBQVksQ0FBQyxNQUFNLENBQUM7UUFDOUIsaUJBQVksR0FBc0IsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUNyRCxvQkFBZSxHQUFzQixJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ3pELGVBQVUsR0FBRyxFQUFFLENBQUM7UUFFaEIsYUFBUSxHQUFHLEVBQUUsQ0FBQztRQUV2QixnQkFBVyxHQUFHLDRCQUE0QixDQUFDLHFCQUFxQixDQUFDO1FBRWpFLHFCQUFnQixHQUFJLEtBQUssQ0FBQztRQUMxQixzQkFBaUIsR0FBRyxLQUFLLENBQUM7UUFFMUIsa0JBQWEsR0FBWSxLQUFLLENBQUM7UUFDL0IsZUFBVSxHQUFZLEtBQUssQ0FBQztJQWdJOUIsQ0FBQzs7OztJQS9IQyxJQUFJLFdBQVcsS0FBSyxPQUFPLFdBQVcsQ0FBQyxDQUFDLENBQUM7Ozs7SUFF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Q0wsS0FBSzt1QkFDTCxLQUFLOzs7O0lBWk4sbUNBQWlCOztJQUNqQix5Q0FBdUI7O0lBQ3ZCLGdDQUFrRDs7SUFDbEQseUNBQTRCOztJQUM1QixtQ0FBMEI7O0lBQzFCLHlDQUFzQzs7SUFDdEMsaURBQW9DOztJQUNwQyxvQ0FBd0M7O0lBQ3hDLHdDQUErRDs7SUFDL0QsMkNBQWtFOztJQUNsRSxzQ0FBeUI7O0lBQ3pCLHVDQUFxQjs7SUFDckIsb0NBQXVCOztJQUV2Qix1Q0FBaUU7O0lBQ2pFLHVDQUFpQjs7SUFDakIsNENBQTBCOztJQUMxQiw2Q0FBMEI7O0lBQzFCLDBDQUF1Qjs7SUFDdkIseUNBQStCOztJQUMvQixzQ0FBNEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBNaW1lVHlwZU1hc3RlckRhdGEgfSBmcm9tICcuLy4uLy4uL3BpcGVzLW1vZHVsZS9taW1lLXR5cGUnO1xyXG5pbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIEV2ZW50RW1pdHRlciwgT3V0cHV0LCBRdWVyeUxpc3QsIFZpZXdDaGlsZCwgRWxlbWVudFJlZiwgUmVuZGVyZXIyLCBPbkNoYW5nZXMgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQ09NTU9OX0NPTlNVTVBUSU9OX0NPTlNUQU5UUyB9IGZyb20gJy4uLy4uL2NvbW1vbi1jb25zdW1wdGlvbi5jb25zdGFudHMnO1xyXG5pbXBvcnQgeyBJQnV0dG9uQ29uZmlnLCBQbGF0Zm9ybVR5cGUsIFRvY0NhcmRUeXBlIH0gZnJvbSAnLi4vbW9kZWxzJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnc2ItdG9jLWNhcmQnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi90b2MtY2FyZC5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vdG9jLWNhcmQuY29tcG9uZW50LnNjc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgVG9jQ2FyZENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcclxuICBASW5wdXQoKSBjb250ZW50O1xyXG4gIEBJbnB1dCgpIGFjdGl2ZUNvbnRlbnQ7XHJcbiAgQElucHV0KCkgdHlwZTogVG9jQ2FyZFR5cGUgPSBUb2NDYXJkVHlwZS5URVhUQk9PSztcclxuICBASW5wdXQoKSBjb250ZW50U3RhdHVzID0gW107XHJcbiAgQElucHV0KCkgcmVmcmVzaDogYm9vbGVhbjtcclxuICBASW5wdXQoKSBwbGF5QnRuQ29uZmlnOiBJQnV0dG9uQ29uZmlnO1xyXG4gIEBJbnB1dCgpIHRyYWNrYWJsZURlZmF1bHRJbWFnZSA9ICcnO1xyXG4gIEBJbnB1dCgpIHBsYXRmb3JtID0gUGxhdGZvcm1UeXBlLk1PQklMRTtcclxuICBAT3V0cHV0KCkgdG9jQ2FyZENsaWNrOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBAT3V0cHV0KCkgcGxheUJ1dHRvbkNsaWNrOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBASW5wdXQoKSBzY29yZUxhYmVsID0gJyc7XHJcbiAgQElucHV0KCkgbWF4QXR0ZW1wdHM7XHJcbiAgQElucHV0KCkgZGlzYWJsZWQgPSAnJztcclxuXHJcbiAgZmFsbGJhY2tJbWcgPSBDT01NT05fQ09OU1VNUFRJT05fQ09OU1RBTlRTLlRPQ19DQVJEX0ZBTExCQUNLX0lNRztcclxuICBpY29uUGF0aE1hcDogYW55O1xyXG4gIGlzQ29udGVudFN0YXJ0ZWQgID0gZmFsc2U7XHJcbiAgaXNDb3Vyc2VDb21wbGV0ZWQgPSBmYWxzZTtcclxuICBiZXN0U2NvcmVMYWJlbDogc3RyaW5nO1xyXG4gIGlzTGFzdEF0dGVtcHQ6IGJvb2xlYW4gPSBmYWxzZTtcclxuICBpc0Rpc2FibGVkOiBib29sZWFuID0gZmFsc2U7XHJcbiAgZ2V0IFRvY0NhcmRUeXBlKCkgeyByZXR1cm4gVG9jQ2FyZFR5cGU7IH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICBpZiAodGhpcy50eXBlID09PSBUb2NDYXJkVHlwZS5DT1VSU0UpIHtcclxuICAgICAgdGhpcy5jcmVhdGVJY29uTWFwKCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmdldEJlc3RTY29yZSgpO1xyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIGlmICh0aGlzLmFjdGl2ZUNvbnRlbnQgJiYgdGhpcy5hY3RpdmVDb250ZW50LnNiVW5pcXVlSWRlbnRpZmllciA9PT0gdGhpcy5jb250ZW50LnNiVW5pcXVlSWRlbnRpZmllcikge1xyXG4gICAgICAgIHRoaXMudG9jQ2FyZENsaWNrLmVtaXQoeyBldmVudDoge30sIGRhdGE6IHsgLi4udGhpcy5jb250ZW50IH0gfSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgaWYgKCF0aGlzLnBsYXlCdG5Db25maWcpIHtcclxuICAgICAgdGhpcy5wbGF5QnRuQ29uZmlnID0ge1xyXG4gICAgICAgIGxhYmVsOiAnUGxheScsXHJcbiAgICAgICAgc2hvdzogZmFsc2VcclxuICAgICAgfTtcclxuICAgIH1cclxuICAgIGlmICghdGhpcy5wbGF0Zm9ybSkge1xyXG4gICAgICB0aGlzLnBsYXRmb3JtID0gUGxhdGZvcm1UeXBlLk1PQklMRTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXMpIHtcclxuICAgIGlmIChjaGFuZ2VzICYmIGNoYW5nZXMuY29udGVudFN0YXR1cykge1xyXG4gICAgICBpZiAodGhpcy50eXBlID09PSBUb2NDYXJkVHlwZS5DT1VSU0UpIHtcclxuICAgICAgICB0aGlzLmNyZWF0ZUljb25NYXAoKTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLmdldEJlc3RTY29yZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGFzeW5jIG9uVG9jQ2FyZENsaWNrKGV2ZW50KSB7XHJcbiAgICBpZiAodGhpcy5pc0xhc3RBdHRlbXB0KSB7XHJcbiAgICAgIGV2ZW50LmlzTGFzdEF0dGVtcHQgPSB0cnVlO1xyXG4gICAgICB0aGlzLnRvY0NhcmRDbGljay5lbWl0KHsgZXZlbnQ6IGV2ZW50LCBkYXRhOiB7IC4uLnRoaXMuY29udGVudCB9IH0pO1xyXG4gICAgfSBlbHNlIGlmICh0aGlzLmlzRGlzYWJsZWQpIHtcclxuICAgICAgZXZlbnQuaXNEaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgIHRoaXMudG9jQ2FyZENsaWNrLmVtaXQoeyBldmVudDogZXZlbnQsIGRhdGE6IHsgLi4udGhpcy5jb250ZW50IH0gfSk7XHJcbiAgICB9IGVsc2UgaWYgKHRoaXMuYWN0aXZlQ29udGVudCAmJiB0aGlzLmFjdGl2ZUNvbnRlbnQuc2JVbmlxdWVJZGVudGlmaWVyICE9PSB0aGlzLmNvbnRlbnQuc2JVbmlxdWVJZGVudGlmaWVyKSB7XHJcbiAgICAgIHRoaXMudG9jQ2FyZENsaWNrLmVtaXQoeyBldmVudDogZXZlbnQsIGRhdGE6IHsgLi4udGhpcy5jb250ZW50IH0gfSk7XHJcbiAgICB9IGVsc2UgaWYgKHRoaXMudHlwZSA9IFRvY0NhcmRUeXBlLkNPVVJTRSkge1xyXG4gICAgICB0aGlzLnRvY0NhcmRDbGljay5lbWl0KHsgZXZlbnQ6IGV2ZW50LCBkYXRhOiB7IC4uLnRoaXMuY29udGVudCB9IH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY3JlYXRlSWNvbk1hcCgpIHtcclxuICAgIGNvbnN0IG1pbWVUeXBlc0RhdGEgPSBNaW1lVHlwZU1hc3RlckRhdGE7XHJcbiAgICB0aGlzLmlzQ291cnNlQ29tcGxldGVkID0gdGhpcy5jb250ZW50U3RhdHVzLmZpbmQoKGl0ZW0pID0+IHtcclxuICAgICAgaWYgKGl0ZW0uY29udGVudElkID09PSB0aGlzLmNvbnRlbnQuaWRlbnRpZmllciAmJiBpdGVtLnN0YXR1cyA9PT0gMikge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLmlzQ29udGVudFN0YXJ0ZWQgPSAhISh0aGlzLmNvbnRlbnRTdGF0dXMuZmluZCgoaXRlbSkgPT4ge1xyXG4gICAgICBpZiAoaXRlbS5jb250ZW50SWQgPT09IHRoaXMuY29udGVudC5pZGVudGlmaWVyICYmIGl0ZW0uc3RhdHVzID09PSAxKSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH1cclxuICAgIH0pKTtcclxuXHJcbiAgICBpZiAodGhpcy5pc0NvdXJzZUNvbXBsZXRlZCkge1xyXG4gICAgICB0aGlzLmNvbnRlbnQuYXBwSWNvbiA9ICdhc3NldHMvY29tbW9uLWNvbnN1bXB0aW9uL2ltYWdlcy9zcHJpdGUuc3ZnI2NpcmNsZS13aXRoLWNoZWNrLXN5bWJvbCc7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmljb25QYXRoTWFwID0gW1xyXG4gICAgICAgIFttaW1lVHlwZXNEYXRhLkNPTExFQ1RJT04sICdhc3NldHMvY29tbW9uLWNvbnN1bXB0aW9uL2ltYWdlcy9zcHJpdGUuc3ZnI2RvYyddLFxyXG4gICAgICAgIFttaW1lVHlwZXNEYXRhLlZJREVPLCAnYXNzZXRzL2NvbW1vbi1jb25zdW1wdGlvbi9pbWFnZXMvc3ByaXRlLnN2ZyNwbGF5J10sXHJcbiAgICAgICAgW21pbWVUeXBlc0RhdGEuQVVESU8sICdhc3NldHMvY29tbW9uLWNvbnN1bXB0aW9uL2ltYWdlcy9zcHJpdGUuc3ZnI3BsYXknXSxcclxuICAgICAgICBbbWltZVR5cGVzRGF0YS5JTlRFUkFDVElWRSwgJ2Fzc2V0cy9jb21tb24tY29uc3VtcHRpb24vaW1hZ2VzL3Nwcml0ZS5zdmcjdG91Y2gnXSxcclxuICAgICAgICBbbWltZVR5cGVzRGF0YS5ET0NTLCAnYXNzZXRzL2NvbW1vbi1jb25zdW1wdGlvbi9pbWFnZXMvc3ByaXRlLnN2ZyNkb2MnXSxcclxuICAgICAgXTtcclxuICAgICAgdGhpcy5jb250ZW50LmFwcEljb24gPSB0aGlzLmdldEljb25QYXRoKHRoaXMuY29udGVudC5taW1lVHlwZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBnZXRCZXN0U2NvcmUoKSB7XHJcbiAgICB0aGlzLmNvbnRlbnRTdGF0dXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xyXG4gICAgICBpZiAoaXRlbS5jb250ZW50SWQgPT09IHRoaXMuY29udGVudC5pZGVudGlmaWVyICYmIGl0ZW0uYmVzdFNjb3JlICYmIHRoaXMuc2NvcmVMYWJlbCAmJiB0aGlzLm1heEF0dGVtcHRzKSB7XHJcbiAgICAgICAgdGhpcy5iZXN0U2NvcmVMYWJlbCA9IHRoaXMuc2NvcmVMYWJlbCArICcgJyArIChNYXRoLnJvdW5kKGl0ZW0uYmVzdFNjb3JlLnRvdGFsU2NvcmUqMTAwKS8xMDApLnRvU3RyaW5nKCkgKyAnLycgKyBpdGVtLmJlc3RTY29yZS50b3RhbE1heFNjb3JlLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgaWYgKHRoaXMubWF4QXR0ZW1wdHMgLSBpdGVtLnNjb3JlLmxlbmd0aCA9PT0gMSkge1xyXG4gICAgICAgICAgdGhpcy5pc0xhc3RBdHRlbXB0ID0gdHJ1ZTtcclxuICAgICAgICAgIHRoaXMuaXNEaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoaXRlbS5zY29yZS5sZW5ndGggPj0gdGhpcy5tYXhBdHRlbXB0cykge1xyXG4gICAgICAgICAgdGhpcy5pc0Rpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgICAgIHRoaXMuaXNMYXN0QXR0ZW1wdCA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBnZXRJY29uUGF0aChjb250ZW50TWltZVR5cGU6IHN0cmluZykge1xyXG4gICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgdGhpcy5pY29uUGF0aE1hcCkge1xyXG4gICAgICBpZiAoa2V5LmluZGV4T2YoY29udGVudE1pbWVUeXBlKSA+PSAwKSB7XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gJyc7XHJcbiAgfVxyXG5cclxuICBvblBsYXlCdXR0b25DbGljayhldmVudCkge1xyXG4gICAgdGhpcy5wbGF5QnV0dG9uQ2xpY2suZW1pdCh7IGV2ZW50OiBldmVudCwgZGF0YTogeyAuLi50aGlzLmNvbnRlbnQgfSB9KTtcclxuICB9XHJcblxyXG4gIHN3YXBDYXJkKGNvbnRlbnQpIHtcclxuICAgIGlmICh0aGlzLnBsYXRmb3JtID09PSBQbGF0Zm9ybVR5cGUuTU9CSUxFKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLmlzVHJhY2thYmxlKGNvbnRlbnQpKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuXHJcbiAgaXNUcmFja2FibGUoY29udGVudCkge1xyXG4gICAgaWYgKChjb250ZW50LmNvbnRlbnREYXRhICYmIGNvbnRlbnQuY29udGVudERhdGEudHJhY2thYmxlICYmIGNvbnRlbnQuY29udGVudERhdGEudHJhY2thYmxlLmVuYWJsZWQgPT09ICdZZXMnKSB8fFxyXG4gICAgICAoY29udGVudC50cmFja2FibGUgJiYgY29udGVudC50cmFja2FibGUuZW5hYmxlZCA9PT0gJ1llcycpKSB7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgZ2V0Q29udGVudEltYWdlKGNvbnRlbnQpIHtcclxuICAgIGlmICh0aGlzLmlzVHJhY2thYmxlKGNvbnRlbnQpICYmIHRoaXMudHJhY2thYmxlRGVmYXVsdEltYWdlKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnRyYWNrYWJsZURlZmF1bHRJbWFnZTtcclxuICAgIH1cclxuICAgIHJldHVybiBjb250ZW50LmFwcEljb24gfHwgKGNvbnRlbnQuY29udGVudERhdGEgJiYgY29udGVudC5jb250ZW50RGF0YS5hcHBJY29uKTtcclxuICB9XHJcbn1cclxuIl19