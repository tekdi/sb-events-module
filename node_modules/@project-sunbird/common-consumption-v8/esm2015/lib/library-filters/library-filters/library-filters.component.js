/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter } from '@angular/core';
import { LibraryFiltersLayout, TocMimeTypes } from './models';
export class LibraryFiltersComponent {
    constructor() {
        this.selectedFilter = new EventEmitter();
        this.selectedMimeType = new EventEmitter();
        this.TocMimeTypesMaster = [
            { name: 'all', value: ['all'] },
            {
                name: 'video', value: ['video/mp4', 'video/x-youtube', 'video/webm']
            },
            {
                name: 'docs', value: ['application/pdf', 'application/epub', 'application/msword']
            },
            {
                name: 'interactive',
                value: ['application/vnd.ekstep.ecml-archive', 'application/vnd.ekstep.h5p-archive', 'application/vnd.ekstep.html-archive'],
            },
        ];
    }
    /**
     * @return {?}
     */
    get LibraryFiltersLayout() { return LibraryFiltersLayout; }
    /**
     * @return {?}
     */
    get TocMimeTypes() { return TocMimeTypes; }
    /**
     * @param {?} input
     * @return {?}
     */
    fetchCorrespondingTypes(input) {
        /** @type {?} */
        let type = '';
        switch (input) {
            case TocMimeTypes.ALL:
                type = TocMimeTypes.ALL;
                break;
            case TocMimeTypes.AUDIO:
                type = TocMimeTypes.AUDIO;
                break;
            case TocMimeTypes.COLLECTION:
                type = TocMimeTypes.COLLECTION;
                break;
            case TocMimeTypes.DOCS:
                type = TocMimeTypes.DOCS;
                break;
            case TocMimeTypes.INTERACTIVE:
                type = TocMimeTypes.INTERACTIVE;
                break;
            case TocMimeTypes.VIDEO:
                type = TocMimeTypes.VIDEO;
                break;
        }
        return type;
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (this.layout === LibraryFiltersLayout.ROUND_WITH_ICONS) {
            if (this.tocList) {
                this.filterList = this.tocList.map((/**
                 * @param {?} item
                 * @param {?} index
                 * @return {?}
                 */
                (item, index) => {
                    /** @type {?} */
                    let type = this.fetchCorrespondingTypes(item.value);
                    if (this.selectedItems && this.selectedItems.includes(index)) {
                        return ({ text: item.text, selected: true, type: type });
                    }
                    else if (!this.selectedItems && type === TocMimeTypes.ALL) {
                        return ({ text: item.text, selected: true, type: type });
                    }
                    else {
                        return ({ text: item.text, selected: false, type: type });
                    }
                }));
            }
            else if (this.list) {
                this.filterList = this.list.map((/**
                 * @param {?} item
                 * @param {?} index
                 * @return {?}
                 */
                (item, index) => {
                    /** @type {?} */
                    let type = this.fetchCorrespondingTypes(item);
                    if (this.selectedItems && this.selectedItems.includes(index)) {
                        return ({ text: item, selected: true, type: type });
                    }
                    else if (!this.selectedItems && item === TocMimeTypes.ALL) {
                        return ({ text: item, selected: true, type: type });
                    }
                    else {
                        return ({ text: item, selected: false, type: type });
                    }
                }));
            }
        }
        else {
            if (this.list) {
                this.filterList = this.list.map((/**
                 * @param {?} item
                 * @param {?} index
                 * @return {?}
                 */
                (item, index) => {
                    if (this.selectedItems && this.selectedItems.includes(index)) {
                        return ({ text: item, selected: true });
                    }
                    else {
                        return ({ text: item, selected: false });
                    }
                }));
            }
        }
    }
    /**
     * @param {?} event
     * @param {?} index
     * @return {?}
     */
    selectPill(event, index) {
        this.filterList = this.filterList.map((/**
         * @param {?} e
         * @return {?}
         */
        e => (Object.assign({}, e, { selected: false }))));
        try {
            this.filterList[index].selected = true;
            this.selectedFilter.emit({ event: event, data: Object.assign({}, this.filterList[index], { index }) });
            // animation code
            /** @type {?} */
            let el = document.getElementById('class' + index);
            if (el) {
                el.scrollIntoView({ behavior: 'smooth', block: 'end', inline: 'start' });
            }
            else {
                setTimeout((/**
                 * @return {?}
                 */
                () => {
                    el = document.getElementById('class' + index);
                    if (el) {
                        el.scrollIntoView({ behavior: 'smooth', block: 'end', inline: 'start' });
                    }
                }), 1000);
            }
        }
        catch (error) {
            console.error('Error in selectPill method', error);
        }
    }
    /**
     * @param {?} event
     * @param {?} index
     * @return {?}
     */
    selectMimeFilter(event, index) {
        /** @type {?} */
        let outputType = {};
        this.filterList = this.filterList.map((/**
         * @param {?} e
         * @return {?}
         */
        e => (Object.assign({}, e, { selected: false }))));
        try {
            this.filterList[index].selected = true;
            this.TocMimeTypesMaster.map((/**
             * @param {?} mimeType
             * @return {?}
             */
            mimeType => {
                if (mimeType.name === this.filterList[index].type) {
                    outputType = {
                        event: event,
                        data: Object.assign({ value: mimeType.value }, this.filterList[index], { index })
                    };
                }
            }));
            this.selectedMimeType.emit(Object.assign({}, outputType));
            // animation code
            /** @type {?} */
            let el = document.getElementById('mimeType' + index);
            if (el) {
                el.scrollIntoView({ behavior: 'smooth', block: 'end', inline: 'start' });
            }
            else {
                setTimeout((/**
                 * @return {?}
                 */
                () => {
                    el = document.getElementById('mimeType' + index);
                    if (el) {
                        el.scrollIntoView({ behavior: 'smooth', block: 'end', inline: 'start' });
                    }
                }), 1000);
            }
        }
        catch (error) {
            console.error('Error in selectPill method', error);
        }
    }
}
LibraryFiltersComponent.decorators = [
    { type: Component, args: [{
                selector: 'sb-library-filters',
                template: "<div class=\"fixed-container\">\r\n    <!-- Library medium filter -->\r\n    <div *ngIf=\"layout === LibraryFiltersLayout.SQUARE\" class=\"sb-slider-pills-container\">\r\n        <div class=\"sb-pills-container sb-medium-pills-container\" id=\"mediumScroll\">\r\n            <div class=\"pill\" *ngFor=\"let item of filterList; let i = index;\" [ngClass]=\"{'active': item?.selected}\"\r\n                attr.id=\"medium{{i}}\" (click)=\"selectPill($event, i)\">{{item.text}} medium\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <!-- Library class/grade filter -->\r\n    <div *ngIf=\"layout === LibraryFiltersLayout.ROUND\" class=\"sb-slider-pills-container\">\r\n        <div class=\"sb-pills-container sb-grade-pills-container\" id=\"gradeScroll\">\r\n            <div class=\"pill rounded\" *ngFor=\"let item of filterList; let i = index;\"\r\n                [ngClass]=\"{'active': item?.selected}\" attr.id=\"class{{i}}\" (click)=\"selectPill($event, i)\">\r\n                {{item.text}}</div>\r\n        </div>\r\n    </div>\r\n    <!-- Player page content filters -->\r\n    <div *ngIf=\"layout === LibraryFiltersLayout.ROUND_WITH_ICONS\" class=\"sb-slider-pills-container\">\r\n        <div class=\"sb-pills-container sb-grade-pills-container\" id=\"gradeScroll\">\r\n            <div class=\"pill rounded rounded-with-icon\" *ngFor=\"let item of filterList; let i = index;\"\r\n                [ngClass]=\"{'active': item?.selected}\" attr.id=\"mimeType{{i}}\" (click)=\"selectMimeFilter($event, i)\">\r\n                <ng-container *ngIf=\"item?.type === TocMimeTypes.VIDEO \">\r\n                    <i class=\"icon-svg icon-svg--xs icon-videos\" >\r\n                        <svg class=\"icon icon-svg--primary\">\r\n                            <use xlink:href=\"assets/common-consumption/images/sprite.svg#play\"></use>\r\n                        </svg>\r\n                    </i>\r\n                </ng-container>\r\n                <ng-container *ngIf=\"item?.type === TocMimeTypes.DOCS \">\r\n                    <i class=\"icon-svg icon-svg--xs icon-docs\" >\r\n                        <svg class=\"icon icon-svg--primary\">\r\n                            <use xlink:href=\"assets/common-consumption/images/sprite.svg#doc\"></use>\r\n                        </svg>\r\n                    </i>\r\n                </ng-container>\r\n                <ng-container *ngIf=\"item?.type === TocMimeTypes.INTERACTIVE \">\r\n                    <i class=\"icon-svg icon-svg--xs icon-touch\" >\r\n                        <svg class=\"icon icon-svg--primary\">\r\n                            <use xlink:href=\"assets/common-consumption/images/sprite.svg#touch\"></use>\r\n                        </svg>\r\n                    </i>\r\n                </ng-container>\r\n                <span class=\"name\">{{item.text}}</span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>",
                styles: [":host .fixed-container{width:100%;position:relative;z-index:2}:host .sb-slider-pills-container{overflow-x:auto}:host .sb-slider-pills-container .sb-pills-container{display:inline-flex;align-items:center;box-sizing:border-box}[dir=ltr] :host .sb-slider-pills-container .sb-pills-container,[dir=rtl] :host .sb-slider-pills-container .sb-pills-container{padding:1rem}:host .sb-slider-pills-container .sb-pills-container .pill{background-color:var(--white);white-space:nowrap;-webkit-appearance:none;text-overflow:ellipsis;min-height:2rem;cursor:pointer;transition:.25s ease-in-out;border-radius:.125rem;text-transform:capitalize;text-decoration:none;text-align:center;font-weight:400;font-style:normal;font-stretch:normal;font-size:.75rem;box-sizing:border-box;display:flex;align-items:center;line-height:1rem}[dir=ltr] :host .sb-slider-pills-container .sb-pills-container .pill{margin-right:.5rem}[dir=rtl] :host .sb-slider-pills-container .sb-pills-container .pill{margin-left:.5rem}[dir=ltr] :host .sb-slider-pills-container .sb-pills-container .pill,[dir=rtl] :host .sb-slider-pills-container .sb-pills-container .pill{padding:.25rem .5rem}[dir=ltr] :host .sb-slider-pills-container .sb-pills-container .pill:last-child{margin-right:.5rem}[dir=rtl] :host .sb-slider-pills-container .sb-pills-container .pill:last-child{margin-left:.5rem}:host .sb-slider-pills-container .sb-medium-pills-container{min-height:4rem;background:var(--white);min-width:100%}:host .sb-slider-pills-container .sb-medium-pills-container .pill{border:var(--secondary-color) .0625rem solid;color:var(--secondary-color)}:host .sb-slider-pills-container .sb-medium-pills-container .pill.active,:host .sb-slider-pills-container .sb-medium-pills-container .pill:active,:host .sb-slider-pills-container .sb-medium-pills-container .pill:hover{color:var(--white);background-color:var(--secondary-color);box-shadow:0 3px 4px 0 rgba(var(--rc-rgba-black),.19)}:host .sb-slider-pills-container .sb-grade-pills-container{min-height:3rem;background:var(--gray-0);min-width:100%}:host .sb-slider-pills-container .sb-grade-pills-container .pill{border-radius:1rem;color:var(--primary-color);min-height:2rem}[dir=ltr] :host .sb-slider-pills-container .sb-grade-pills-container .pill,[dir=rtl] :host .sb-slider-pills-container .sb-grade-pills-container .pill{padding:.25rem 1rem}:host .sb-slider-pills-container .sb-grade-pills-container .pill.active,:host .sb-slider-pills-container .sb-grade-pills-container .pill:active,:host .sb-slider-pills-container .sb-grade-pills-container .pill:hover{background-color:var(--primary-color);color:var(--white);box-shadow:0 3px 4px 0 rgba(var(--rc-rgba-black),.19)}:host .sb-slider-pills-container .sb-grade-pills-container .pill.active .icon-svg svg,:host .sb-slider-pills-container .sb-grade-pills-container .pill:active .icon-svg svg,:host .sb-slider-pills-container .sb-grade-pills-container .pill:hover .icon-svg svg{fill:var(--white)}:host .sb-slider-pills-container .sb-grade-pills-container .pill.rounded{font-size:.875rem}:host .sb-slider-pills-container .sb-grade-pills-container .pill.rounded-with-icon .icon-svg{margin-right:.25rem;top:0}html[dir=rtl] :host .sb-slider-pills-container .sb-grade-pills-container .pill.rounded-with-icon .icon-svg{margin-left:.25rem;margin-right:inherit}:host .sb-slider-pills-container .sb-grade-pills-container .pill.rounded-with-icon .name{-ms-grid-row-align:center;align-self:center;display:inline-block;line-height:1rem}"]
            }] }
];
LibraryFiltersComponent.propDecorators = {
    list: [{ type: Input }],
    tocList: [{ type: Input }],
    selectedItems: [{ type: Input }],
    layout: [{ type: Input }],
    selectedFilter: [{ type: Output }],
    selectedMimeType: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    LibraryFiltersComponent.prototype.list;
    /** @type {?} */
    LibraryFiltersComponent.prototype.tocList;
    /** @type {?} */
    LibraryFiltersComponent.prototype.selectedItems;
    /** @type {?} */
    LibraryFiltersComponent.prototype.layout;
    /** @type {?} */
    LibraryFiltersComponent.prototype.selectedFilter;
    /** @type {?} */
    LibraryFiltersComponent.prototype.selectedMimeType;
    /** @type {?} */
    LibraryFiltersComponent.prototype.TocMimeTypesMaster;
    /** @type {?} */
    LibraryFiltersComponent.prototype.filterList;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlicmFyeS1maWx0ZXJzLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bwcm9qZWN0LXN1bmJpcmQvY29tbW9uLWNvbnN1bXB0aW9uLXY4LyIsInNvdXJjZXMiOlsibGliL2xpYnJhcnktZmlsdGVycy9saWJyYXJ5LWZpbHRlcnMvbGlicmFyeS1maWx0ZXJzLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBYSxNQUFNLGVBQWUsQ0FBQztBQUNsRixPQUFPLEVBQUUsb0JBQW9CLEVBQWdDLFlBQVksRUFBRSxNQUFNLFVBQVUsQ0FBQztBQVE1RixNQUFNLE9BQU8sdUJBQXVCO0lBTnBDO1FBWWMsbUJBQWMsR0FBa0MsSUFBSSxZQUFZLEVBQW1CLENBQUM7UUFDcEYscUJBQWdCLEdBQXNCLElBQUksWUFBWSxFQUFFLENBQUM7UUFFNUQsdUJBQWtCLEdBQUc7WUFDeEIsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQy9CO2dCQUNFLElBQUksRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLENBQUMsV0FBVyxFQUFFLGlCQUFpQixFQUFFLFlBQVksQ0FBQzthQUNyRTtZQUNEO2dCQUNFLElBQUksRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLENBQUMsaUJBQWlCLEVBQUUsa0JBQWtCLEVBQUUsb0JBQW9CLENBQUM7YUFDbkY7WUFDRDtnQkFDRSxJQUFJLEVBQUUsYUFBYTtnQkFDbkIsS0FBSyxFQUFFLENBQUMscUNBQXFDLEVBQUUsb0NBQW9DLEVBQUUscUNBQXFDLENBQUM7YUFDNUg7U0FFRixDQUFDO0lBMkhSLENBQUM7Ozs7SUF2SEcsSUFBSSxvQkFBb0IsS0FBSyxPQUFPLG9CQUFvQixDQUFDLENBQUMsQ0FBQzs7OztJQUMzRCxJQUFJLFlBQVksS0FBSyxPQUFPLFlBQVksQ0FBQyxDQUFDLENBQUM7Ozs7O0lBRTNDLHVCQUF1QixDQUFDLEtBQVk7O1lBQzVCLElBQUksR0FBRyxFQUFFO1FBQ2IsUUFBUSxLQUFLLEVBQUU7WUFDWCxLQUFLLFlBQVksQ0FBQyxHQUFHO2dCQUFFLElBQUksR0FBRyxZQUFZLENBQUMsR0FBRyxDQUFDO2dCQUMzQyxNQUFNO1lBQ1YsS0FBSyxZQUFZLENBQUMsS0FBSztnQkFBRSxJQUFJLEdBQUcsWUFBWSxDQUFDLEtBQUssQ0FBQztnQkFDL0MsTUFBTTtZQUNWLEtBQUssWUFBWSxDQUFDLFVBQVU7Z0JBQUUsSUFBSSxHQUFHLFlBQVksQ0FBQyxVQUFVLENBQUM7Z0JBQ3pELE1BQU07WUFDVixLQUFLLFlBQVksQ0FBQyxJQUFJO2dCQUFFLElBQUksR0FBRyxZQUFZLENBQUMsSUFBSSxDQUFDO2dCQUM3QyxNQUFNO1lBQ1YsS0FBSyxZQUFZLENBQUMsV0FBVztnQkFBRSxJQUFJLEdBQUcsWUFBWSxDQUFDLFdBQVcsQ0FBQztnQkFDM0QsTUFBTTtZQUNWLEtBQUssWUFBWSxDQUFDLEtBQUs7Z0JBQUUsSUFBSSxHQUFHLFlBQVksQ0FBQyxLQUFLLENBQUM7Z0JBQy9DLE1BQU07U0FDYjtRQUNELE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7Ozs7O0lBRUQsV0FBVyxDQUFDLE9BQU87UUFDZixJQUFJLElBQUksQ0FBQyxNQUFNLEtBQUssb0JBQW9CLENBQUMsZ0JBQWdCLEVBQUU7WUFDdkQsSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFO2dCQUNkLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHOzs7OztnQkFBQyxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsRUFBRTs7d0JBQzNDLElBQUksR0FBRyxJQUFJLENBQUMsdUJBQXVCLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQztvQkFDbkQsSUFBSSxJQUFJLENBQUMsYUFBYSxJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxFQUFFO3dCQUMxRCxPQUFPLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO3FCQUM1RDt5QkFBTSxJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsSUFBSSxJQUFJLEtBQUssWUFBWSxDQUFDLEdBQUcsRUFBRTt3QkFDekQsT0FBTyxDQUFDLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztxQkFDNUQ7eUJBQU07d0JBQ0gsT0FBTyxDQUFDLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztxQkFDN0Q7Z0JBQ0wsQ0FBQyxFQUFDLENBQUM7YUFDTjtpQkFBTSxJQUFHLElBQUksQ0FBQyxJQUFJLEVBQUU7Z0JBQ2pCLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHOzs7OztnQkFBQyxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsRUFBRTs7d0JBQ3hDLElBQUksR0FBRyxJQUFJLENBQUMsdUJBQXVCLENBQUMsSUFBSSxDQUFDO29CQUM3QyxJQUFJLElBQUksQ0FBQyxhQUFhLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLEVBQUU7d0JBQzFELE9BQU8sQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztxQkFDdkQ7eUJBQU0sSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLElBQUksSUFBSSxLQUFLLFlBQVksQ0FBQyxHQUFHLEVBQUU7d0JBQ3pELE9BQU8sQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztxQkFDdkQ7eUJBQU07d0JBQ0gsT0FBTyxDQUFDLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO3FCQUN4RDtnQkFDTCxDQUFDLEVBQUMsQ0FBQzthQUNOO1NBQ0o7YUFBTTtZQUNILElBQUksSUFBSSxDQUFDLElBQUksRUFBRTtnQkFDWCxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRzs7Ozs7Z0JBQUMsQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLEVBQUU7b0JBQzVDLElBQUksSUFBSSxDQUFDLGFBQWEsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsRUFBRTt3QkFDMUQsT0FBTyxDQUFDLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztxQkFDM0M7eUJBQU07d0JBQ0gsT0FBTyxDQUFDLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztxQkFDNUM7Z0JBQ0wsQ0FBQyxFQUFDLENBQUM7YUFDTjtTQUNKO0lBQ0wsQ0FBQzs7Ozs7O0lBRUQsVUFBVSxDQUFDLEtBQWlCLEVBQUUsS0FBYTtRQUN2QyxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsR0FBRzs7OztRQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsbUJBQU0sQ0FBQyxJQUFFLFFBQVEsRUFBRSxLQUFLLElBQUcsRUFBQyxDQUFDO1FBRXhFLElBQUk7WUFDQSxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7WUFDdkMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLElBQUksb0JBQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsSUFBRSxLQUFLLEdBQUUsRUFBRSxDQUFDLENBQUM7OztnQkFHbkYsRUFBRSxHQUF1QixRQUFRLENBQUMsY0FBYyxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUM7WUFDckUsSUFBSSxFQUFFLEVBQUU7Z0JBQ0osRUFBRSxDQUFDLGNBQWMsQ0FBQyxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQzthQUM1RTtpQkFBTTtnQkFDSCxVQUFVOzs7Z0JBQUMsR0FBRyxFQUFFO29CQUNaLEVBQUUsR0FBRyxRQUFRLENBQUMsY0FBYyxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUMsQ0FBQztvQkFDOUMsSUFBSSxFQUFFLEVBQUU7d0JBQ0osRUFBRSxDQUFDLGNBQWMsQ0FBQyxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQztxQkFDNUU7Z0JBQ0wsQ0FBQyxHQUFFLElBQUksQ0FBQyxDQUFDO2FBQ1o7U0FDSjtRQUFDLE9BQU8sS0FBSyxFQUFFO1lBQ1osT0FBTyxDQUFDLEtBQUssQ0FBQyw0QkFBNEIsRUFBRSxLQUFLLENBQUMsQ0FBQztTQUN0RDtJQUNMLENBQUM7Ozs7OztJQUVELGdCQUFnQixDQUFDLEtBQUssRUFBRSxLQUFLOztZQUN0QixVQUFVLEdBQUcsRUFBRTtRQUNsQixJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsR0FBRzs7OztRQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsbUJBQU0sQ0FBQyxJQUFFLFFBQVEsRUFBRSxLQUFLLElBQUcsRUFBQyxDQUFDO1FBQ3hFLElBQUk7WUFDQSxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7WUFDdkMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEdBQUc7Ozs7WUFBQyxRQUFRLENBQUMsRUFBRTtnQkFDbkMsSUFBSSxRQUFRLENBQUMsSUFBSSxLQUFLLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxFQUFFO29CQUMvQyxVQUFVLEdBQUc7d0JBQ1QsS0FBSyxFQUFFLEtBQUs7d0JBQ1osSUFBSSxrQkFDQSxLQUFLLEVBQUUsUUFBUSxDQUFDLEtBQUssSUFDbEIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsSUFDekIsS0FBSyxHQUNSO3FCQUNKLENBQUM7aUJBQ0w7WUFDTCxDQUFDLEVBQUMsQ0FBQztZQUNILElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLG1CQUFLLFVBQVUsRUFBRSxDQUFDOzs7Z0JBRXhDLEVBQUUsR0FBdUIsUUFBUSxDQUFDLGNBQWMsQ0FBQyxVQUFVLEdBQUcsS0FBSyxDQUFDO1lBQ3hFLElBQUksRUFBRSxFQUFFO2dCQUNKLEVBQUUsQ0FBQyxjQUFjLENBQUMsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUM7YUFDNUU7aUJBQU07Z0JBQ0gsVUFBVTs7O2dCQUFDLEdBQUcsRUFBRTtvQkFDWixFQUFFLEdBQUcsUUFBUSxDQUFDLGNBQWMsQ0FBQyxVQUFVLEdBQUcsS0FBSyxDQUFDLENBQUM7b0JBQ2pELElBQUksRUFBRSxFQUFFO3dCQUNKLEVBQUUsQ0FBQyxjQUFjLENBQUMsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUM7cUJBQzVFO2dCQUNMLENBQUMsR0FBRSxJQUFJLENBQUMsQ0FBQzthQUNaO1NBRUo7UUFBQyxPQUFPLEtBQUssRUFBRTtZQUNaLE9BQU8sQ0FBQyxLQUFLLENBQUMsNEJBQTRCLEVBQUUsS0FBSyxDQUFDLENBQUM7U0FDdEQ7SUFDTCxDQUFDOzs7WUF0SkosU0FBUyxTQUFDO2dCQUNQLFFBQVEsRUFBRSxvQkFBb0I7Z0JBQzlCLG0zRkFBK0M7O2FBRWxEOzs7bUJBSUksS0FBSztzQkFDTCxLQUFLOzRCQUNMLEtBQUs7cUJBQ0wsS0FBSzs2QkFDTCxNQUFNOytCQUNOLE1BQU07Ozs7SUFMUCx1Q0FBd0I7O0lBQ3hCLDBDQUFpQjs7SUFDakIsZ0RBQWlDOztJQUNqQyx5Q0FBc0M7O0lBQ3RDLGlEQUE4Rjs7SUFDOUYsbURBQW1FOztJQUVuRSxxREFhSTs7SUFFSiw2Q0FBMEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgT25DaGFuZ2VzIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IExpYnJhcnlGaWx0ZXJzTGF5b3V0LCBJRmlsdGVySXRlbSwgSVNlbGVjdGVkRmlsdGVyLCBUb2NNaW1lVHlwZXMgfSBmcm9tICcuL21vZGVscyc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnc2ItbGlicmFyeS1maWx0ZXJzJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9saWJyYXJ5LWZpbHRlcnMuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgc3R5bGVVcmxzOiBbJy4vbGlicmFyeS1maWx0ZXJzLmNvbXBvbmVudC5zY3NzJ11cclxufSlcclxuXHJcbmV4cG9ydCBjbGFzcyBMaWJyYXJ5RmlsdGVyc0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uQ2hhbmdlcyB7XHJcblxyXG4gICAgQElucHV0KCkgbGlzdDogc3RyaW5nW107XHJcbiAgICBASW5wdXQoKSB0b2NMaXN0O1xyXG4gICAgQElucHV0KCkgc2VsZWN0ZWRJdGVtczogbnVtYmVyW107XHJcbiAgICBASW5wdXQoKSBsYXlvdXQ6IExpYnJhcnlGaWx0ZXJzTGF5b3V0O1xyXG4gICAgQE91dHB1dCgpIHNlbGVjdGVkRmlsdGVyOiBFdmVudEVtaXR0ZXI8SVNlbGVjdGVkRmlsdGVyPiA9IG5ldyBFdmVudEVtaXR0ZXI8SVNlbGVjdGVkRmlsdGVyPigpO1xyXG4gICAgQE91dHB1dCgpIHNlbGVjdGVkTWltZVR5cGU6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICAgIHB1YmxpYyBUb2NNaW1lVHlwZXNNYXN0ZXIgPSBbXHJcbiAgICAgICAgeyBuYW1lOiAnYWxsJywgdmFsdWU6IFsnYWxsJ10gfSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICBuYW1lOiAndmlkZW8nLCB2YWx1ZTogWyd2aWRlby9tcDQnLCAndmlkZW8veC15b3V0dWJlJywgJ3ZpZGVvL3dlYm0nXVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgbmFtZTogJ2RvY3MnLCB2YWx1ZTogWydhcHBsaWNhdGlvbi9wZGYnLCAnYXBwbGljYXRpb24vZXB1YicsICdhcHBsaWNhdGlvbi9tc3dvcmQnXVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgbmFtZTogJ2ludGVyYWN0aXZlJyxcclxuICAgICAgICAgIHZhbHVlOiBbJ2FwcGxpY2F0aW9uL3ZuZC5la3N0ZXAuZWNtbC1hcmNoaXZlJywgJ2FwcGxpY2F0aW9uL3ZuZC5la3N0ZXAuaDVwLWFyY2hpdmUnLCAnYXBwbGljYXRpb24vdm5kLmVrc3RlcC5odG1sLWFyY2hpdmUnXSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIC8vIHsgbmFtZTogJ0FVRElPUycsIHZhbHVlOiBNaW1lVHlwZS5BVURJTywgaWNvbk5vcm1hbDogJy4vYXNzZXRzL2ltZ3MvYXVkaW8uc3ZnJywgaWNvbkFjdGl2ZTogJy4vYXNzZXRzL2ltZ3MvYXVkaW8tYWN0aXZlLnN2Zyd9LFxyXG4gICAgICBdO1xyXG5cclxuICAgIGZpbHRlckxpc3Q6IElGaWx0ZXJJdGVtW107XHJcblxyXG4gICAgZ2V0IExpYnJhcnlGaWx0ZXJzTGF5b3V0KCkgeyByZXR1cm4gTGlicmFyeUZpbHRlcnNMYXlvdXQ7IH1cclxuICAgIGdldCBUb2NNaW1lVHlwZXMoKSB7IHJldHVybiBUb2NNaW1lVHlwZXM7IH1cclxuICAgIFxyXG4gICAgZmV0Y2hDb3JyZXNwb25kaW5nVHlwZXMoaW5wdXQ6U3RyaW5nKSB7XHJcbiAgICAgICAgbGV0IHR5cGUgPSAnJztcclxuICAgICAgICBzd2l0Y2ggKGlucHV0KSB7XHJcbiAgICAgICAgICAgIGNhc2UgVG9jTWltZVR5cGVzLkFMTDogdHlwZSA9IFRvY01pbWVUeXBlcy5BTEw7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBUb2NNaW1lVHlwZXMuQVVESU86IHR5cGUgPSBUb2NNaW1lVHlwZXMuQVVESU87XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBUb2NNaW1lVHlwZXMuQ09MTEVDVElPTjogdHlwZSA9IFRvY01pbWVUeXBlcy5DT0xMRUNUSU9OO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgVG9jTWltZVR5cGVzLkRPQ1M6IHR5cGUgPSBUb2NNaW1lVHlwZXMuRE9DUztcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFRvY01pbWVUeXBlcy5JTlRFUkFDVElWRTogdHlwZSA9IFRvY01pbWVUeXBlcy5JTlRFUkFDVElWRTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFRvY01pbWVUeXBlcy5WSURFTzogdHlwZSA9IFRvY01pbWVUeXBlcy5WSURFTztcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdHlwZTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzKSB7XHJcbiAgICAgICAgaWYgKHRoaXMubGF5b3V0ID09PSBMaWJyYXJ5RmlsdGVyc0xheW91dC5ST1VORF9XSVRIX0lDT05TKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnRvY0xpc3QpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVyTGlzdCA9IHRoaXMudG9jTGlzdC5tYXAoKGl0ZW0sIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHR5cGUgPSB0aGlzLmZldGNoQ29ycmVzcG9uZGluZ1R5cGVzKGl0ZW0udmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkSXRlbXMgJiYgdGhpcy5zZWxlY3RlZEl0ZW1zLmluY2x1ZGVzKGluZGV4KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKHsgdGV4dDogaXRlbS50ZXh0LCBzZWxlY3RlZDogdHJ1ZSwgdHlwZTogdHlwZSB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCF0aGlzLnNlbGVjdGVkSXRlbXMgJiYgdHlwZSA9PT0gVG9jTWltZVR5cGVzLkFMTCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKHsgdGV4dDogaXRlbS50ZXh0LCBzZWxlY3RlZDogdHJ1ZSwgdHlwZTogdHlwZSB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKHsgdGV4dDogaXRlbS50ZXh0LCBzZWxlY3RlZDogZmFsc2UsIHR5cGU6IHR5cGUgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZih0aGlzLmxpc3QpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVyTGlzdCA9IHRoaXMubGlzdC5tYXAoKGl0ZW0sIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHR5cGUgPSB0aGlzLmZldGNoQ29ycmVzcG9uZGluZ1R5cGVzKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkSXRlbXMgJiYgdGhpcy5zZWxlY3RlZEl0ZW1zLmluY2x1ZGVzKGluZGV4KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKHsgdGV4dDogaXRlbSwgc2VsZWN0ZWQ6IHRydWUsIHR5cGU6IHR5cGUgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICghdGhpcy5zZWxlY3RlZEl0ZW1zICYmIGl0ZW0gPT09IFRvY01pbWVUeXBlcy5BTEwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICh7IHRleHQ6IGl0ZW0sIHNlbGVjdGVkOiB0cnVlLCB0eXBlOiB0eXBlIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoeyB0ZXh0OiBpdGVtLCBzZWxlY3RlZDogZmFsc2UsIHR5cGU6IHR5cGUgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5saXN0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpbHRlckxpc3QgPSB0aGlzLmxpc3QubWFwKChpdGVtLCBpbmRleCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkSXRlbXMgJiYgdGhpcy5zZWxlY3RlZEl0ZW1zLmluY2x1ZGVzKGluZGV4KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKHsgdGV4dDogaXRlbSwgc2VsZWN0ZWQ6IHRydWUgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICh7IHRleHQ6IGl0ZW0sIHNlbGVjdGVkOiBmYWxzZSB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzZWxlY3RQaWxsKGV2ZW50OiBNb3VzZUV2ZW50LCBpbmRleDogbnVtYmVyKSB7XHJcbiAgICAgICAgdGhpcy5maWx0ZXJMaXN0ID0gdGhpcy5maWx0ZXJMaXN0Lm1hcChlID0+ICh7IC4uLmUsIHNlbGVjdGVkOiBmYWxzZSB9KSk7XHJcblxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyTGlzdFtpbmRleF0uc2VsZWN0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkRmlsdGVyLmVtaXQoeyBldmVudDogZXZlbnQsIGRhdGE6IHsgLi4udGhpcy5maWx0ZXJMaXN0W2luZGV4XSwgaW5kZXggfSB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vIGFuaW1hdGlvbiBjb2RlXHJcbiAgICAgICAgICAgIGxldCBlbDogSFRNTEVsZW1lbnQgfCBudWxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NsYXNzJyArIGluZGV4KTtcclxuICAgICAgICAgICAgaWYgKGVsKSB7XHJcbiAgICAgICAgICAgICAgICBlbC5zY3JvbGxJbnRvVmlldyh7IGJlaGF2aW9yOiAnc21vb3RoJywgYmxvY2s6ICdlbmQnLCBpbmxpbmU6ICdzdGFydCcgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjbGFzcycgKyBpbmRleCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsLnNjcm9sbEludG9WaWV3KHsgYmVoYXZpb3I6ICdzbW9vdGgnLCBibG9jazogJ2VuZCcsIGlubGluZTogJ3N0YXJ0JyB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LCAxMDAwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHNlbGVjdFBpbGwgbWV0aG9kJywgZXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzZWxlY3RNaW1lRmlsdGVyKGV2ZW50LCBpbmRleCkge1xyXG4gICAgICAgbGV0IG91dHB1dFR5cGUgPSB7fTtcclxuICAgICAgICB0aGlzLmZpbHRlckxpc3QgPSB0aGlzLmZpbHRlckxpc3QubWFwKGUgPT4gKHsgLi4uZSwgc2VsZWN0ZWQ6IGZhbHNlIH0pKTtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICB0aGlzLmZpbHRlckxpc3RbaW5kZXhdLnNlbGVjdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGhpcy5Ub2NNaW1lVHlwZXNNYXN0ZXIubWFwKG1pbWVUeXBlID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChtaW1lVHlwZS5uYW1lID09PSB0aGlzLmZpbHRlckxpc3RbaW5kZXhdLnR5cGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBvdXRwdXRUeXBlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudDogZXZlbnQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBtaW1lVHlwZS52YWx1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4uLnRoaXMuZmlsdGVyTGlzdFtpbmRleF0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkTWltZVR5cGUuZW1pdCh7Li4ub3V0cHV0VHlwZX0pO1xyXG4gICAgICAgICAgICAvLyBhbmltYXRpb24gY29kZVxyXG4gICAgICAgICAgICBsZXQgZWw6IEhUTUxFbGVtZW50IHwgbnVsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtaW1lVHlwZScgKyBpbmRleCk7XHJcbiAgICAgICAgICAgIGlmIChlbCkge1xyXG4gICAgICAgICAgICAgICAgZWwuc2Nyb2xsSW50b1ZpZXcoeyBiZWhhdmlvcjogJ3Ntb290aCcsIGJsb2NrOiAnZW5kJywgaW5saW5lOiAnc3RhcnQnIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWltZVR5cGUnICsgaW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbC5zY3JvbGxJbnRvVmlldyh7IGJlaGF2aW9yOiAnc21vb3RoJywgYmxvY2s6ICdlbmQnLCBpbmxpbmU6ICdzdGFydCcgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSwgMTAwMCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gc2VsZWN0UGlsbCBtZXRob2QnLCBlcnJvcik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiJdfQ==