/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, ViewChild, QueryList, ViewChildren } from '@angular/core';
import { ExpandBehavior, ExpandMode, FlattenedType, TocCardType } from '../../card/models';
import { MimeTypePipe, MimeTypeMasterData } from '../../pipes-module/mime-type';
export class TocItemComponent {
    constructor() {
        this.accordianConfig = {
            expandMode: ExpandMode.MULTIPLE,
            expandBehavior: ExpandBehavior.NONE
        };
        this.activeMimeTypeFilter = ['all'];
        this.noContentMessage = 'No content available';
        this.contentStatus = [];
        this.trackableDefaultImage = '';
        this.type = "";
        this.recogniseCollection = false;
        this.tocCardClick = new EventEmitter();
        this.noContent = new EventEmitter();
        this.selectedItem = new EventEmitter();
        this.playButtonClick = new EventEmitter();
        this.resetActiveContent = false;
        this.isMimeTypeFilterChanged = false;
        this.isSameMimeTypeInChildren = ((/**
         * @param {?} mimeTypesCount
         * @param {?} activeMimeType
         * @return {?}
         */
        (mimeTypesCount, activeMimeType) => {
            /** @type {?} */
            const contentMimeType = Object.keys(JSON.parse(mimeTypesCount));
            return Boolean(activeMimeType.filter((/**
             * @param {?} value
             * @return {?}
             */
            value => contentMimeType.includes(value))).length);
        }));
        this.isSameMimeType = (/**
         * @param {?} currentContent
         * @return {?}
         */
        (currentContent) => this.activeMimeTypeFilter.find((/**
         * @param {?} mimeType
         * @return {?}
         */
        mimeType => mimeType === currentContent.mimeType)));
        this.isChildrenPresent = (/**
         * @param {?} currentContent
         * @return {?}
         */
        (currentContent) => Boolean(currentContent.children && currentContent.children.length));
        this.subscriptions = [];
    }
    /**
     * @return {?}
     */
    get FlattenedType() { return FlattenedType; }
    /**
     * @return {?}
     */
    get MimeTypeMasterData() { return MimeTypeMasterData; }
    /**
     * @return {?}
     */
    get ExpandBehavior() { return ExpandBehavior; }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.setActiveContent();
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.activeMimeTypeFilter) {
            this.isMimeTypeFilterChanged = false;
            this.resetActiveContent = true;
        }
        else if (changes.tocData) {
            this.setActiveContent();
        }
        else if (changes.selectAll) {
            this.selectAllItems(this.selectAll);
        }
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        /** @type {?} */
        const subscription = this.accordionItems.changes.subscribe((/**
         * @param {?} change
         * @return {?}
         */
        change => {
            if (this.resetActiveContent && this.accordionItems.length && this.accordianConfig.expandBehavior === ExpandBehavior.EXPAND_FIRST) {
                this.resetActiveContent = false;
                this.accordionItems.first.collapsed = false;
                this.collapsedChangeHandler(false, this.accordionItems.first);
            }
        }));
        this.subscriptions.push(subscription);
    }
    /**
     * @return {?}
     */
    setActiveContent() {
        if (this.tocData && this.tocData.children) {
            if ((this.tocData.children[0].contentData && this.tocData.children[0].contentData.trackable && this.tocData.children[0].contentData.trackable.enabled === 'Yes') ||
                (this.tocData.children[0].trackable && this.tocData.children[0].trackable.enabled === 'Yes')) {
                return;
            }
            /** @type {?} */
            const flattenDeepContents = this.flattenDeep(this.tocData.children);
            if (!this.activeContent) {
                this.activeContent = this.firstNonCollectionContent(flattenDeepContents);
            }
            if (!this.activeContent) {
                this.noContent.emit({ message: 'No Content Available' });
            }
        }
    }
    /**
     * @param {?} content
     * @return {?}
     */
    filterChildren(content) {
        // Check for the ActiveMimeType
        if (this.activeMimeTypeFilter.includes('all')) {
            if (content.mimeType === MimeTypeMasterData.COLLECTION) {
                return this.isShowContent(content, true);
            }
            return true; // Return true for all the content except collection mimeType
        }
        else if (content.mimeType && this.isSameMimeType(content)) {
            return true;
        }
        else if (content.mimeType === MimeTypeMasterData.COLLECTION) {
            return this.isShowContent(content, false);
        }
        else {
            return false;
        }
    }
    /**
     * @private
     * @param {?} content
     * @param {?} isActiveFilterAll
     * @return {?}
     */
    isShowContent(content, isActiveFilterAll) {
        if (content.mimeTypesCount && !isActiveFilterAll) {
            return this.isSameMimeTypeInChildren(content.mimeTypesCount, this.activeMimeTypeFilter);
        }
        else if (this.isChildrenPresent(content)) {
            /** @type {?} */
            const contentList = this.flattenDeep(content.children);
            return isActiveFilterAll ? contentList.some((/**
             * @param {?} c
             * @return {?}
             */
            (c) => c.mimeType !== MimeTypeMasterData.COLLECTION)) :
                contentList.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                (c) => this.isSameMimeType(c)));
        }
        else {
            return false;
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onTocCardClick(event) {
        /** @type {?} */
        const rollup = this.getRollup(this.tocData, event.data.sbUniqueIdentifier);
        if (rollup.length) {
            rollup.pop();
        }
        this.tocCardClick.emit(Object.assign({}, event, { rollup }));
    }
    /**
     * @param {?} collapsed
     * @param {?} item
     * @return {?}
     */
    collapsedChangeHandler(collapsed, item) {
        if (this.accordianConfig.expandMode === ExpandMode.SINGLE && !collapsed) {
            this.accordionItems.filter((/**
             * @param {?} i
             * @return {?}
             */
            i => i !== item)).forEach((/**
             * @param {?} i
             * @return {?}
             */
            (i) => {
                if (i.expanded) {
                    i.expanded = false;
                }
            }));
        }
    }
    /**
     * @private
     * @param {?} contents
     * @return {?}
     */
    firstNonCollectionContent(contents) {
        return contents.find((/**
         * @param {?} content
         * @return {?}
         */
        (content) => content.mimeType !== 'application/vnd.ekstep.content-collection'));
    }
    /**
     * @private
     * @param {?} contents
     * @return {?}
     */
    flattenDeep(contents) {
        if (contents) {
            return contents.reduce((/**
             * @param {?} acc
             * @param {?} val
             * @return {?}
             */
            (acc, val) => {
                if (val.children) {
                    acc.push(val);
                    return acc.concat(this.flattenDeep(val.children));
                }
                else {
                    return acc.concat(val);
                }
            }), []);
        }
    }
    /**
     * @param {?} index
     * @param {?} item
     * @return {?}
     */
    isExpanded(index, item) {
        /** @type {?} */
        const activeContent = item.children ? this.flattenDeep(item.children).find((/**
         * @param {?} child
         * @return {?}
         */
        (child) => {
            if (this.activeContent && this.activeContent.parent) {
                return child.identifier === this.activeContent.identifier && child.parent === this.activeContent.parent;
            }
            else {
                return child.identifier === this.activeContent.identifier;
            }
        })) : undefined;
        return Boolean(activeContent || item && item.mimeType !== MimeTypeMasterData.COLLECTION);
    }
    /**
     * @param {?} item
     * @param {?} index
     * @return {?}
     */
    isShowBody(item, index) {
        if (item) {
            /** @type {?} */
            const isShowAllMimeType = (/**
             * @return {?}
             */
            () => this.activeMimeTypeFilter.indexOf('all') > -1);
            /** @type {?} */
            const isCollection = (/**
             * @return {?}
             */
            () => item.mimeType === MimeTypeMasterData.COLLECTION);
            /** @type {?} */
            const isMathchesMimeType = (/**
             * @return {?}
             */
            () => this.activeMimeTypeFilter.indexOf(item.mimeType) > -1);
            /** @type {?} */
            const isLastContent = (/**
             * @return {?}
             */
            () => this.tocData.children.length === index + 1);
            if (this.tocData && isShowAllMimeType() || (isCollection() || isMathchesMimeType())) {
                this.isMimeTypeFilterChanged = true;
                return true;
            }
            else if (this.activeMimeTypeFilter.indexOf(item.mimeType) < 0 && !isLastContent()) {
                return false;
            }
            else if (this.activeMimeTypeFilter.indexOf(item.mimeType) < 0 && isLastContent()) {
                if (this.isMimeTypeFilterChanged) {
                    return false;
                }
                this.isMimeTypeFilterChanged = false;
                return true;
            }
        }
        return false;
    }
    /**
     * @param {?} tree
     * @param {?} identifier
     * @return {?}
     */
    getRollup(tree, identifier) {
        /** @type {?} */
        let rollup = [tree.identifier];
        if (tree.sbUniqueIdentifier === identifier) {
            return rollup;
        }
        if (!tree.children || !tree.children.length) {
            return [];
        }
        /** @type {?} */
        let notDone = true;
        /** @type {?} */
        let childRollup;
        /** @type {?} */
        let index = 0;
        while (notDone && tree.children[index]) {
            childRollup = this.getRollup(tree.children[index], identifier);
            if (childRollup && childRollup.length) {
                notDone = false;
            }
            index++;
        }
        if (childRollup && childRollup.length) {
            rollup.push(...childRollup);
            return rollup;
        }
        else {
            return [];
        }
    }
    /**
     * @param {?} tocData
     * @param {?} item
     * @return {?}
     */
    createUniqueId(tocData, item) {
        item['sbUniqueIdentifier'] = tocData.identifier + '_' + item.identifier;
    }
    /**
     * \@since #SH-362
     * \@description - It will despatch an event on individual checkbox click
     * @param {?} item - selected children data.
     * @return {?}
     */
    onItemSelect(item) {
        this.selectedItem.emit({ data: item });
    }
    /**
     * \@since #SH-362
     * \@description - this method will mark every children of tocData object with an additional variable -
     *                selected: true/false based on the value of 'isSelectAll' and also despatch an event
     *                with the data.
     * @param {?} isSelectAll - boolean, which will be true/false if 'Select all checkbox is checked/unchecked
     * @return {?}
     */
    selectAllItems(isSelectAll) {
        this.tocData['children'].forEach((/**
         * @param {?} item
         * @return {?}
         */
        item => {
            item.selected = isSelectAll;
        }));
        this.selectedItem.emit({ selectAll: isSelectAll, data: this.tocData['children'] });
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onPlayButtonClick(event) {
        /** @type {?} */
        const rollup = this.getRollup(this.tocData, event.data.sbUniqueIdentifier);
        if (rollup.length) {
            rollup.pop();
        }
        this.playButtonClick.emit(Object.assign({}, event, { rollup }));
    }
    /**
     * @param {?} content
     * @return {?}
     */
    isFlattenedType(content) {
        if (!(this.type === TocCardType.TRACKABLE) ||
            !((content.contentData && content.contentData.trackable && content.contentData.trackable.enabled === 'Yes') ||
                (content.trackable && content.trackable.enabled === 'Yes'))) {
            return FlattenedType.EXPAND;
        }
        else if (this.type === TocCardType.TRACKABLE &&
            ((content.contentData && content.contentData.trackable && content.contentData.trackable.enabled === 'Yes') ||
                (content.trackable && content.trackable.enabled === 'Yes'))) {
            return FlattenedType.COLLAPSE;
        }
        return '';
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.subscriptions.forEach((/**
         * @param {?} s
         * @return {?}
         */
        s => s.unsubscribe()));
    }
}
TocItemComponent.decorators = [
    { type: Component, args: [{
                selector: 'sb-toc-item',
                template: "<div *ngFor=\"let item of tocData?.children; let index = index;\">\r\n  <ng-container *ngIf=\"(item | hasMimeType: activeMimeTypeFilter) || this.accordianConfig.expandBehavior === ExpandBehavior.NONE\">\r\n  <div *ngIf=\"item?.mimeType === MimeTypeMasterData?.COLLECTION && !(item?.contentData?.trackable?.enabled === 'Yes' || item?.trackable?.enabled === 'Yes')\">\r\n    <sb-accordion [multi]=\"false\" [id]=\"item.identifier\">\r\n      <sb-accordion-item #sbAccordionItem [expanded]=\"isExpanded(index, item)\" (collapsedChange)=\"collapsedChangeHandler($event, sbAccordionItem);\">\r\n        {{ createUniqueId(tocData, item) }}\r\n        <sb-accordion-header>\r\n            <div class=\"sb-checkbox sb-checkbox-primary\" *ngIf=\"selectMode\">\r\n                <input (change)=\"onItemSelect(item)\" [(ngModel)]=\"item.selected\" type=\"checkbox\" name=\"example\">\r\n                <label class=\"mb-0\"><span class=\"title font-weight-bold\">{{item?.name}}</span></label>\r\n            </div>\r\n            <span *ngIf=\"!selectMode\" class=\"title\">{{item?.name}}</span>\r\n        </sb-accordion-header>\r\n        <sb-accordion-body *ngIf=\"isShowBody(item, index)\">\r\n          <div *ngIf=\"item && (item | hasMimeType: activeMimeTypeFilter);else noContent\" #chapterContainer>\r\n            <ng-container *ngIf=\"item?.children?.length\">\r\n              <ng-container *ngFor=\"let child of item?.children; let j = index;\">\r\n                {{ createUniqueId(item, child) }}\r\n                <div class=\"sbchapter\"\r\n                  *ngIf=\"recogniseCollection && filterChildren(child) && child.item?.contentType === 'TextBook'\">\r\n                  <sb-my-course-card [type]=\"'recently_viewed'\"></sb-my-course-card>\r\n                </div>\r\n                <div class=\"sbchapter\"\r\n                  *ngIf=\"recogniseCollection && filterChildren(child) && child.item?.contentType === 'Course'\">\r\n                  <sb-my-course-card [type]=\"'recently_viewed'\"></sb-my-course-card>\r\n                </div>\r\n                <div class=\"sbchapter\" *ngIf=\"filterChildren(child)\" [id]=\"child.identifier\">\r\n                  <ng-container *ngIf=\"isFlattenedType(child) === FlattenedType.EXPAND\">\r\n                    <sb-toc-child-item *ngIf=\"type\" [type]=\"type\" [contentStatus]=\"contentStatus\" [childData]=\"child\"\r\n                      [activeMimeTypeFilter]=\"activeMimeTypeFilter\" [activeContent]=\"activeContent\" [platform]=\"platform\"\r\n                      (tocCardClick)=\"onTocCardClick($event)\" [playBtnConfig]=\"playBtnConfig\" (playButtonClick)=\"onPlayButtonClick($event)\"\r\n                      [trackableDefaultImage]=\"trackableDefaultImage\">\r\n                    </sb-toc-child-item>\r\n                    <sb-toc-child-item *ngIf=\"!type\" [childData]=\"child\" [activeMimeTypeFilter]=\"activeMimeTypeFilter\"\r\n                      [activeContent]=\"activeContent\" (tocCardClick)=\"onTocCardClick($event)\" [playBtnConfig]=\"playBtnConfig\"\r\n                      (playButtonClick)=\"onPlayButtonClick($event)\" [platform]=\"platform\" [trackableDefaultImage]=\"trackableDefaultImage\">\r\n                    </sb-toc-child-item>\r\n                  </ng-container>\r\n\r\n                  <ng-container *ngIf=\"isFlattenedType(child) === FlattenedType.COLLAPSE\">\r\n                    <sb-toc-card *ngIf=\"type\" [type]=\"type\" [content]=\"child\" (tocCardClick)=\"onTocCardClick($event)\"\r\n                      [activeContent]=\"activeContent\" [playBtnConfig]=\"playBtnConfig\" (playButtonClick)=\"onPlayButtonClick($event)\"\r\n                      [trackableDefaultImage]=\"trackableDefaultImage\" [platform]=\"platform\">\r\n                    </sb-toc-card>\r\n                    <sb-toc-card *ngIf=\"!type\" [content]=\"child\" (tocCardClick)=\"onTocCardClick($event)\"\r\n                      [activeContent]=\"activeContent\" [playBtnConfig]=\"playBtnConfig\" (playButtonClick)=\"onPlayButtonClick($event)\"\r\n                      [trackableDefaultImage]=\"trackableDefaultImage\" [platform]=\"platform\">\r\n                    </sb-toc-card>\r\n                  </ng-container>\r\n\r\n                </div>\r\n              </ng-container>\r\n            </ng-container>\r\n            <ng-container *ngIf=\"item?.mimeType === MimeTypeMasterData?.COLLECTION && !item?.children?.length\">\r\n              <div class=\"heading\">{{noContentMessage}}</div>\r\n            </ng-container>\r\n          </div>\r\n          <ng-template #noContent>\r\n            <div class=\"heading\">{{noContentMessage}}</div>\r\n          </ng-template>\r\n        </sb-accordion-body>\r\n      </sb-accordion-item>\r\n    </sb-accordion>\r\n  </div>\r\n  <div *ngIf=\"(item?.mimeType !== MimeTypeMasterData?.COLLECTION && !item?.children?.length) ||\r\n    item?.contentData?.trackable?.enabled === 'Yes' || item?.trackable?.enabled === 'Yes'\" class=\"sb-content__bar\">\r\n    <ng-container>\r\n    <div class=\"child-content-padding\">\r\n      <sb-toc-card *ngIf=\"type\" [type]=\"type\" [contentStatus]=\"contentStatus\" [content]=\"item\"\r\n        (tocCardClick)=\"onTocCardClick($event)\" [activeContent]=\"activeContent\" [playBtnConfig]=\"playBtnConfig\"\r\n        (playButtonClick)=\"onPlayButtonClick($event)\" [platform]=\"platform\" [trackableDefaultImage]=\"trackableDefaultImage\">\r\n      </sb-toc-card>\r\n      <sb-toc-card *ngIf=\"!type\" [content]=\"item\" (tocCardClick)=\"onTocCardClick($event)\" [platform]=\"platform\"\r\n        [activeContent]=\"activeContent\" [playBtnConfig]=\"playBtnConfig\" (playButtonClick)=\"onPlayButtonClick($event)\"\r\n        [trackableDefaultImage]=\"trackableDefaultImage\">\r\n      </sb-toc-card>\r\n    </div>\r\n    </ng-container>\r\n  </div>\r\n  </ng-container>\r\n</div>\r\n",
                providers: [MimeTypePipe],
                styles: [".sbchapter{border-bottom:.0625rem solid var(--gray-100);padding:0 0 1rem;margin-bottom:1rem}.sbchapter:last-child{border-bottom:0;margin-bottom:0;padding-bottom:0}.sbchapter h4{font-size:.625rem;line-height:1.125rem;color:var(--gray-800);margin-bottom:.5rem}.sbchapter__item{background:var(--white);box-shadow:0 .1875rem .25rem 0 rgba(var(--rc-rgba-primary),.1);border:.03125rem solid rgba(var(--rc-rgba-primary),.5);display:flex;align-items:center;justify-content:space-between;margin-bottom:.5rem;padding:.5rem;cursor:pointer;min-height:3.5rem}.sbchapter__item h4{font-size:.75rem;line-height:1.25rem;color:var(--primary-400);margin:0;padding:0}.sbchapter__item .sbchapter__img{width:1.5rem;height:1.5rem;flex:0 0 1.5rem}.sbchapter__item .sbchapter__img img{width:100%}.sbchapter__item .sbchapter__img .icon-svg svg.icon .icon-svg--primary{fill:#9cb9ff}.sbchapter__item:hover{background:var(--gray-0)}.sbchapter__item--active,.sbchapter__item--active:hover{background:var(--primary-100)}.sbchapter-open{border-bottom:.0625rem solid #e0e0e0;padding-bottom:var(--base-block-space)}.sbchapter-open__title{font-size:.875rem;font-weight:700;color:var(--primary-400);margin:0;padding:1rem;width:100%}.sbchapter-open__topics{padding:0}.sbchapter-open__topics__title{font-size:.875rem;line-height:1.375rem;margin:0 0 .5rem;color:var(--primary-400);padding:0 1rem}.sbchapter-open__topic{font-size:.75rem;line-height:1.25rem;padding:8px 2rem;margin:0;color:var(--primary-400)}.sbchapter-open__topic--active{background:var(--primary-100)}.sbchapter-open__topic:hover{background:var(--gray-0)}.sbsmartscroll-style::-webkit-scrollbar{width:.3125rem;height:.3125rem;background-color:var(--primary-400);-webkit-appearance:none}.sbsmartscroll-style::-webkit-scrollbar-thumb{background-color:var(--gray-400)}.sbsmartscroll-style::-webkit-scrollbar-track{-webkit-box-shadow:inset 0 0 .375rem rgba(var(--rc-rgba-black),0);background-color:var(--gray-0)}.heading{font-size:.875rem;line-height:1.375rem;font-weight:700;text-align:center;color:var(--gray-400);padding:1rem}.child-content-padding{padding:0}.sb-content__bar{margin:.5rem 0;background:var(--gray-0)}"]
            }] }
];
/** @nocollapse */
TocItemComponent.ctorParameters = () => [];
TocItemComponent.propDecorators = {
    accordianConfig: [{ type: Input }],
    accordionItems: [{ type: ViewChildren, args: ['sbAccordionItem',] }],
    tocData: [{ type: Input }],
    activeMimeTypeFilter: [{ type: Input }],
    noContentMessage: [{ type: Input }],
    contentStatus: [{ type: Input }],
    selectMode: [{ type: Input }],
    selectAll: [{ type: Input }],
    playBtnConfig: [{ type: Input }],
    platform: [{ type: Input }],
    trackableDefaultImage: [{ type: Input }],
    divs: [{ type: ViewChild, args: ['chapter', { static: false },] }],
    chapterContainer: [{ type: ViewChildren, args: ['chapterContainer',] }],
    type: [{ type: Input }],
    activeContent: [{ type: Input }],
    recogniseCollection: [{ type: Input }],
    tocCardClick: [{ type: Output }],
    noContent: [{ type: Output }],
    selectedItem: [{ type: Output }],
    playButtonClick: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    TocItemComponent.prototype.accordianConfig;
    /** @type {?} */
    TocItemComponent.prototype.accordionItems;
    /** @type {?} */
    TocItemComponent.prototype.tocData;
    /** @type {?} */
    TocItemComponent.prototype.activeMimeTypeFilter;
    /** @type {?} */
    TocItemComponent.prototype.noContentMessage;
    /** @type {?} */
    TocItemComponent.prototype.contentStatus;
    /** @type {?} */
    TocItemComponent.prototype.selectMode;
    /** @type {?} */
    TocItemComponent.prototype.selectAll;
    /** @type {?} */
    TocItemComponent.prototype.playBtnConfig;
    /** @type {?} */
    TocItemComponent.prototype.platform;
    /** @type {?} */
    TocItemComponent.prototype.trackableDefaultImage;
    /** @type {?} */
    TocItemComponent.prototype.divs;
    /** @type {?} */
    TocItemComponent.prototype.chapterContainer;
    /** @type {?} */
    TocItemComponent.prototype.type;
    /** @type {?} */
    TocItemComponent.prototype.activeContent;
    /** @type {?} */
    TocItemComponent.prototype.recogniseCollection;
    /** @type {?} */
    TocItemComponent.prototype.tocCardClick;
    /** @type {?} */
    TocItemComponent.prototype.noContent;
    /** @type {?} */
    TocItemComponent.prototype.selectedItem;
    /** @type {?} */
    TocItemComponent.prototype.playButtonClick;
    /**
     * @type {?}
     * @private
     */
    TocItemComponent.prototype.resetActiveContent;
    /** @type {?} */
    TocItemComponent.prototype.isMimeTypeFilterChanged;
    /**
     * @type {?}
     * @private
     */
    TocItemComponent.prototype.isSameMimeTypeInChildren;
    /**
     * @type {?}
     * @private
     */
    TocItemComponent.prototype.isSameMimeType;
    /**
     * @type {?}
     * @private
     */
    TocItemComponent.prototype.isChildrenPresent;
    /**
     * @type {?}
     * @private
     */
    TocItemComponent.prototype.subscriptions;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9jLWl0ZW0uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHByb2plY3Qtc3VuYmlyZC9jb21tb24tY29uc3VtcHRpb24tdjgvIiwic291cmNlcyI6WyJsaWIvY29udGVudC1kZXRhaWxzL3RvYy1pdGVtL3RvYy1pdGVtLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFBVSxLQUFLLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFDbkYsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLGNBQWMsRUFBRSxVQUFVLEVBQUUsYUFBYSxFQUFvQixXQUFXLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUM3RyxPQUFPLEVBQUUsWUFBWSxFQUFFLGtCQUFrQixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFTaEYsTUFBTSxPQUFPLGdCQUFnQjtJQXNDM0I7UUFyQ1Msb0JBQWUsR0FBcUI7WUFDM0MsVUFBVSxFQUFFLFVBQVUsQ0FBQyxRQUFRO1lBQy9CLGNBQWMsRUFBRSxjQUFjLENBQUMsSUFBSTtTQUNwQyxDQUFDO1FBR08seUJBQW9CLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMvQixxQkFBZ0IsR0FBRyxzQkFBc0IsQ0FBQztRQUMxQyxrQkFBYSxHQUFHLEVBQUUsQ0FBQztRQUtuQiwwQkFBcUIsR0FBRyxFQUFFLENBQUM7UUFJM0IsU0FBSSxHQUFHLEVBQUUsQ0FBQztRQUdWLHdCQUFtQixHQUFHLEtBQUssQ0FBQztRQUMzQixpQkFBWSxHQUFzQixJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ3JELGNBQVMsR0FBc0IsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUNsRCxpQkFBWSxHQUFzQixJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ3JELG9CQUFlLEdBQXNCLElBQUksWUFBWSxFQUFFLENBQUM7UUFDMUQsdUJBQWtCLEdBQUcsS0FBSyxDQUFD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IElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgVmlld0NoaWxkLCBRdWVyeUxpc3QsIFZpZXdDaGlsZHJlbiwgT25DaGFuZ2VzLCBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3lcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRXhwYW5kQmVoYXZpb3IsIEV4cGFuZE1vZGUsIEZsYXR0ZW5lZFR5cGUsIElBY2NvcmRpYW5Db25maWcsIFRvY0NhcmRUeXBlIH0gZnJvbSAnLi4vLi4vY2FyZC9tb2RlbHMnO1xyXG5pbXBvcnQgeyBNaW1lVHlwZVBpcGUsIE1pbWVUeXBlTWFzdGVyRGF0YSB9IGZyb20gJy4uLy4uL3BpcGVzLW1vZHVsZS9taW1lLXR5cGUnO1xyXG5pbXBvcnQge0FjY29yZGlvbkl0ZW1Db21wb25lbnR9IGZyb20gJy4uLy4uL2FjY29yZGlvbi9hY2NvcmRpb24taXRlbS9hY2NvcmRpb24taXRlbS5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdzYi10b2MtaXRlbScsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL3RvYy1pdGVtLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi90b2MtaXRlbS5jb21wb25lbnQuc2NzcyddLFxyXG4gIHByb3ZpZGVyczogW01pbWVUeXBlUGlwZV1cclxufSlcclxuZXhwb3J0IGNsYXNzIFRvY0l0ZW1Db21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95IHtcclxuICBASW5wdXQoKSBhY2NvcmRpYW5Db25maWc6IElBY2NvcmRpYW5Db25maWcgPSB7XHJcbiAgICBleHBhbmRNb2RlOiBFeHBhbmRNb2RlLk1VTFRJUExFLFxyXG4gICAgZXhwYW5kQmVoYXZpb3I6IEV4cGFuZEJlaGF2aW9yLk5PTkVcclxuICB9O1xyXG4gIEBWaWV3Q2hpbGRyZW4oJ3NiQWNjb3JkaW9uSXRlbScpIGFjY29yZGlvbkl0ZW1zOiBRdWVyeUxpc3Q8QWNjb3JkaW9uSXRlbUNvbXBvbmVudD47XHJcbiAgQElucHV0KCkgdG9jRGF0YTtcclxuICBASW5wdXQoKSBhY3RpdmVNaW1lVHlwZUZpbHRlciA9IFsnYWxsJ107XHJcbiAgQElucHV0KCkgbm9Db250ZW50TWVzc2FnZSA9ICdObyBjb250ZW50IGF2YWlsYWJsZSc7XHJcbiAgQElucHV0KCkgY29udGVudFN0YXR1cyA9IFtdO1xyXG4gIEBJbnB1dCgpIHNlbGVjdE1vZGU7XHJcbiAgQElucHV0KCkgc2VsZWN0QWxsO1xyXG4gIEBJbnB1dCgpIHBsYXlCdG5Db25maWc7XHJcbiAgQElucHV0KCkgcGxhdGZvcm07XHJcbiAgQElucHV0KCkgdHJhY2thYmxlRGVmYXVsdEltYWdlID0gJyc7XHJcbiAgQFZpZXdDaGlsZCgnY2hhcHRlcicse3N0YXRpYzogZmFsc2V9KSBkaXZzOiBRdWVyeUxpc3Q8YW55PjtcclxuICBAVmlld0NoaWxkcmVuKCdjaGFwdGVyQ29udGFpbmVyJykgY2hhcHRlckNvbnRhaW5lcjogUXVlcnlMaXN0PGFueT47XHJcblxyXG4gIEBJbnB1dCgpIHR5cGUgPSBcIlwiO1xyXG5cclxuICBASW5wdXQoKSBhY3RpdmVDb250ZW50O1xyXG4gIEBJbnB1dCgpIHJlY29nbmlzZUNvbGxlY3Rpb24gPSBmYWxzZTtcclxuICBAT3V0cHV0KCkgdG9jQ2FyZENsaWNrOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBAT3V0cHV0KCkgbm9Db250ZW50OiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBAT3V0cHV0KCkgc2VsZWN0ZWRJdGVtOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBAT3V0cHV0KCkgcGxheUJ1dHRvbkNsaWNrOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBwcml2YXRlIHJlc2V0QWN0aXZlQ29udGVudCA9IGZhbHNlO1xyXG4gIGdldCBGbGF0dGVuZWRUeXBlKCkgeyByZXR1cm4gRmxhdHRlbmVkVHlwZTsgfVxyXG4gIGdldCBNaW1lVHlwZU1hc3RlckRhdGEoKSB7IHJldHVybiBNaW1lVHlwZU1hc3RlckRhdGE7IH1cclxuICBnZXQgRXhwYW5kQmVoYXZpb3IoKSB7IHJldHVybiBFeHBhbmRCZWhhdmlvcjsgfVxyXG4gIGlzTWltZVR5cGVGaWx0ZXJDaGFuZ2VkID0gZmFsc2U7XHJcbiAgcHJpdmF0ZSBpc1NhbWVNaW1lVHlwZUluQ2hpbGRyZW4gPSAoKG1pbWVUeXBlc0NvdW50LCBhY3RpdmVNaW1lVHlwZSkgPT4ge1xyXG4gICAgY29uc3QgY29udGVudE1pbWVUeXBlID0gT2JqZWN0LmtleXMoSlNPTi5wYXJzZShtaW1lVHlwZXNDb3VudCkpO1xyXG4gICAgcmV0dXJuIEJvb2xlYW4oYWN0aXZlTWltZVR5cGUuZmlsdGVyKHZhbHVlID0+IGNvbnRlbnRNaW1lVHlwZS5pbmNsdWRlcyh2YWx1ZSkpLmxlbmd0aCk7XHJcbiAgfSk7XHJcbiAgcHJpdmF0ZSBpc1NhbWVNaW1lVHlwZSA9IChjdXJyZW50Q29udGVudCkgPT4gdGhpcy5hY3RpdmVNaW1lVHlwZUZpbHRlci5maW5kKG1pbWVUeXBlID0+IG1pbWVUeXBlID09PSBjdXJyZW50Q29udGVudC5taW1lVHlwZSk7XHJcbiAgcHJpdmF0ZSBpc0NoaWxkcmVuUHJlc2VudCA9IChjdXJyZW50Q29udGVudCkgPT4gQm9vbGVhbihjdXJyZW50Q29udGVudC5jaGlsZHJlbiAmJiBjdXJyZW50Q29udGVudC5jaGlsZHJlbi5sZW5ndGgpO1xyXG4gIHByaXZhdGUgc3Vic2NyaXB0aW9uczogU3Vic2NyaXB0aW9uW10gPSBbXTtcclxuICBjb25zdHJ1Y3RvcigpIHsgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICAgIHRoaXMuc2V0QWN0aXZlQ29udGVudCgpO1xyXG4gIH1cclxuXHJcbiAgbmdPbkNoYW5nZXMoY2hhbmdlcykge1xyXG4gICAgaWYgKGNoYW5nZXMuYWN0aXZlTWltZVR5cGVGaWx0ZXIpIHtcclxuICAgICAgdGhpcy5pc01pbWVUeXBlRmlsdGVyQ2hhbmdlZCA9IGZhbHNlO1xyXG4gICAgICB0aGlzLnJlc2V0QWN0aXZlQ29udGVudCA9IHRydWU7XHJcbiAgICB9IGVsc2UgaWYgKGNoYW5nZXMudG9jRGF0YSkge1xyXG4gICAgICB0aGlzLnNldEFjdGl2ZUNvbnRlbnQoKTtcclxuICAgIH0gZWxzZSBpZiAoY2hhbmdlcy5zZWxlY3RBbGwpIHtcclxuICAgICAgdGhpcy5zZWxlY3RBbGxJdGVtcyh0aGlzLnNlbGVjdEFsbCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBuZ0FmdGVyVmlld0luaXQoKSB7XHJcbiAgICBjb25zdCBzdWJzY3JpcHRpb24gPSAgdGhpcy5hY2NvcmRpb25JdGVtcy5jaGFuZ2VzLnN1YnNjcmliZShjaGFuZ2UgPT4ge1xyXG4gICAgICBpZiAodGhpcy5yZXNldEFjdGl2ZUNvbnRlbnQgJiYgdGhpcy5hY2NvcmRpb25JdGVtcy5sZW5ndGggJiYgdGhpcy5hY2NvcmRpYW5Db25maWcuZXhwYW5kQmVoYXZpb3IgPT09IEV4cGFuZEJlaGF2aW9yLkVYUEFORF9GSVJTVCkge1xyXG4gICAgICAgIHRoaXMucmVzZXRBY3RpdmVDb250ZW50ID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5hY2NvcmRpb25JdGVtcy5maXJzdC5jb2xsYXBzZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmNvbGxhcHNlZENoYW5nZUhhbmRsZXIoZmFsc2UsIHRoaXMuYWNjb3JkaW9uSXRlbXMuZmlyc3QpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKHN1YnNjcmlwdGlvbik7XHJcbiAgfVxyXG5cclxuICBzZXRBY3RpdmVDb250ZW50KCkge1xyXG4gICAgaWYgKHRoaXMudG9jRGF0YSAmJiB0aGlzLnRvY0RhdGEuY2hpbGRyZW4pIHtcclxuICAgICAgaWYgKCh0aGlzLnRvY0RhdGEuY2hpbGRyZW5bMF0uY29udGVudERhdGEgJiYgdGhpcy50b2NEYXRhLmNoaWxkcmVuWzBdLmNvbnRlbnREYXRhLnRyYWNrYWJsZSAmJiB0aGlzLnRvY0RhdGEuY2hpbGRyZW5bMF0uY29udGVudERhdGEudHJhY2thYmxlLmVuYWJsZWQgPT09ICdZZXMnKSB8fFxyXG4gICAgICAgICh0aGlzLnRvY0RhdGEuY2hpbGRyZW5bMF0udHJhY2thYmxlICYmIHRoaXMudG9jRGF0YS5jaGlsZHJlblswXS50cmFja2FibGUuZW5hYmxlZCA9PT0gJ1llcycpKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IGZsYXR0ZW5EZWVwQ29udGVudHMgPSB0aGlzLmZsYXR0ZW5EZWVwKHRoaXMudG9jRGF0YS5jaGlsZHJlbik7XHJcbiAgICAgIGlmICghdGhpcy5hY3RpdmVDb250ZW50KSB7XHJcbiAgICAgICAgdGhpcy5hY3RpdmVDb250ZW50ID0gdGhpcy5maXJzdE5vbkNvbGxlY3Rpb25Db250ZW50KGZsYXR0ZW5EZWVwQ29udGVudHMpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICghdGhpcy5hY3RpdmVDb250ZW50KSB7XHJcbiAgICAgICAgdGhpcy5ub0NvbnRlbnQuZW1pdCh7IG1lc3NhZ2U6ICdObyBDb250ZW50IEF2YWlsYWJsZScgfSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBmaWx0ZXJDaGlsZHJlbihjb250ZW50KSB7XHJcbiAgICAvLyBDaGVjayBmb3IgdGhlIEFjdGl2ZU1pbWVUeXBlXHJcbiAgICBpZiAodGhpcy5hY3RpdmVNaW1lVHlwZUZpbHRlci5pbmNsdWRlcygnYWxsJykpIHtcclxuICAgICAgaWYgKGNvbnRlbnQubWltZVR5cGUgPT09IE1pbWVUeXBlTWFzdGVyRGF0YS5DT0xMRUNUSU9OKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNTaG93Q29udGVudChjb250ZW50LCB0cnVlKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gdHJ1ZTsgLy8gUmV0dXJuIHRydWUgZm9yIGFsbCB0aGUgY29udGVudCBleGNlcHQgY29sbGVjdGlvbiBtaW1lVHlwZVxyXG4gICAgfSBlbHNlIGlmIChjb250ZW50Lm1pbWVUeXBlICYmIHRoaXMuaXNTYW1lTWltZVR5cGUoY29udGVudCkpIHtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9IGVsc2UgaWYgKGNvbnRlbnQubWltZVR5cGUgPT09IE1pbWVUeXBlTWFzdGVyRGF0YS5DT0xMRUNUSU9OKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmlzU2hvd0NvbnRlbnQoY29udGVudCwgZmFsc2UpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBpc1Nob3dDb250ZW50KGNvbnRlbnQsIGlzQWN0aXZlRmlsdGVyQWxsKSB7XHJcbiAgICBpZiAoY29udGVudC5taW1lVHlwZXNDb3VudCAmJiAhaXNBY3RpdmVGaWx0ZXJBbGwpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuaXNTYW1lTWltZVR5cGVJbkNoaWxkcmVuKGNvbnRlbnQubWltZVR5cGVzQ291bnQsIHRoaXMuYWN0aXZlTWltZVR5cGVGaWx0ZXIpO1xyXG4gICAgfSBlbHNlIGlmICh0aGlzLmlzQ2hpbGRyZW5QcmVzZW50KGNvbnRlbnQpKSB7XHJcbiAgICAgIGNvbnN0IGNvbnRlbnRMaXN0ID0gdGhpcy5mbGF0dGVuRGVlcChjb250ZW50LmNoaWxkcmVuKTtcclxuICAgICAgcmV0dXJuIGlzQWN0aXZlRmlsdGVyQWxsID8gY29udGVudExpc3Quc29tZSgoYykgPT4gYy5taW1lVHlwZSAhPT0gTWltZVR5cGVNYXN0ZXJEYXRhLkNPTExFQ1RJT04pIDpcclxuICAgICAgICBjb250ZW50TGlzdC5zb21lKChjKSA9PiB0aGlzLmlzU2FtZU1pbWVUeXBlKGMpKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBvblRvY0NhcmRDbGljayhldmVudCkge1xyXG4gICAgY29uc3Qgcm9sbHVwID0gdGhpcy5nZXRSb2xsdXAodGhpcy50b2NEYXRhLCBldmVudC5kYXRhLnNiVW5pcXVlSWRlbnRpZmllcik7XHJcbiAgICBpZiAocm9sbHVwLmxlbmd0aCkge1xyXG4gICAgICByb2xsdXAucG9wKCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLnRvY0NhcmRDbGljay5lbWl0KHsgLi4uZXZlbnQsIHJvbGx1cCB9KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBjb2xsYXBzZWRDaGFuZ2VIYW5kbGVyKGNvbGxhcHNlZDogYm9vbGVhbiwgaXRlbTogQWNjb3JkaW9uSXRlbUNvbXBvbmVudCkge1xyXG4gICAgaWYgKHRoaXMuYWNjb3JkaWFuQ29uZmlnLmV4cGFuZE1vZGUgPT09IEV4cGFuZE1vZGUuU0lOR0xFICYmICFjb2xsYXBzZWQpIHtcclxuICAgICAgdGhpcy5hY2NvcmRpb25JdGVtcy5maWx0ZXIoaSA9PiBpICE9PSBpdGVtKS5mb3JFYWNoKChpKSA9PiB7XHJcbiAgICAgICAgaWYgKGkuZXhwYW5kZWQpIHsgaS5leHBhbmRlZCA9IGZhbHNlOyB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBmaXJzdE5vbkNvbGxlY3Rpb25Db250ZW50KGNvbnRlbnRzKSB7XHJcbiAgICByZXR1cm4gY29udGVudHMuZmluZCgoY29udGVudCkgPT4gY29udGVudC5taW1lVHlwZSAhPT0gJ2FwcGxpY2F0aW9uL3ZuZC5la3N0ZXAuY29udGVudC1jb2xsZWN0aW9uJyk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGZsYXR0ZW5EZWVwKGNvbnRlbnRzKSB7XHJcbiAgICBpZiAoY29udGVudHMpIHtcclxuICAgICAgcmV0dXJuIGNvbnRlbnRzLnJlZHVjZSgoYWNjLCB2YWwpID0+IHtcclxuICAgICAgICBpZiAodmFsLmNoaWxkcmVuKSB7XHJcbiAgICAgICAgICBhY2MucHVzaCh2YWwpO1xyXG4gICAgICAgICAgcmV0dXJuIGFjYy5jb25jYXQodGhpcy5mbGF0dGVuRGVlcCh2YWwuY2hpbGRyZW4pKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmV0dXJuIGFjYy5jb25jYXQodmFsKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0sIFtdKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGlzRXhwYW5kZWQoaW5kZXg6IG51bWJlciwgaXRlbSkge1xyXG4gICAgY29uc3QgYWN0aXZlQ29udGVudCA9IGl0ZW0uY2hpbGRyZW4gPyB0aGlzLmZsYXR0ZW5EZWVwKGl0ZW0uY2hpbGRyZW4pLmZpbmQoKGNoaWxkKSA9PiB7XHJcbiAgICAgIGlmICh0aGlzLmFjdGl2ZUNvbnRlbnQgJiYgdGhpcy5hY3RpdmVDb250ZW50LnBhcmVudCkge1xyXG4gICAgICAgIHJldHVybiBjaGlsZC5pZGVudGlmaWVyID09PSB0aGlzLmFjdGl2ZUNvbnRlbnQuaWRlbnRpZmllciAmJiBjaGlsZC5wYXJlbnQgPT09IHRoaXMuYWN0aXZlQ29udGVudC5wYXJlbnQ7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIGNoaWxkLmlkZW50aWZpZXIgPT09IHRoaXMuYWN0aXZlQ29udGVudC5pZGVudGlmaWVyO1xyXG4gICAgICB9XHJcbiAgICB9KSA6IHVuZGVmaW5lZDtcclxuICAgIHJldHVybiBCb29sZWFuKGFjdGl2ZUNvbnRlbnQgfHwgaXRlbSAmJiBpdGVtLm1pbWVUeXBlICE9PSBNaW1lVHlwZU1hc3RlckRhdGEuQ09MTEVDVElPTik7XHJcbiAgfVxyXG5cclxuICBpc1Nob3dCb2R5KGl0ZW0sIGluZGV4KSB7XHJcbiAgICBpZiAoaXRlbSkge1xyXG4gICAgICBjb25zdCBpc1Nob3dBbGxNaW1lVHlwZSA9ICgpID0+IHRoaXMuYWN0aXZlTWltZVR5cGVGaWx0ZXIuaW5kZXhPZignYWxsJykgPiAtMTtcclxuICAgICAgY29uc3QgaXNDb2xsZWN0aW9uID0gKCkgPT4gaXRlbS5taW1lVHlwZSA9PT0gTWltZVR5cGVNYXN0ZXJEYXRhLkNPTExFQ1RJT047XHJcbiAgICAgIGNvbnN0IGlzTWF0aGNoZXNNaW1lVHlwZSA9ICgpID0+IHRoaXMuYWN0aXZlTWltZVR5cGVGaWx0ZXIuaW5kZXhPZihpdGVtLm1pbWVUeXBlKSA+IC0xO1xyXG4gICAgICBjb25zdCBpc0xhc3RDb250ZW50ID0gKCkgPT4gdGhpcy50b2NEYXRhLmNoaWxkcmVuLmxlbmd0aCA9PT0gaW5kZXggKyAxO1xyXG5cclxuICAgICAgaWYgKHRoaXMudG9jRGF0YSAmJiBpc1Nob3dBbGxNaW1lVHlwZSgpIHx8IChpc0NvbGxlY3Rpb24oKSB8fCBpc01hdGhjaGVzTWltZVR5cGUoKSkpIHtcclxuICAgICAgICB0aGlzLmlzTWltZVR5cGVGaWx0ZXJDaGFuZ2VkID0gdHJ1ZTtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfSBlbHNlIGlmICh0aGlzLmFjdGl2ZU1pbWVUeXBlRmlsdGVyLmluZGV4T2YoaXRlbS5taW1lVHlwZSkgPCAwICYmICFpc0xhc3RDb250ZW50KCkpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5hY3RpdmVNaW1lVHlwZUZpbHRlci5pbmRleE9mKGl0ZW0ubWltZVR5cGUpIDwgMCAmJiBpc0xhc3RDb250ZW50KCkpIHtcclxuICAgICAgICBpZiAodGhpcy5pc01pbWVUeXBlRmlsdGVyQ2hhbmdlZCkge1xyXG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmlzTWltZVR5cGVGaWx0ZXJDaGFuZ2VkID0gZmFsc2U7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG5cclxuICBnZXRSb2xsdXAodHJlZSwgaWRlbnRpZmllcikge1xyXG4gICAgbGV0IHJvbGx1cCA9IFt0cmVlLmlkZW50aWZpZXJdO1xyXG4gICAgaWYgKHRyZWUuc2JVbmlxdWVJZGVudGlmaWVyID09PSBpZGVudGlmaWVyKSB7XHJcbiAgICAgIHJldHVybiByb2xsdXA7XHJcbiAgICB9XHJcbiAgICBpZiAoIXRyZWUuY2hpbGRyZW4gfHwgIXRyZWUuY2hpbGRyZW4ubGVuZ3RoKSB7XHJcbiAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuICAgIGxldCBub3REb25lID0gdHJ1ZTtcclxuICAgIGxldCBjaGlsZFJvbGx1cDogYW55O1xyXG4gICAgbGV0IGluZGV4ID0gMDtcclxuICAgIHdoaWxlIChub3REb25lICYmIHRyZWUuY2hpbGRyZW5baW5kZXhdKSB7XHJcbiAgICAgIGNoaWxkUm9sbHVwID0gdGhpcy5nZXRSb2xsdXAodHJlZS5jaGlsZHJlbltpbmRleF0sIGlkZW50aWZpZXIpO1xyXG4gICAgICBpZiAoY2hpbGRSb2xsdXAgJiYgY2hpbGRSb2xsdXAubGVuZ3RoKSB7XHJcbiAgICAgICAgbm90RG9uZSA9IGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICAgIGluZGV4Kys7XHJcbiAgICB9XHJcbiAgICBpZiAoY2hpbGRSb2xsdXAgJiYgY2hpbGRSb2xsdXAubGVuZ3RoKSB7XHJcbiAgICAgIHJvbGx1cC5wdXNoKC4uLmNoaWxkUm9sbHVwKTtcclxuICAgICAgcmV0dXJuIHJvbGx1cDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNyZWF0ZVVuaXF1ZUlkKHRvY0RhdGEsIGl0ZW0pIHtcclxuICAgIGl0ZW1bJ3NiVW5pcXVlSWRlbnRpZmllciddID0gdG9jRGF0YS5pZGVudGlmaWVyICsgJ18nICsgaXRlbS5pZGVudGlmaWVyO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHNpbmNlICNTSC0zNjJcclxuICAgKiBAcGFyYW0gaXRlbSAtIHNlbGVjdGVkIGNoaWxkcmVuIGRhdGEuXHJcbiAgICogQGRlc2NyaXB0aW9uIC0gSXQgd2lsbCBkZXNwYXRjaCBhbiBldmVudCBvbiBpbmRpdmlkdWFsIGNoZWNrYm94IGNsaWNrXHJcbiAgICovXHJcbiAgb25JdGVtU2VsZWN0KGl0ZW0pIHtcclxuICAgIHRoaXMuc2VsZWN0ZWRJdGVtLmVtaXQoe2RhdGE6IGl0ZW19KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBzaW5jZSAjU0gtMzYyXHJcbiAgICogQHBhcmFtIGlzU2VsZWN0QWxsIC0gYm9vbGVhbiwgd2hpY2ggd2lsbCBiZSB0cnVlL2ZhbHNlIGlmICdTZWxlY3QgYWxsIGNoZWNrYm94IGlzIGNoZWNrZWQvdW5jaGVja2VkXHJcbiAgICogQGRlc2NyaXB0aW9uIC0gdGhpcyBtZXRob2Qgd2lsbCBtYXJrIGV2ZXJ5IGNoaWxkcmVuIG9mIHRvY0RhdGEgb2JqZWN0IHdpdGggYW4gYWRkaXRpb25hbCB2YXJpYWJsZSAtXHJcbiAgICogICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IHRydWUvZmFsc2UgYmFzZWQgb24gdGhlIHZhbHVlIG9mICdpc1NlbGVjdEFsbCcgYW5kIGFsc28gZGVzcGF0Y2ggYW4gZXZlbnRcclxuICAgKiAgICAgICAgICAgICAgICB3aXRoIHRoZSBkYXRhLlxyXG4gICAqL1xyXG4gIHNlbGVjdEFsbEl0ZW1zKGlzU2VsZWN0QWxsOiBib29sZWFuKSB7XHJcbiAgICB0aGlzLnRvY0RhdGFbJ2NoaWxkcmVuJ10uZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgaXRlbS5zZWxlY3RlZCA9IGlzU2VsZWN0QWxsO1xyXG4gICAgfSk7XHJcbiAgICB0aGlzLnNlbGVjdGVkSXRlbS5lbWl0KHtzZWxlY3RBbGw6IGlzU2VsZWN0QWxsLCBkYXRhOiB0aGlzLnRvY0RhdGFbJ2NoaWxkcmVuJ119KTtcclxuICB9XHJcblxyXG4gIG9uUGxheUJ1dHRvbkNsaWNrKGV2ZW50KSB7XHJcbiAgICBjb25zdCByb2xsdXAgPSB0aGlzLmdldFJvbGx1cCh0aGlzLnRvY0RhdGEsIGV2ZW50LmRhdGEuc2JVbmlxdWVJZGVudGlmaWVyKTtcclxuICAgIGlmIChyb2xsdXAubGVuZ3RoKSB7XHJcbiAgICAgIHJvbGx1cC5wb3AoKTtcclxuICAgIH1cclxuICAgIHRoaXMucGxheUJ1dHRvbkNsaWNrLmVtaXQoeyAuLi5ldmVudCwgcm9sbHVwIH0pO1xyXG4gIH1cclxuXHJcbiAgaXNGbGF0dGVuZWRUeXBlKGNvbnRlbnQpIHtcclxuICAgIGlmICghKHRoaXMudHlwZSA9PT0gVG9jQ2FyZFR5cGUuVFJBQ0tBQkxFKSB8fFxyXG4gICAgICAhKChjb250ZW50LmNvbnRlbnREYXRhICYmIGNvbnRlbnQuY29udGVudERhdGEudHJhY2thYmxlICYmIGNvbnRlbnQuY29udGVudERhdGEudHJhY2thYmxlLmVuYWJsZWQgPT09ICdZZXMnKSB8fFxyXG4gICAgICAoY29udGVudC50cmFja2FibGUgJiYgY29udGVudC50cmFja2FibGUuZW5hYmxlZCA9PT0gJ1llcycpKSkge1xyXG4gICAgICByZXR1cm4gRmxhdHRlbmVkVHlwZS5FWFBBTkQ7XHJcbiAgICB9IGVsc2UgaWYgKHRoaXMudHlwZSA9PT0gVG9jQ2FyZFR5cGUuVFJBQ0tBQkxFICYmXHJcbiAgICAgICgoY29udGVudC5jb250ZW50RGF0YSAmJiBjb250ZW50LmNvbnRlbnREYXRhLnRyYWNrYWJsZSAmJiBjb250ZW50LmNvbnRlbnREYXRhLnRyYWNrYWJsZS5lbmFibGVkID09PSAnWWVzJykgfHxcclxuICAgICAgICAoY29udGVudC50cmFja2FibGUgJiYgY29udGVudC50cmFja2FibGUuZW5hYmxlZCA9PT0gJ1llcycpKSkge1xyXG4gICAgICByZXR1cm4gRmxhdHRlbmVkVHlwZS5DT0xMQVBTRTtcclxuICAgIH1cclxuICAgIHJldHVybiAnJztcclxuICB9XHJcblxyXG4gIG5nT25EZXN0cm95KCkge1xyXG4gICAgdGhpcy5zdWJzY3JpcHRpb25zLmZvckVhY2gocyA9PiBzLnVuc3Vic2NyaWJlKCkpO1xyXG4gIH1cclxufVxyXG4iXX0=