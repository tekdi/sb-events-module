/**
 * @fileoverview added by tsickle
 * Generated from: lib/dynamic-dropdown/dynamic-dropdown.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter } from '@angular/core';
import { FormControl, FormGroup } from '@angular/forms';
import { Subject, merge } from 'rxjs';
import { tap } from 'rxjs/operators';
import * as _ from 'lodash-es';
import { ValueComparator } from '../utilities/value-comparator';
export class DynamicDropdownComponent {
    constructor() {
        this.ValueComparator = ValueComparator;
        this.onChangeFilter = new EventEmitter();
        this.dependencyTerms = [];
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (!this.options) {
            this.options = [];
        }
        if (this.isOptionsClosure(this.options)) {
            this.options$ = (/** @type {?} */ (((/** @type {?} */ (this.options)))(this.formControlRef, this.depends, this.formGroup, (/**
             * @return {?}
             */
            () => this.dataLoadStatusDelegate.next('LOADING')), (/**
             * @return {?}
             */
            () => this.dataLoadStatusDelegate.next('LOADED')))));
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (!this.options) {
            this.options = [];
        }
        // if (this.context) {
        // this.contextValueChangesSubscription = this.context.valueChanges.pipe(
        //   tap(() => {
        //     this.formControlRef.patchValue(null);
        //   })
        // ).subscribe();
        // }
        this.dataLoadStatusDelegate.subscribe(console.log);
        if (this.field && this.field.range) {
            this.options = this.field.range;
        }
        else if (_.isEmpty(this.options) && _.isEmpty(this.field.range) && this.default) {
            this.field.range = [];
            this.field.range.push(this.default);
        }
        if (!_.isEmpty(this.depends)) {
            this.contextValueChangesSubscription = merge(..._.map(this.depends, (/**
             * @param {?} depend
             * @return {?}
             */
            depend => depend.valueChanges))).pipe(tap((/**
             * @param {?} value
             * @return {?}
             */
            (value) => {
                this.latestParentValue = value;
                this.isDependsInvalid = _.includes(_.map(this.depends, (/**
                 * @param {?} depend
                 * @return {?}
                 */
                depend => depend.invalid)), true);
                this.formControlRef.patchValue(null);
            }))).subscribe();
            this.isDependsInvalid = _.includes(_.map(this.depends, (/**
             * @param {?} depend
             * @return {?}
             */
            depend => depend.invalid)), true);
        }
        if (this.isOptionsClosure(this.options)) {
            // tslint:disable-next-line:max-line-length
            this.options$ = (/** @type {?} */ (((/** @type {?} */ (this.options)))(this.formControlRef, this.depends, this.formGroup, (/**
             * @return {?}
             */
            () => this.dataLoadStatusDelegate.next('LOADING')), (/**
             * @return {?}
             */
            () => this.dataLoadStatusDelegate.next('LOADED')))));
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.contextValueChangesSubscription) {
            this.contextValueChangesSubscription.unsubscribe();
        }
    }
    /**
     * @param {?} options
     * @return {?}
     */
    isOptionsArray(options) {
        return Array.isArray(options);
    }
    /**
     * @param {?} options
     * @return {?}
     */
    isOptionsClosure(options) {
        return typeof options === 'function';
    }
    /**
     * @param {?} input
     * @return {?}
     */
    isOptionsMap(input) {
        return !Array.isArray(input) && typeof input === 'object';
    }
    /**
     * @param {?} input
     * @return {?}
     */
    isOptionsArrayMap(input) {
        return Array.isArray(input) && typeof input[0] === 'object';
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onChangeFacet($event) {
        /** @type {?} */
        const selectedObject = this.options.data[$event.currentTarget.options.selectedIndex - 1];
        /** @type {?} */
        const emitPayload = JSON.parse(JSON.stringify(this.options));
        emitPayload['data'] = selectedObject;
        emitPayload['selectedLabel'] = selectedObject.label;
        emitPayload['selectedValue'] = selectedObject.value;
        this.onChangeFilter.emit(emitPayload);
    }
    /**
     * @return {?}
     */
    fetchAssociations() {
        // && this.context.value && this.field.association
        if (!_.isEmpty(this.depends)) {
            /** @type {?} */
            const filteredTerm = _.find(this.dependencyTerms, (/**
             * @param {?} terms
             * @return {?}
             */
            terms => {
                return !_.isEmpty(this.field.output) ?
                    _.includes(this.getParentValue(), terms[this.field.output]) :
                    _.includes(this.getParentValue(), terms.name);
            }));
            if (filteredTerm) {
                this.tempAssociation = _.filter(filteredTerm.associations, (/**
                 * @param {?} association
                 * @return {?}
                 */
                association => {
                    return (this.field.sourceCategory) ?
                        (association.category === this.field.sourceCategory) :
                        association.category === this.field.code;
                }));
                return this.tempAssociation;
            }
            else {
                return this.options;
            }
        }
        else {
            return this.options;
        }
    }
    /**
     * @return {?}
     */
    getParentValue() {
        return this.latestParentValue || _.compact(_.map(this.depends, 'value'));
    }
    /**
     * @param {?} option
     * @return {?}
     */
    getOptionValueForTerms(option) {
        if (this.field.output) {
            if (this.field.dataType === 'list') {
                return [option[this.field.output]];
            }
            return option[this.field.output];
        }
        else {
            return this.field.dataType === 'list' ? [option.name] : option.name;
        }
    }
    /**
     * @param {?} option
     * @param {?} optionsType
     * @return {?}
     */
    getOptionValueForRange(option, optionsType) {
        if (this.field.output) {
            if (this.field.dataType === 'list') {
                if (optionsType === 'map' || optionsType === 'closure') {
                    return [option[this.field.output]] || [option.value] || [option.identifier] || [option.name] || [option.label];
                }
                else {
                    return [option];
                }
            }
            else {
                if (optionsType === 'map' || optionsType === 'closure') {
                    return option[this.field.output] || option.value || option.identifier || option.name || option.label;
                }
                else {
                    return option;
                }
            }
        }
        else {
            if (this.field.dataType === 'list') {
                if (optionsType === 'map' || optionsType === 'closure') {
                    return [option.value] || [option.identifier] || [option.name] || [option.label];
                }
                else {
                    return [option];
                }
            }
            else {
                if (optionsType === 'map' || optionsType === 'closure') {
                    return option.name || option.label || option.value || option.identifier;
                }
                else {
                    return option;
                }
            }
        }
    }
    /**
     * @param {?} option
     * @param {?=} output
     * @return {?}
     */
    convertOptionToArray(option, output) {
    }
}
DynamicDropdownComponent.decorators = [
    { type: Component, args: [{
                selector: 'sb-dynamic-dropdown',
                template: "<div class=\"sb-dropdown\" *ngIf=\"!type\">\n  <label>{{label}} {{context && 'has context'}}  {{context ?  field.context : '' }}</label>\n  <ng-container *ngIf=\"options\">\n    <div class=\"dropdown-container\">\n      <sb-icon-dropdown class=\"dropdown-icon\"></sb-icon-dropdown>\n      <!-- [attr.disabled]=\"disabled ? true : ( context ? (context.invalid ? true : null) : null )\" -->\n      <select [formControl]=\"formControlRef\"\n              [attr.disabled]=\"disabled ? true : ( depends ? (isDependsInvalid ? true : null) : null )\"\n              [compareWith]=\"ValueComparator.valueComparator\" class=\"sb-dropdown-select\" id=\"sb-dropdown\"\n              name=\"sb-dropdown\">\n        <option [defaultSelected]=\"!default\" [ngValue]=\"null\" disabled>{{placeholder}}\n        </option>\n        <ng-container *ngIf=\"field.range && isOptionsArrayMap(field.range) && !field.association\">\n          <option class=\"optionsArrayMap\" *ngFor=\"let option of field.range\" [ngValue]=\"getOptionValueForRange(option, 'map')\">{{option.label}}</option>\n        </ng-container>\n        <ng-container *ngIf=\"field.range && isOptionsArray(field.range) && !isOptionsArrayMap(field.range) && !field.association\">\n          <option class=\"optionsArray\" *ngFor=\"let option of field.range\" [ngValue]=\"getOptionValueForRange(option, 'array')\">{{option.name || option}}</option>\n        </ng-container>\n\n        <ng-container *ngIf=\"field.range && isOptionsClosure(field.range)\">\n          <option class=\"closure\" *ngFor=\"let option of options$ | async\" [ngValue]=\"getOptionValueForRange(option, 'closure')\">{{option.label}}</option>\n        </ng-container>\n\n        <!-- <ng-container *ngIf=\"isOptionsMap(options) && context && context.value && !field.association\">\n          <option *ngFor=\"let option of options[context.value]\" [ngValue]=\"option.value\">{{option.label}}</option>\n        </ng-container> -->\n\n        <ng-container *ngIf=\"!field.range && field.terms\">\n          <option class=\"optionsLast\" *ngFor=\"let option of fetchAssociations()\" [ngValue]=\"getOptionValueForTerms(option)\">{{option.name}}</option>\n        </ng-container>\n      </select>\n    </div>\n  </ng-container>\n</div>\n\n<!-- Dropdown for filters component -->\n<div class=\"sb-dropdown\" *ngIf=\"type === 'facet'\">\n  <label>{{label}}</label>\n  <ng-container *ngIf=\"options && options.data\">\n    <div class=\"dropdown-container\">\n      <sb-icon-dropdown class=\"dropdown-icon\"></sb-icon-dropdown>\n      <select [attr.disabled]=\"disabled ? true : ( context ? (context.invalid ? true : null) : null )\"\n        class=\"sb-dropdown-select\" [ngClass]=\"(styleClass ? styleClass : 'default-dropdown')\" id=\"sb-dropdown\" name=\"sb-dropdown\"\n        (change)=\"onChangeFacet($event)\" placeholder=\"placeholder\">\n        <option *ngIf=\"!default\" [disabled]=\"true\" selected>{{placeholder}}</option>\n        <option *ngFor=\"let option of options.data\" [ngValue]=\"option\" [selected]=\"options.default === option.value\">{{option.label}}</option>\n      </select>\n    </div>\n  </ng-container>\n</div>\n<ng-container *ngFor=\"let validation of validations\">\n  <div class=\"cf-error\"\n    *ngIf=\"(validation.type && (validation.type).toLowerCase() && validation.message && formControlRef.errors && formControlRef.errors[(validation.type).toLowerCase()] && (formControlRef.dirty || formControlRef.touched))\">\n    {{ validation.message }}\n  </div>\n</ng-container>\n\n<!-- Dropdown for filters component -->\n",
                styles: ["label{display:block;padding:10px;font-size:1rem}.dropdown-icon{position:absolute;top:.5rem;right:18px;z-index:1}.dropdown-container{position:relative}select[disabled]{opacity:.3}select{-webkit-appearance:none;-moz-appearance:none;text-indent:1px;text-overflow:''}.sb-dropdown-select{opacity:.99;color:#333;font-family:\"Noto Sans\";font-size:12px;font-weight:700;letter-spacing:0;line-height:17px}.sb-dropdown{margin-bottom:8px}.placeholder select option:first-child{color:#999}.option-default{color:#333;font-weight:700;font-size:12px}.sb-dropdown select{background-color:#fff;padding:10px 20px;font-size:14px;width:100%;border:.5px solid #333}.cf-error{color:red;font-family:\"Noto Sans\";font-size:12px}"]
            }] }
];
/** @nocollapse */
DynamicDropdownComponent.ctorParameters = () => [];
DynamicDropdownComponent.propDecorators = {
    field: [{ type: Input }],
    disabled: [{ type: Input }],
    options: [{ type: Input }],
    label: [{ type: Input }],
    placeholder: [{ type: Input }],
    isMultiple: [{ type: Input }],
    context: [{ type: Input }],
    contextTerms: [{ type: Input }],
    formControlRef: [{ type: Input }],
    formGroup: [{ type: Input }],
    default: [{ type: Input }],
    contextData: [{ type: Input }],
    dataLoadStatusDelegate: [{ type: Input }],
    type: [{ type: Input }],
    styleClass: [{ type: Input }],
    onChangeFilter: [{ type: Output }],
    validations: [{ type: Input }],
    depends: [{ type: Input }],
    dependencyTerms: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    DynamicDropdownComponent.prototype.ValueComparator;
    /** @type {?} */
    DynamicDropdownComponent.prototype.field;
    /** @type {?} */
    DynamicDropdownComponent.prototype.disabled;
    /** @type {?} */
    DynamicDropdownComponent.prototype.options;
    /** @type {?} */
    DynamicDropdownComponent.prototype.label;
    /** @type {?} */
    DynamicDropdownComponent.prototype.placeholder;
    /** @type {?} */
    DynamicDropdownComponent.prototype.isMultiple;
    /** @type {?} */
    DynamicDropdownComponent.prototype.context;
    /** @type {?} */
    DynamicDropdownComponent.prototype.contextTerms;
    /** @type {?} */
    DynamicDropdownComponent.prototype.formControlRef;
    /** @type {?} */
    DynamicDropdownComponent.prototype.formGroup;
    /** @type {?} */
    DynamicDropdownComponent.prototype.default;
    /** @type {?} */
    DynamicDropdownComponent.prototype.contextData;
    /** @type {?} */
    DynamicDropdownComponent.prototype.dataLoadStatusDelegate;
    /** @type {?} */
    DynamicDropdownComponent.prototype.type;
    /** @type {?} */
    DynamicDropdownComponent.prototype.styleClass;
    /** @type {?} */
    DynamicDropdownComponent.prototype.onChangeFilter;
    /** @type {?} */
    DynamicDropdownComponent.prototype.validations;
    /** @type {?} */
    DynamicDropdownComponent.prototype.depends;
    /** @type {?} */
    DynamicDropdownComponent.prototype.dependencyTerms;
    /** @type {?} */
    DynamicDropdownComponent.prototype.isDependsInvalid;
    /** @type {?} */
    DynamicDropdownComponent.prototype.options$;
    /** @type {?} */
    DynamicDropdownComponent.prototype.contextValueChangesSubscription;
    /** @type {?} */
    DynamicDropdownComponent.prototype.selectedType;
    /** @type {?} */
    DynamicDropdownComponent.prototype.tempAssociation;
    /** @type {?} */
    DynamicDropdownComponent.prototype.latestParentValue;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHluYW1pYy1kcm9wZG93bi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9jb21tb24tZm9ybS1lbGVtZW50cy8iLCJzb3VyY2VzIjpbImxpYi9keW5hbWljLWRyb3Bkb3duL2R5bmFtaWMtZHJvcGRvd24uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFDLFNBQVMsRUFBRSxLQUFLLEVBQWdDLE1BQU0sRUFBaUIsWUFBWSxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQ2xILE9BQU8sRUFBQyxXQUFXLEVBQUUsU0FBUyxFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFDdEQsT0FBTyxFQUFhLE9BQU8sRUFBK0IsS0FBSyxFQUFDLE1BQU0sTUFBTSxDQUFDO0FBRTdFLE9BQU8sRUFBQyxHQUFHLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUNuQyxPQUFPLEtBQUssQ0FBQyxNQUFNLFdBQVcsQ0FBQztBQUMvQixPQUFPLEVBQUMsZUFBZSxFQUFDLE1BQU0sK0JBQStCLENBQUM7QUFPOUQsTUFBTSxPQUFPLHdCQUF3QjtJQThCbkM7UUE3QkEsb0JBQWUsR0FBRyxlQUFlLENBQUM7UUFnQnhCLG1CQUFjLEdBQXNCLElBQUksWUFBWSxFQUFFLENBQUM7UUFJeEQsb0JBQWUsR0FBUyxFQUFFLENBQUM7SUFVcEMsQ0FBQzs7Ozs7SUFFRCxXQUFXLENBQUMsT0FBc0I7UUFDaEMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDakIsSUFBSSxDQUFDLE9BQU8sR0FBRyxFQUFFLENBQUM7U0FDbkI7UUFDRCxJQUFJLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEVBQUU7WUFDdkMsSUFBSSxDQUFDLFFBQVEsR0FBRyxtQkFBQSxDQUFDLG1CQUFBLElBQUksQ0FBQyxPQUFPLEVBQXlDLENBQUMsQ0FDckUsSUFBSSxDQUFDLGNBQWMsRUFDbkIsSUFBSSxDQUFDLE9BQU8sRUFDWixJQUFJLENBQUMsU0FBUzs7O1lBQ2QsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLElBQUksQ0FBQyxTQUFTLENBQUM7OztZQUNqRCxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUNqRCxFQUFPLENBQUM7U0FDVjtJQUNILENBQUM7Ozs7SUFFRCxRQUFRO1FBQ04sSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDakIsSUFBSSxDQUFDLE9BQU8sR0FBRyxFQUFFLENBQUM7U0FDbkI7UUFFRCxzQkFBc0I7UUFDcEIseUVBQXlFO1FBQ3pFLGdCQUFnQjtRQUNoQiw0Q0FBNEM7UUFDNUMsT0FBTztRQUNQLGlCQUFpQjtRQUNuQixJQUFJO1FBRUosSUFBSSxDQUFDLHNCQUFzQixDQUFDLFNBQVMsQ0FDbkMsT0FBTyxDQUFDLEdBQUcsQ0FDWixDQUFDO1FBRUYsSUFBSSxJQUFJLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFO1lBQ2xDLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUM7U0FDakM7YUFBTSxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ2pGLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQztZQUN0QixJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1NBQ3JDO1FBR0QsSUFBSSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQzdCLElBQUksQ0FBQywrQkFBK0IsR0FBSSxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPOzs7O1lBQUUsTUFBTSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsWUFBWSxFQUFDLENBQUMsQ0FBQyxJQUFJLENBQ3hHLEdBQUc7Ozs7WUFBQyxDQUFDLEtBQVUsRUFBRSxFQUFFO2dCQUNqQixJQUFJLENBQUMsaUJBQWlCLEdBQUcsS0FBSyxDQUFDO2dCQUMvQixJQUFJLENBQUMsZ0JBQWdCLEdBQUcsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPOzs7O2dCQUFFLE1BQU0sQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBQyxFQUFFLElBQUksQ0FBQyxDQUFDO2dCQUN4RixJQUFJLENBQUMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN2QyxDQUFDLEVBQUMsQ0FDRCxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBRWQsSUFBSSxDQUFDLGdCQUFnQixHQUFHLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTzs7OztZQUFFLE1BQU0sQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBQyxFQUFFLElBQUksQ0FBQyxDQUFDO1NBQ3pGO1FBR0QsSUFBSSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQ3ZDLDJDQUEyQztZQUMzQyxJQUFJLENBQUMsUUFBUSxHQUFHLG1CQUFBLENBQUMsbUJBQUEsSUFBSSxDQUFDLE9BQU8sRUFBeUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsU0FBUzs7O1lBQUUsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLElBQUksQ0FBQyxTQUFTLENBQUM7OztZQUFFLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUMsRUFBTyxDQUFDO1NBQ3hPO0lBQ0gsQ0FBQzs7OztJQUVELFdBQVc7UUFDVCxJQUFJLElBQUksQ0FBQywrQkFBK0IsRUFBRTtZQUN4QyxJQUFJLENBQUMsK0JBQStCLENBQUMsV0FBVyxFQUFFLENBQUM7U0FDcEQ7SUFDSCxDQUFDOzs7OztJQUVELGNBQWMsQ0FBQyxPQUFZO1FBQ3pCLE9BQU8sS0FBSyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUVoQyxDQUFDOzs7OztJQUVELGdCQUFnQixDQUFDLE9BQVk7UUFDM0IsT0FBTyxPQUFPLE9BQU8sS0FBSyxVQUFVLENBQUM7SUFDdkMsQ0FBQzs7Ozs7SUFFRCxZQUFZLENBQUMsS0FBVTtRQUNyQixPQUFPLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxPQUFPLEtBQUssS0FBSyxRQUFRLENBQUM7SUFDNUQsQ0FBQzs7Ozs7SUFFRCxpQkFBaUIsQ0FBQyxLQUFVO1FBQzFCLE9BQU8sS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxPQUFPLEtBQUssQ0FBQyxDQUFDLENBQUMsS0FBSyxRQUFRLENBQUM7SUFDOUQsQ0FBQzs7Ozs7SUFFRCxhQUFhLENBQUMsTUFBTTs7Y0FDWixjQUFjLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsYUFBYSxHQUFHLENBQUMsQ0FBQzs7Y0FDbEYsV0FBVyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDNUQsV0FBVyxDQUFDLE1BQU0sQ0FBQyxHQUFHLGNBQWMsQ0FBQztRQUNyQyxXQUFXLENBQUMsZUFBZSxDQUFDLEdBQUcsY0FBYyxDQUFDLEtBQUssQ0FBQztRQUNwRCxXQUFXLENBQUMsZUFBZSxDQUFDLEdBQUcsY0FBYyxDQUFDLEtBQUssQ0FBQztRQUNwRCxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUN4QyxDQUFDOzs7O0lBRUQsaUJBQWlCO1FBQ2Ysa0RBQWtEO1FBQ2xELElBQUksQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRTs7a0JBQ3RCLFlBQVksR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxlQUFlOzs7O1lBQUUsS0FBSyxDQUFDLEVBQUU7Z0JBQ3hELE9BQU8sQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztvQkFDdEMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLEVBQUUsS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUM3RCxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsRUFBRSxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUU7WUFDakQsQ0FBQyxFQUFDO1lBQ0YsSUFBSSxZQUFZLEVBQUU7Z0JBQ2hCLElBQUksQ0FBQyxlQUFlLEdBQUksQ0FBQyxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsWUFBWTs7OztnQkFBRSxXQUFXLENBQUMsRUFBRTtvQkFDeEUsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQzt3QkFDcEMsQ0FBQyxXQUFXLENBQUMsUUFBUSxLQUFLLElBQUksQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQzt3QkFDdEQsV0FBVyxDQUFDLFFBQVEsS0FBSyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQztnQkFDM0MsQ0FBQyxFQUFDLENBQUM7Z0JBQ0gsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDO2FBQzdCO2lCQUFPO2dCQUNOLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQzthQUNyQjtTQUNGO2FBQU07WUFDTCxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUM7U0FDckI7SUFDSCxDQUFDOzs7O0lBR0QsY0FBYztRQUNaLE9BQU8sSUFBSSxDQUFDLGlCQUFpQixJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUM7SUFDM0UsQ0FBQzs7Ozs7SUFFRCxzQkFBc0IsQ0FBQyxNQUFNO1FBQzNCLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUU7WUFDckIsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsS0FBSyxNQUFNLEVBQUU7Z0JBQ2xDLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO2FBQ3BDO1lBQ0QsT0FBTyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUNsQzthQUFNO1lBQ0wsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsS0FBSyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDO1NBQ3JFO0lBQ0gsQ0FBQzs7Ozs7O0lBRUQsc0JBQXNCLENBQUMsTUFBTSxFQUFFLFdBQVc7UUFDeEMsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRTtZQUNyQixJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxLQUFLLE1BQU0sRUFBRTtnQkFDbEMsSUFBSSxXQUFXLEtBQUssS0FBSyxJQUFJLFdBQVcsS0FBSyxTQUFTLEVBQUU7b0JBQ3RELE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO2lCQUNoSDtxQkFBTztvQkFDTixPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7aUJBQ2pCO2FBQ0Y7aUJBQU07Z0JBQ0wsSUFBSSxXQUFXLEtBQUssS0FBSyxJQUFJLFdBQVcsS0FBSyxTQUFTLEVBQUU7b0JBQ3RELE9BQU8sTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksTUFBTSxDQUFDLEtBQUssSUFBSSxNQUFNLENBQUMsVUFBVSxJQUFJLE1BQU0sQ0FBQyxJQUFJLElBQUksTUFBTSxDQUFDLEtBQUssQ0FBQztpQkFDdEc7cUJBQU87b0JBQ04sT0FBTyxNQUFNLENBQUM7aUJBQ2Y7YUFDRjtTQUNGO2FBQU07WUFDTCxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxLQUFLLE1BQU0sRUFBRTtnQkFDbEMsSUFBSSxXQUFXLEtBQUssS0FBSyxJQUFJLFdBQVcsS0FBSyxTQUFTLEVBQUU7b0JBQ3RELE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7aUJBQ2pGO3FCQUFPO29CQUNOLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztpQkFDakI7YUFDRjtpQkFBTTtnQkFDTCxJQUFJLFdBQVcsS0FBSyxLQUFLLElBQUksV0FBVyxLQUFLLFNBQVMsRUFBRTtvQkFDdEQsT0FBUSxNQUFNLENBQUMsSUFBSSxJQUFJLE1BQU0sQ0FBQyxLQUFLLElBQUksTUFBTSxDQUFDLEtBQUssSUFBSSxNQUFNLENBQUMsVUFBVSxDQUFDO2lCQUMxRTtxQkFBTztvQkFDTixPQUFPLE1BQU0sQ0FBQztpQkFDZjthQUNGO1NBQ0Y7SUFDSCxDQUFDOzs7Ozs7SUFFRCxvQkFBb0IsQ0FBQyxNQUFNLEVBQUUsTUFBTztJQUVwQyxDQUFDOzs7WUExTUYsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxxQkFBcUI7Z0JBQy9CLHMvR0FBZ0Q7O2FBRWpEOzs7OztvQkFHRSxLQUFLO3VCQUNMLEtBQUs7c0JBQ0wsS0FBSztvQkFDTCxLQUFLOzBCQUNMLEtBQUs7eUJBQ0wsS0FBSztzQkFDTCxLQUFLOzJCQUNMLEtBQUs7NkJBQ0wsS0FBSzt3QkFDTCxLQUFLO3NCQUNMLEtBQUs7MEJBQ0wsS0FBSztxQ0FDTCxLQUFLO21CQUNMLEtBQUs7eUJBQ0wsS0FBSzs2QkFDTCxNQUFNOzBCQUNOLEtBQUs7c0JBRUwsS0FBSzs4QkFDTCxLQUFLOzs7O0lBcEJOLG1EQUFrQzs7SUFDbEMseUNBQW9DOztJQUNwQyw0Q0FBNEI7O0lBQzVCLDJDQUFzQjs7SUFDdEIseUNBQXdCOztJQUN4QiwrQ0FBOEI7O0lBQzlCLDhDQUE4Qjs7SUFDOUIsMkNBQStCOztJQUMvQixnREFBNEI7O0lBQzVCLGtEQUFzQzs7SUFDdEMsNkNBQStCOztJQUMvQiwyQ0FBdUI7O0lBQ3ZCLCtDQUEwQjs7SUFDMUIsMERBQStEOztJQUMvRCx3Q0FBdUI7O0lBQ3ZCLDhDQUE2Qjs7SUFDN0Isa0RBQWlFOztJQUNqRSwrQ0FBMkI7O0lBRTNCLDJDQUFpQzs7SUFDakMsbURBQW9DOztJQUVwQyxvREFBNkI7O0lBRTdCLDRDQUFnRDs7SUFDaEQsbUVBQStDOztJQUMvQyxnREFBa0I7O0lBQ2xCLG1EQUFxQjs7SUFDckIscURBQTBCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDb21wb25lbnQsIElucHV0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSwgT25Jbml0LCBPdXRwdXQsIFNpbXBsZUNoYW5nZXMsIEV2ZW50RW1pdHRlcn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge0Zvcm1Db250cm9sLCBGb3JtR3JvdXB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7T2JzZXJ2YWJsZSwgU3ViamVjdCwgU3Vic2NyaXB0aW9uLCBjb21iaW5lTGF0ZXN0LCBtZXJnZX0gZnJvbSAncnhqcyc7XG5pbXBvcnQge0ZpZWxkQ29uZmlnLCBGaWVsZENvbmZpZ09wdGlvbiwgRmllbGRDb25maWdPcHRpb25zQnVpbGRlciwgRHluYW1pY0ZpZWxkQ29uZmlnT3B0aW9uc0J1aWxkZXJ9IGZyb20gJy4uL2NvbW1vbi1mb3JtLWNvbmZpZyc7XG5pbXBvcnQge3RhcH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0ICogYXMgXyBmcm9tICdsb2Rhc2gtZXMnO1xuaW1wb3J0IHtWYWx1ZUNvbXBhcmF0b3J9IGZyb20gJy4uL3V0aWxpdGllcy92YWx1ZS1jb21wYXJhdG9yJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnc2ItZHluYW1pYy1kcm9wZG93bicsXG4gIHRlbXBsYXRlVXJsOiAnLi9keW5hbWljLWRyb3Bkb3duLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vZHluYW1pYy1kcm9wZG93bi5jb21wb25lbnQuY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgRHluYW1pY0Ryb3Bkb3duQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSB7XG4gIFZhbHVlQ29tcGFyYXRvciA9IFZhbHVlQ29tcGFyYXRvcjtcbiAgQElucHV0KCkgZmllbGQ6IEZpZWxkQ29uZmlnPFN0cmluZz47XG4gIEBJbnB1dCgpIGRpc2FibGVkPzogYm9vbGVhbjtcbiAgQElucHV0KCkgb3B0aW9uczogYW55O1xuICBASW5wdXQoKSBsYWJlbD86IHN0cmluZztcbiAgQElucHV0KCkgcGxhY2Vob2xkZXI/OiBzdHJpbmc7XG4gIEBJbnB1dCgpIGlzTXVsdGlwbGU/OiBib29sZWFuO1xuICBASW5wdXQoKSBjb250ZXh0PzogRm9ybUNvbnRyb2w7XG4gIEBJbnB1dCgpIGNvbnRleHRUZXJtcz86IGFueTtcbiAgQElucHV0KCkgZm9ybUNvbnRyb2xSZWY/OiBGb3JtQ29udHJvbDtcbiAgQElucHV0KCkgZm9ybUdyb3VwPzogRm9ybUdyb3VwO1xuICBASW5wdXQoKSBkZWZhdWx0PzogYW55O1xuICBASW5wdXQoKSBjb250ZXh0RGF0YTogYW55O1xuICBASW5wdXQoKSBkYXRhTG9hZFN0YXR1c0RlbGVnYXRlOiBTdWJqZWN0PCdMT0FESU5HJyB8ICdMT0FERUQnPjtcbiAgQElucHV0KCkgdHlwZT86IHN0cmluZztcbiAgQElucHV0KCkgc3R5bGVDbGFzcz86IHN0cmluZztcbiAgQE91dHB1dCgpIG9uQ2hhbmdlRmlsdGVyOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgQElucHV0KCkgdmFsaWRhdGlvbnM/OiBhbnk7XG5cbiAgQElucHV0KCkgZGVwZW5kcz86IEZvcm1Db250cm9sW107XG4gIEBJbnB1dCgpIGRlcGVuZGVuY3lUZXJtcz86IGFueSA9IFtdO1xuXG4gIHB1YmxpYyBpc0RlcGVuZHNJbnZhbGlkOiBhbnk7XG5cbiAgb3B0aW9ucyQ/OiBPYnNlcnZhYmxlPEZpZWxkQ29uZmlnT3B0aW9uPGFueT5bXT47XG4gIGNvbnRleHRWYWx1ZUNoYW5nZXNTdWJzY3JpcHRpb24/OiBTdWJzY3JpcHRpb247XG4gIHNlbGVjdGVkVHlwZTogYW55O1xuICB0ZW1wQXNzb2NpYXRpb246IGFueTtcbiAgbGF0ZXN0UGFyZW50VmFsdWU6IHN0cmluZztcbiAgY29uc3RydWN0b3IoKSB7XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLm9wdGlvbnMpIHtcbiAgICAgIHRoaXMub3B0aW9ucyA9IFtdO1xuICAgIH1cbiAgICBpZiAodGhpcy5pc09wdGlvbnNDbG9zdXJlKHRoaXMub3B0aW9ucykpIHtcbiAgICAgIHRoaXMub3B0aW9ucyQgPSAodGhpcy5vcHRpb25zIGFzIER5bmFtaWNGaWVsZENvbmZpZ09wdGlvbnNCdWlsZGVyPGFueT4pKFxuICAgICAgICB0aGlzLmZvcm1Db250cm9sUmVmLFxuICAgICAgICB0aGlzLmRlcGVuZHMsXG4gICAgICAgIHRoaXMuZm9ybUdyb3VwLFxuICAgICAgICAoKSA9PiB0aGlzLmRhdGFMb2FkU3RhdHVzRGVsZWdhdGUubmV4dCgnTE9BRElORycpLFxuICAgICAgICAoKSA9PiB0aGlzLmRhdGFMb2FkU3RhdHVzRGVsZWdhdGUubmV4dCgnTE9BREVEJylcbiAgICAgICkgYXMgYW55O1xuICAgIH1cbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIGlmICghdGhpcy5vcHRpb25zKSB7XG4gICAgICB0aGlzLm9wdGlvbnMgPSBbXTtcbiAgICB9XG5cbiAgICAvLyBpZiAodGhpcy5jb250ZXh0KSB7XG4gICAgICAvLyB0aGlzLmNvbnRleHRWYWx1ZUNoYW5nZXNTdWJzY3JpcHRpb24gPSB0aGlzLmNvbnRleHQudmFsdWVDaGFuZ2VzLnBpcGUoXG4gICAgICAvLyAgIHRhcCgoKSA9PiB7XG4gICAgICAvLyAgICAgdGhpcy5mb3JtQ29udHJvbFJlZi5wYXRjaFZhbHVlKG51bGwpO1xuICAgICAgLy8gICB9KVxuICAgICAgLy8gKS5zdWJzY3JpYmUoKTtcbiAgICAvLyB9XG5cbiAgICB0aGlzLmRhdGFMb2FkU3RhdHVzRGVsZWdhdGUuc3Vic2NyaWJlKFxuICAgICAgY29uc29sZS5sb2dcbiAgICApO1xuXG4gICAgaWYgKHRoaXMuZmllbGQgJiYgdGhpcy5maWVsZC5yYW5nZSkge1xuICAgICAgdGhpcy5vcHRpb25zID0gdGhpcy5maWVsZC5yYW5nZTtcbiAgICB9IGVsc2UgaWYgKF8uaXNFbXB0eSh0aGlzLm9wdGlvbnMpICYmIF8uaXNFbXB0eSh0aGlzLmZpZWxkLnJhbmdlKSAmJiB0aGlzLmRlZmF1bHQpIHtcbiAgICAgIHRoaXMuZmllbGQucmFuZ2UgPSBbXTtcbiAgICAgIHRoaXMuZmllbGQucmFuZ2UucHVzaCh0aGlzLmRlZmF1bHQpO1xuICAgIH1cblxuXG4gICAgaWYgKCFfLmlzRW1wdHkodGhpcy5kZXBlbmRzKSkge1xuICAgICB0aGlzLmNvbnRleHRWYWx1ZUNoYW5nZXNTdWJzY3JpcHRpb24gPSAgbWVyZ2UoLi4uXy5tYXAodGhpcy5kZXBlbmRzLCBkZXBlbmQgPT4gZGVwZW5kLnZhbHVlQ2hhbmdlcykpLnBpcGUoXG4gICAgICB0YXAoKHZhbHVlOiBhbnkpID0+IHtcbiAgICAgICAgdGhpcy5sYXRlc3RQYXJlbnRWYWx1ZSA9IHZhbHVlO1xuICAgICAgICB0aGlzLmlzRGVwZW5kc0ludmFsaWQgPSBfLmluY2x1ZGVzKF8ubWFwKHRoaXMuZGVwZW5kcywgZGVwZW5kID0+IGRlcGVuZC5pbnZhbGlkKSwgdHJ1ZSk7XG4gICAgICAgIHRoaXMuZm9ybUNvbnRyb2xSZWYucGF0Y2hWYWx1ZShudWxsKTtcbiAgICAgIH0pXG4gICAgICApLnN1YnNjcmliZSgpO1xuXG4gICAgICB0aGlzLmlzRGVwZW5kc0ludmFsaWQgPSBfLmluY2x1ZGVzKF8ubWFwKHRoaXMuZGVwZW5kcywgZGVwZW5kID0+IGRlcGVuZC5pbnZhbGlkKSwgdHJ1ZSk7XG4gICAgfVxuXG5cbiAgICBpZiAodGhpcy5pc09wdGlvbnNDbG9zdXJlKHRoaXMub3B0aW9ucykpIHtcbiAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTptYXgtbGluZS1sZW5ndGhcbiAgICAgIHRoaXMub3B0aW9ucyQgPSAodGhpcy5vcHRpb25zIGFzIER5bmFtaWNGaWVsZENvbmZpZ09wdGlvbnNCdWlsZGVyPGFueT4pKHRoaXMuZm9ybUNvbnRyb2xSZWYsIHRoaXMuZGVwZW5kcywgdGhpcy5mb3JtR3JvdXAsICgpID0+IHRoaXMuZGF0YUxvYWRTdGF0dXNEZWxlZ2F0ZS5uZXh0KCdMT0FESU5HJyksICgpID0+IHRoaXMuZGF0YUxvYWRTdGF0dXNEZWxlZ2F0ZS5uZXh0KCdMT0FERUQnKSkgYXMgYW55O1xuICAgIH1cbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmNvbnRleHRWYWx1ZUNoYW5nZXNTdWJzY3JpcHRpb24pIHtcbiAgICAgIHRoaXMuY29udGV4dFZhbHVlQ2hhbmdlc1N1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgIH1cbiAgfVxuXG4gIGlzT3B0aW9uc0FycmF5KG9wdGlvbnM6IGFueSkge1xuICAgIHJldHVybiBBcnJheS5pc0FycmF5KG9wdGlvbnMpO1xuXG4gIH1cblxuICBpc09wdGlvbnNDbG9zdXJlKG9wdGlvbnM6IGFueSkge1xuICAgIHJldHVybiB0eXBlb2Ygb3B0aW9ucyA9PT0gJ2Z1bmN0aW9uJztcbiAgfVxuXG4gIGlzT3B0aW9uc01hcChpbnB1dDogYW55KSB7XG4gICAgcmV0dXJuICFBcnJheS5pc0FycmF5KGlucHV0KSAmJiB0eXBlb2YgaW5wdXQgPT09ICdvYmplY3QnO1xuICB9XG5cbiAgaXNPcHRpb25zQXJyYXlNYXAoaW5wdXQ6IGFueSkge1xuICAgIHJldHVybiBBcnJheS5pc0FycmF5KGlucHV0KSAmJiB0eXBlb2YgaW5wdXRbMF0gPT09ICdvYmplY3QnO1xuICB9XG5cbiAgb25DaGFuZ2VGYWNldCgkZXZlbnQpIHtcbiAgICBjb25zdCBzZWxlY3RlZE9iamVjdCA9IHRoaXMub3B0aW9ucy5kYXRhWyRldmVudC5jdXJyZW50VGFyZ2V0Lm9wdGlvbnMuc2VsZWN0ZWRJbmRleCAtIDFdO1xuICAgIGNvbnN0IGVtaXRQYXlsb2FkID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLm9wdGlvbnMpKTtcbiAgICBlbWl0UGF5bG9hZFsnZGF0YSddID0gc2VsZWN0ZWRPYmplY3Q7XG4gICAgZW1pdFBheWxvYWRbJ3NlbGVjdGVkTGFiZWwnXSA9IHNlbGVjdGVkT2JqZWN0LmxhYmVsO1xuICAgIGVtaXRQYXlsb2FkWydzZWxlY3RlZFZhbHVlJ10gPSBzZWxlY3RlZE9iamVjdC52YWx1ZTtcbiAgICB0aGlzLm9uQ2hhbmdlRmlsdGVyLmVtaXQoZW1pdFBheWxvYWQpO1xuICB9XG5cbiAgZmV0Y2hBc3NvY2lhdGlvbnMoKSB7XG4gICAgLy8gJiYgdGhpcy5jb250ZXh0LnZhbHVlICYmIHRoaXMuZmllbGQuYXNzb2NpYXRpb25cbiAgICBpZiAoIV8uaXNFbXB0eSh0aGlzLmRlcGVuZHMpKSB7XG4gICAgICBjb25zdCBmaWx0ZXJlZFRlcm0gPSBfLmZpbmQodGhpcy5kZXBlbmRlbmN5VGVybXMsIHRlcm1zID0+IHtcbiAgICAgICAgcmV0dXJuICFfLmlzRW1wdHkodGhpcy5maWVsZC5vdXRwdXQpID9cbiAgICAgICAgXy5pbmNsdWRlcyh0aGlzLmdldFBhcmVudFZhbHVlKCksIHRlcm1zW3RoaXMuZmllbGQub3V0cHV0XSkgOlxuICAgICAgICBfLmluY2x1ZGVzKHRoaXMuZ2V0UGFyZW50VmFsdWUoKSwgdGVybXMubmFtZSkgO1xuICAgICAgfSk7XG4gICAgICBpZiAoZmlsdGVyZWRUZXJtKSB7XG4gICAgICAgIHRoaXMudGVtcEFzc29jaWF0aW9uID0gIF8uZmlsdGVyKGZpbHRlcmVkVGVybS5hc3NvY2lhdGlvbnMsIGFzc29jaWF0aW9uID0+IHtcbiAgICAgICAgICByZXR1cm4gKHRoaXMuZmllbGQuc291cmNlQ2F0ZWdvcnkpID9cbiAgICAgICAgICAoYXNzb2NpYXRpb24uY2F0ZWdvcnkgPT09IHRoaXMuZmllbGQuc291cmNlQ2F0ZWdvcnkpIDpcbiAgICAgICAgICBhc3NvY2lhdGlvbi5jYXRlZ29yeSA9PT0gdGhpcy5maWVsZC5jb2RlO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudGVtcEFzc29jaWF0aW9uO1xuICAgICAgfSBlbHNlICB7XG4gICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnM7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0aGlzLm9wdGlvbnM7XG4gICAgfVxuICB9XG5cblxuICBnZXRQYXJlbnRWYWx1ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5sYXRlc3RQYXJlbnRWYWx1ZSB8fCBfLmNvbXBhY3QoXy5tYXAodGhpcy5kZXBlbmRzLCAndmFsdWUnKSk7XG4gIH1cblxuICBnZXRPcHRpb25WYWx1ZUZvclRlcm1zKG9wdGlvbikge1xuICAgIGlmICh0aGlzLmZpZWxkLm91dHB1dCkge1xuICAgICAgaWYgKHRoaXMuZmllbGQuZGF0YVR5cGUgPT09ICdsaXN0Jykge1xuICAgICAgICByZXR1cm4gW29wdGlvblt0aGlzLmZpZWxkLm91dHB1dF1dO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG9wdGlvblt0aGlzLmZpZWxkLm91dHB1dF07XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0aGlzLmZpZWxkLmRhdGFUeXBlID09PSAnbGlzdCcgPyBbb3B0aW9uLm5hbWVdIDogb3B0aW9uLm5hbWU7XG4gICAgfVxuICB9XG5cbiAgZ2V0T3B0aW9uVmFsdWVGb3JSYW5nZShvcHRpb24sIG9wdGlvbnNUeXBlKSB7XG4gICAgaWYgKHRoaXMuZmllbGQub3V0cHV0KSB7XG4gICAgICBpZiAodGhpcy5maWVsZC5kYXRhVHlwZSA9PT0gJ2xpc3QnKSB7XG4gICAgICAgIGlmIChvcHRpb25zVHlwZSA9PT0gJ21hcCcgfHwgb3B0aW9uc1R5cGUgPT09ICdjbG9zdXJlJykge1xuICAgICAgICAgIHJldHVybiBbb3B0aW9uW3RoaXMuZmllbGQub3V0cHV0XV0gfHwgW29wdGlvbi52YWx1ZV0gfHwgW29wdGlvbi5pZGVudGlmaWVyXSB8fCBbb3B0aW9uLm5hbWVdIHx8IFtvcHRpb24ubGFiZWxdO1xuICAgICAgICB9IGVsc2UgIHtcbiAgICAgICAgICByZXR1cm4gW29wdGlvbl07XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChvcHRpb25zVHlwZSA9PT0gJ21hcCcgfHwgb3B0aW9uc1R5cGUgPT09ICdjbG9zdXJlJykge1xuICAgICAgICAgIHJldHVybiBvcHRpb25bdGhpcy5maWVsZC5vdXRwdXRdIHx8IG9wdGlvbi52YWx1ZSB8fCBvcHRpb24uaWRlbnRpZmllciB8fCBvcHRpb24ubmFtZSB8fCBvcHRpb24ubGFiZWw7XG4gICAgICAgIH0gZWxzZSAge1xuICAgICAgICAgIHJldHVybiBvcHRpb247XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHRoaXMuZmllbGQuZGF0YVR5cGUgPT09ICdsaXN0Jykge1xuICAgICAgICBpZiAob3B0aW9uc1R5cGUgPT09ICdtYXAnIHx8IG9wdGlvbnNUeXBlID09PSAnY2xvc3VyZScpIHtcbiAgICAgICAgICByZXR1cm4gW29wdGlvbi52YWx1ZV0gfHwgW29wdGlvbi5pZGVudGlmaWVyXSB8fCBbb3B0aW9uLm5hbWVdIHx8IFtvcHRpb24ubGFiZWxdO1xuICAgICAgICB9IGVsc2UgIHtcbiAgICAgICAgICByZXR1cm4gW29wdGlvbl07XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChvcHRpb25zVHlwZSA9PT0gJ21hcCcgfHwgb3B0aW9uc1R5cGUgPT09ICdjbG9zdXJlJykge1xuICAgICAgICAgIHJldHVybiAgb3B0aW9uLm5hbWUgfHwgb3B0aW9uLmxhYmVsIHx8IG9wdGlvbi52YWx1ZSB8fCBvcHRpb24uaWRlbnRpZmllcjtcbiAgICAgICAgfSBlbHNlICB7XG4gICAgICAgICAgcmV0dXJuIG9wdGlvbjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGNvbnZlcnRPcHRpb25Ub0FycmF5KG9wdGlvbiwgb3V0cHV0Pykge1xuXG4gIH1cbn1cbiJdfQ==