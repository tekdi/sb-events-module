/**
 * @fileoverview added by tsickle
 * Generated from: lib/form/form.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, EventEmitter, Input, Output } from '@angular/core';
import { FieldConfigInputType, FieldConfigValidationType } from '../common-form-config';
import { FormBuilder, FormGroup, Validators } from '@angular/forms';
import { Subject } from 'rxjs';
import { distinctUntilChanged, map, scan, tap } from 'rxjs/operators';
var FormComponent = /** @class */ (function () {
    function FormComponent(formBuilder) {
        this.formBuilder = formBuilder;
        this.initialize = new EventEmitter();
        this.finalize = new EventEmitter();
        this.linkClicked = new EventEmitter();
        this.valueChanges = new EventEmitter();
        this.statusChanges = new EventEmitter();
        this.platform = 'web';
        this.dataLoadStatus = new EventEmitter();
        this.dataLoadStatusDelegate = new Subject();
        this.FieldConfigInputType = FieldConfigInputType;
        if (!window['forms']) {
            window['forms'] = [];
        }
        window['forms'].push(this);
    }
    /**
     * @return {?}
     */
    FormComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.finalize.emit();
        if (this.statusChangesSubscription) {
            this.statusChangesSubscription.unsubscribe();
        }
        if (this.valueChangesSubscription) {
            this.valueChangesSubscription.unsubscribe();
        }
        if (this.dataLoadStatusSinkSubscription) {
            this.dataLoadStatusSinkSubscription.unsubscribe();
        }
    };
    /**
     * @return {?}
     */
    FormComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    FormComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        var _this = this;
        if (changes['config']) {
            if ((changes['config'].currentValue && changes['config'].firstChange) || changes['config'].previousValue !== changes['config'].currentValue) {
                this.initializeForm();
            }
        }
        if (this.dataLoadStatusSinkSubscription) {
            this.dataLoadStatusSinkSubscription.unsubscribe();
        }
        if (this.statusChangesSubscription) {
            this.statusChangesSubscription.unsubscribe();
        }
        if (this.valueChangesSubscription) {
            this.valueChangesSubscription.unsubscribe();
        }
        this.dataLoadStatusSinkSubscription = this.dataLoadStatusDelegate.pipe(scan((/**
         * @param {?} acc
         * @param {?} event
         * @return {?}
         */
        function (acc, event) {
            if (event === 'LOADED') {
                acc.loadedCount++;
                return acc;
            }
            acc.loadingCount++;
            return acc;
        }), { loadingCount: 0, loadedCount: 0 }), map((/**
         * @param {?} aggregates
         * @return {?}
         */
        function (aggregates) {
            if (aggregates.loadingCount !== aggregates.loadedCount) {
                return 'LOADING';
            }
            return 'LOADED';
        })), distinctUntilChanged(), tap((/**
         * @param {?} result
         * @return {?}
         */
        function (result) {
            if (result === 'LOADING') {
                _this.dataLoadStatus.emit('LOADING');
            }
            else {
                _this.dataLoadStatus.emit('LOADED');
            }
        }))).subscribe();
        this.statusChangesSubscription = this.formGroup.statusChanges.pipe(tap((/**
         * @param {?} v
         * @return {?}
         */
        function (v) {
            _this.statusChanges.emit({
                isPristine: _this.formGroup.pristine,
                isDirty: _this.formGroup.dirty,
                isInvalid: _this.formGroup.invalid,
                isValid: _this.formGroup.valid
            });
        }))).subscribe();
        this.valueChangesSubscription = this.formGroup.valueChanges.pipe(tap((/**
         * @param {?} v
         * @return {?}
         */
        function (v) {
            _this.valueChanges.emit(v);
        }))).subscribe();
    };
    /**
     * @param {?} nestedFormGroup
     * @param {?} fieldConfig
     * @return {?}
     */
    FormComponent.prototype.onNestedFormFinalize = /**
     * @param {?} nestedFormGroup
     * @param {?} fieldConfig
     * @return {?}
     */
    function (nestedFormGroup, fieldConfig) {
        if (!this.formGroup.get('children') || !this.formGroup.get("children." + fieldConfig.code)) {
            return;
        }
        ((/** @type {?} */ (this.formGroup.get('children')))).removeControl(fieldConfig.code);
        if (!Object.keys(((/** @type {?} */ (this.formGroup.get('children')))).controls).length) {
            this.formGroup.removeControl('children');
        }
    };
    /**
     * @param {?} nestedFormGroup
     * @param {?} fieldConfig
     * @return {?}
     */
    FormComponent.prototype.onNestedFormInitialize = /**
     * @param {?} nestedFormGroup
     * @param {?} fieldConfig
     * @return {?}
     */
    function (nestedFormGroup, fieldConfig) {
        if (!this.formGroup.get('children')) {
            this.formGroup.addControl('children', new FormGroup({}));
        }
        ((/** @type {?} */ (this.formGroup.get('children')))).removeControl(fieldConfig.code);
        ((/** @type {?} */ (this.formGroup.get('children')))).addControl(fieldConfig.code, nestedFormGroup);
    };
    /**
     * @private
     * @return {?}
     */
    FormComponent.prototype.initializeForm = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.config.length) {
            console.error('FORM LIST IS EMPTY');
            return;
        }
        /** @type {?} */
        var formGroupData = {};
        this.config.forEach((/**
         * @param {?} element
         * @param {?} index
         * @return {?}
         */
        function (element, index) {
            if (element.type !== FieldConfigInputType.LABEL) {
                /** @type {?} */
                var formValueList = _this.prepareFormValidationData(element, index);
                formGroupData[element.code] = formValueList;
            }
        }));
        this.formGroup = this.formBuilder.group(formGroupData);
        this.initialize.emit(this.formGroup);
    };
    /**
     * @private
     * @param {?} element
     * @param {?} index
     * @return {?}
     */
    FormComponent.prototype.prepareFormValidationData = /**
     * @private
     * @param {?} element
     * @param {?} index
     * @return {?}
     */
    function (element, index) {
        /** @type {?} */
        var formValueList = [];
        /** @type {?} */
        var validationList = [];
        /** @type {?} */
        var defaultVal = '';
        switch (element.type) {
            case FieldConfigInputType.INPUT:
                defaultVal = element.templateOptions.type === 'number' ?
                    (element.default && Number.isInteger(element.default) ? element.default : 0) :
                    (element.default && (typeof element.default) === 'string' ? element.default : '');
                break;
            case FieldConfigInputType.SELECT:
            case FieldConfigInputType.NESTED_SELECT:
                defaultVal = element.templateOptions.multiple ?
                    (element.default && Array.isArray(element.default) ? element.default : []) : (element.default || null);
                break;
            case FieldConfigInputType.CHECKBOX:
                defaultVal = false || !!element.default;
                break;
        }
        formValueList.push(defaultVal);
        if (element.validations && element.validations.length) {
            element.validations.forEach((/**
             * @param {?} data
             * @param {?} i
             * @return {?}
             */
            function (data, i) {
                switch (data.type) {
                    case FieldConfigValidationType.REQUIRED:
                        if (element.type === FieldConfigInputType.CHECKBOX) {
                            validationList.push(Validators.requiredTrue);
                        }
                        else if (element.type === FieldConfigInputType.SELECT || element.type === FieldConfigInputType.NESTED_SELECT) {
                            validationList.push((/**
                             * @param {?} c
                             * @return {?}
                             */
                            function (c) {
                                if (element.templateOptions.multiple) {
                                    return c.value && c.value.length ? null : 'error';
                                }
                                return !!c.value ? null : 'error';
                            }));
                        }
                        else {
                            validationList.push(Validators.required);
                        }
                        break;
                    case FieldConfigValidationType.PATTERN:
                        validationList.push(Validators.pattern((/** @type {?} */ (element.validations[i].value))));
                        break;
                    case FieldConfigValidationType.MINLENGTH:
                        validationList.push(Validators.minLength((/** @type {?} */ (element.validations[i].value))));
                        break;
                    case FieldConfigValidationType.MAXLENGTH:
                        validationList.push(Validators.maxLength((/** @type {?} */ (element.validations[i].value))));
                        break;
                }
            }));
        }
        formValueList.push(Validators.compose(validationList));
        return formValueList;
    };
    /**
     * @param {?} event
     * @return {?}
     */
    FormComponent.prototype.clickedLink = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.linkClicked.emit(event);
    };
    FormComponent.decorators = [
        { type: Component, args: [{
                    selector: 'sb-form',
                    template: "<div [formGroup]=\"formGroup\">\n  <ng-container *ngFor=\"let field of config; let index = i\">\n      <!-- <div *ngIf=\"field.type === FieldConfigInputType.SELECT && !field.templateOptions.multiple\" [hidden]=\"field.templateOptions?.hidden || null\">\n        <sb-dropdown [context]=\"field.context ? formGroup.get(field.context) : null \" [default]=\"field.default\"\n          [formControlRef]=\"formGroup.get(field.code)\" [label]=\"field.templateOptions.label\"\n          [dataLoadStatusDelegate]=\"dataLoadStatusDelegate\" [options]=\"field.templateOptions?.options\"\n          [disabled]=\"field.templateOptions?.disabled\" [placeHolder]=\"field?.templateOptions?.placeHolder\">\n        </sb-dropdown>\n      </div>\n    <div *ngIf=\"field.type === FieldConfigInputType.NESTED_SELECT\" [hidden]=\"field.templateOptions?.hidden || null\">\n      <sb-dropdown [context]=\"field.context ? formGroup.get(field.context) : null \" [default]=\"field.default\"\n        [formControlRef]=\"formGroup.get(field.code)\" [label]=\"field.templateOptions.label\"\n        [dataLoadStatusDelegate]=\"dataLoadStatusDelegate\" [options]=\"field.templateOptions?.options\"\n        [disabled]=\"field.templateOptions?.disabled\" [placeHolder]=\"field?.templateOptions?.placeHolder\">\n      </sb-dropdown>\n    </div> -->\n    <div *ngIf=\"field.type === FieldConfigInputType.SELECT || field.type === FieldConfigInputType.NESTED_SELECT\" [hidden]=\"field.templateOptions?.hidden || null\">\n      <sb-multiple-dropdown [context]=\"field.context ? formGroup.get(field.context) : null \" [default]=\"field.default\"\n        [formControlRef]=\"formGroup.get(field.code)\" [options]=\"field.templateOptions?.options\"\n        [label]=\"field.templateOptions.label\" [dataLoadStatusDelegate]=\"dataLoadStatusDelegate\"\n        [disabled]=\"field.templateOptions?.disabled\" [placeHolder]=\"field?.templateOptions?.placeHolder\" \n        [isMultiple]=\"field.templateOptions.multiple\" [labelHtml]=\"field.templateOptions.labelHtml\">\n      </sb-multiple-dropdown>\n    </div>\n    <div *ngIf=\"field.type === FieldConfigInputType.INPUT\" [hidden]=\"field.templateOptions?.hidden || null\">\n      <sb-textbox [formControlRef]=\"formGroup.get(field.code)\" [asyncValidation]=\"field.asyncValidation\" [label]=\"field.templateOptions.label\"\n        [placeholder]=\"field.templateOptions.placeHolder\" [validations]=\"field.validations\" [prefix]=\"field.templateOptions.prefix\"\n        [labelHtml]=\"field.templateOptions.labelHtml\">\n      </sb-textbox>\n    </div>\n    <div *ngIf=\"field.type === FieldConfigInputType.TEXTAREA\" [hidden]=\"field.templateOptions?.hidden || null\">\n      <sb-textarea [config]=\"field\" [formControlRef]=\"formGroup.get(field.code)\" [label]=\"field.templateOptions.label\"\n        [placeholder]=\"field.templateOptions.placeHolder\">\n      </sb-textarea>\n    </div>\n    <div *ngIf=\"field.type === FieldConfigInputType.CHECKBOX\" [hidden]=\"field.templateOptions?.hidden || null\">\n      <sb-checkbox [code]=\"field.code\" [formControlRef]=\"formGroup.get(field.code)\"\n        [label]=\"field.templateOptions.label\" [labelHtml]=\"field.templateOptions.labelHtml\" [value]=\"field.default\"\n        (clickedLink)=\"clickedLink($event)\"></sb-checkbox>\n    </div>\n    <div *ngIf=\"asyncValidatorFactory && field.asyncValidation?.trigger\">\n      <button #validationTrigger [attr.data-marker]=\"field.asyncValidation.marker\">\n        {{field.asyncValidation.trigger}}\n      </button>\n    </div>\n    <ng-container *ngIf=\"formGroup.get(field.code) as ref\">\n      <div *ngIf=\"field.type === FieldConfigInputType.NESTED_SELECT && ref && ref.value && field.children && field.children[ref.value]\">\n        <sb-form (initialize)=\"onNestedFormInitialize($event, field)\" (finalize)=\"onNestedFormFinalize($event, field)\"\n          [dataLoadStatusDelegate]=\"dataLoadStatusDelegate\" [config]=\"field.children[ref.value]\"></sb-form>\n      </div>\n\n      <div *ngIf=\"field.type === FieldConfigInputType.NESTED_GROUP && field.children\">\n        <sb-form (initialize)=\"onNestedFormInitialize($event, field)\" (finalize)=\"onNestedFormFinalize($event, field)\"\n          [dataLoadStatusDelegate]=\"dataLoadStatusDelegate\" [config]=\"field.children\"></sb-form>\n      </div>\n    </ng-container>\n\n    <ng-container *ngIf=\"field.type === FieldConfigInputType.LABEL\">\n      <label *ngIf=\"field.templateOptions?.label\">{{field.templateOptions?.label}}</label>\n      <div *ngIf=\"field.templateOptions?.labelHtml\" [innerHTML]=\"field.templateOptions?.labelHtml | transposeHtml\"></div>\n    </ng-container>\n    \n  </ng-container>\n</div>",
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    FormComponent.ctorParameters = function () { return [
        { type: FormBuilder }
    ]; };
    FormComponent.propDecorators = {
        initialize: [{ type: Output }],
        finalize: [{ type: Output }],
        linkClicked: [{ type: Output }],
        valueChanges: [{ type: Output }],
        statusChanges: [{ type: Output }],
        platform: [{ type: Input }],
        dataLoadStatus: [{ type: Output }],
        config: [{ type: Input }],
        dataLoadStatusDelegate: [{ type: Input }],
        asyncValidatorFactory: [{ type: Input }]
    };
    return FormComponent;
}());
export { FormComponent };
if (false) {
    /** @type {?} */
    FormComponent.prototype.initialize;
    /** @type {?} */
    FormComponent.prototype.finalize;
    /** @type {?} */
    FormComponent.prototype.linkClicked;
    /** @type {?} */
    FormComponent.prototype.valueChanges;
    /** @type {?} */
    FormComponent.prototype.statusChanges;
    /** @type {?} */
    FormComponent.prototype.platform;
    /** @type {?} */
    FormComponent.prototype.dataLoadStatus;
    /** @type {?} */
    FormComponent.prototype.config;
    /** @type {?} */
    FormComponent.prototype.dataLoadStatusDelegate;
    /** @type {?} */
    FormComponent.prototype.asyncValidatorFactory;
    /** @type {?} */
    FormComponent.prototype.formGroup;
    /** @type {?} */
    FormComponent.prototype.FieldConfigInputType;
    /**
     * @type {?}
     * @private
     */
    FormComponent.prototype.statusChangesSubscription;
    /**
     * @type {?}
     * @private
     */
    FormComponent.prototype.valueChangesSubscription;
    /**
     * @type {?}
     * @private
     */
    FormComponent.prototype.dataLoadStatusSinkSubscription;
    /**
     * @type {?}
     * @private
     */
    FormComponent.prototype.formBuilder;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9jb21tb24tZm9ybS1lbGVtZW50cy8iLCJzb3VyY2VzIjpbImxpYi9mb3JtL2Zvcm0uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUVMLFNBQVMsRUFDVCxZQUFZLEVBQ1osS0FBSyxFQUlMLE1BQU0sRUFJUCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQXFDLG9CQUFvQixFQUFFLHlCQUF5QixFQUFDLE1BQU0sdUJBQXVCLENBQUM7QUFDMUgsT0FBTyxFQUFDLFdBQVcsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFDbEUsT0FBTyxFQUFDLE9BQU8sRUFBZSxNQUFNLE1BQU0sQ0FBQztBQUMzQyxPQUFPLEVBQUMsb0JBQW9CLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUVwRTtJQXlCRSx1QkFDVSxXQUF3QjtRQUF4QixnQkFBVyxHQUFYLFdBQVcsQ0FBYTtRQXBCeEIsZUFBVSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDaEMsYUFBUSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDOUIsZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ2pDLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUNsQyxrQkFBYSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDcEMsYUFBUSxHQUFxQixLQUFLLENBQUM7UUFDbEMsbUJBQWMsR0FBRyxJQUFJLFlBQVksRUFBd0IsQ0FBQztRQUUzRCwyQkFBc0IsR0FBRyxJQUFJLE9BQU8sRUFBd0IsQ0FBQztRQUt0RSx5QkFBb0IsR0FBRyxvQkFBb0IsQ0FBQztRQVMxQyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQ3BCLE1BQU0sQ0FBQyxPQUFPLENBQUMsR0FBRyxF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QWE7OztJQUN4QixtQ0FBMEM7O0lBQzFDLGlDQUF3Qzs7SUFDeEMsb0NBQTJDOztJQUMzQyxxQ0FBNEM7O0lBQzVDLHNDQUE2Qzs7SUFDN0MsaUNBQTRDOztJQUM1Qyx1Q0FBb0U7O0lBQ3BFLCtCQUFnQjs7SUFDaEIsK0NBQXNFOztJQUN0RSw4Q0FBdUQ7O0lBRXZELGtDQUFxQjs7SUFFckIsNkNBQTRDOzs7OztJQUU1QyxrREFBZ0Q7Ozs7O0lBQ2hELGlEQUErQzs7Ozs7SUFDL0MsdURBQXFEOzs7OztJQUduRCxvQ0FBZ0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBBZnRlclZpZXdJbml0LFxuICBDb21wb25lbnQsXG4gIEV2ZW50RW1pdHRlcixcbiAgSW5wdXQsXG4gIE9uQ2hhbmdlcyxcbiAgT25EZXN0cm95LFxuICBPbkluaXQsXG4gIE91dHB1dCxcbiAgUXVlcnlMaXN0LFxuICBTaW1wbGVDaGFuZ2VzLFxuICBWaWV3Q2hpbGRyZW5cbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge0FzeW5jVmFsaWRhdG9yRmFjdG9yeSwgRmllbGRDb25maWcsIEZpZWxkQ29uZmlnSW5wdXRUeXBlLCBGaWVsZENvbmZpZ1ZhbGlkYXRpb25UeXBlfSBmcm9tICcuLi9jb21tb24tZm9ybS1jb25maWcnO1xuaW1wb3J0IHtGb3JtQnVpbGRlciwgRm9ybUdyb3VwLCBWYWxpZGF0b3JzfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQge1N1YmplY3QsIFN1YnNjcmlwdGlvbn0gZnJvbSAncnhqcyc7XG5pbXBvcnQge2Rpc3RpbmN0VW50aWxDaGFuZ2VkLCBtYXAsIHNjYW4sIHRhcH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdzYi1mb3JtJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2Zvcm0uY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9mb3JtLmNvbXBvbmVudC5jc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBGb3JtQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSB7XG4gIEBPdXRwdXQoKSBpbml0aWFsaXplID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICBAT3V0cHV0KCkgZmluYWxpemUgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIEBPdXRwdXQoKSBsaW5rQ2xpY2tlZCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgQE91dHB1dCgpIHZhbHVlQ2hhbmdlcyA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgQE91dHB1dCgpIHN0YXR1c0NoYW5nZXMgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIEBJbnB1dCgpIHBsYXRmb3JtOiAnbW9iaWxlJyB8ICd3ZWInID0gJ3dlYic7XG4gIEBPdXRwdXQoKSBkYXRhTG9hZFN0YXR1cyA9IG5ldyBFdmVudEVtaXR0ZXI8J0xPQURJTkcnIHwgJ0xPQURFRCc+KCk7XG4gIEBJbnB1dCgpIGNvbmZpZztcbiAgQElucHV0KCkgZGF0YUxvYWRTdGF0dXNEZWxlZ2F0ZSA9IG5ldyBTdWJqZWN0PCdMT0FESU5HJyB8ICdMT0FERUQnPigpO1xuICBASW5wdXQoKSBhc3luY1ZhbGlkYXRvckZhY3Rvcnk/OiBBc3luY1ZhbGlkYXRvckZhY3Rvcnk7XG5cbiAgZm9ybUdyb3VwOiBGb3JtR3JvdXA7XG5cbiAgRmllbGRDb25maWdJbnB1dFR5cGUgPSBGaWVsZENvbmZpZ0lucHV0VHlwZTtcblxuICBwcml2YXRlIHN0YXR1c0NoYW5nZXNTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcbiAgcHJpdmF0ZSB2YWx1ZUNoYW5nZXNTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcbiAgcHJpdmF0ZSBkYXRhTG9hZFN0YXR1c1NpbmtTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGZvcm1CdWlsZGVyOiBGb3JtQnVpbGRlclxuICApIHtcbiAgICBpZiAoIXdpbmRvd1snZm9ybXMnXSkge1xuICAgICAgd2luZG93Wydmb3JtcyddID0gW107XG4gICAgfVxuICAgIHdpbmRvd1snZm9ybXMnXS5wdXNoKHRoaXMpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy5maW5hbGl6ZS5lbWl0KCk7XG5cbiAgICBpZiAodGhpcy5zdGF0dXNDaGFuZ2VzU3Vic2NyaXB0aW9uKSB7XG4gICAgICB0aGlzLnN0YXR1c0NoYW5nZXNTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy52YWx1ZUNoYW5nZXNTdWJzY3JpcHRpb24pIHtcbiAgICAgIHRoaXMudmFsdWVDaGFuZ2VzU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZGF0YUxvYWRTdGF0dXNTaW5rU3Vic2NyaXB0aW9uKSB7XG4gICAgICB0aGlzLmRhdGFMb2FkU3RhdHVzU2lua1N1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgIH1cbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuICAgIGlmIChjaGFuZ2VzWydjb25maWcnXSkge1xuICAgICAgaWYgKChjaGFuZ2VzWydjb25maWcnXS5jdXJyZW50VmFsdWUgJiYgY2hhbmdlc1snY29uZmlnJ10uZmlyc3RDaGFuZ2UpIHx8IGNoYW5nZXNbJ2NvbmZpZyddLnByZXZpb3VzVmFsdWUgIT09IGNoYW5nZXNbJ2NvbmZpZyddLmN1cnJlbnRWYWx1ZSkge1xuICAgICAgICB0aGlzLmluaXRpYWxpemVGb3JtKCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZGF0YUxvYWRTdGF0dXNTaW5rU3Vic2NyaXB0aW9uKSB7XG4gICAgICB0aGlzLmRhdGFMb2FkU3RhdHVzU2lua1N1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnN0YXR1c0NoYW5nZXNTdWJzY3JpcHRpb24pIHtcbiAgICAgIHRoaXMuc3RhdHVzQ2hhbmdlc1N1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnZhbHVlQ2hhbmdlc1N1YnNjcmlwdGlvbikge1xuICAgICAgdGhpcy52YWx1ZUNoYW5nZXNTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB9XG5cbiAgICB0aGlzLmRhdGFMb2FkU3RhdHVzU2lua1N1YnNjcmlwdGlvbiA9IHRoaXMuZGF0YUxvYWRTdGF0dXNEZWxlZ2F0ZS5waXBlKFxuICAgICAgc2NhbjwnTE9BRElORycgfCAnTE9BREVEJywgeyBsb2FkaW5nQ291bnQ6IDAsIGxvYWRlZENvdW50OiAwIH0+KChhY2MsIGV2ZW50KSA9PiB7XG4gICAgICAgIGlmIChldmVudCA9PT0gJ0xPQURFRCcpIHtcbiAgICAgICAgICBhY2MubG9hZGVkQ291bnQrKztcbiAgICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgICB9XG5cbiAgICAgICAgYWNjLmxvYWRpbmdDb3VudCsrO1xuICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgfSwge2xvYWRpbmdDb3VudDogMCwgbG9hZGVkQ291bnQ6IDB9KSxcbiAgICAgIG1hcDx7IGxvYWRpbmdDb3VudDogMCwgbG9hZGVkQ291bnQ6IDAgfSwgJ0xPQURJTkcnIHwgJ0xPQURFRCc+KChhZ2dyZWdhdGVzKSA9PiB7XG4gICAgICAgIGlmIChhZ2dyZWdhdGVzLmxvYWRpbmdDb3VudCAhPT0gYWdncmVnYXRlcy5sb2FkZWRDb3VudCkge1xuICAgICAgICAgIHJldHVybiAnTE9BRElORyc7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gJ0xPQURFRCc7XG4gICAgICB9KSxcbiAgICAgIGRpc3RpbmN0VW50aWxDaGFuZ2VkKCksXG4gICAgICB0YXAoKHJlc3VsdCkgPT4ge1xuICAgICAgICBpZiAocmVzdWx0ID09PSAnTE9BRElORycpIHtcbiAgICAgICAgICB0aGlzLmRhdGFMb2FkU3RhdHVzLmVtaXQoJ0xPQURJTkcnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmRhdGFMb2FkU3RhdHVzLmVtaXQoJ0xPQURFRCcpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICkuc3Vic2NyaWJlKCk7XG5cbiAgICB0aGlzLnN0YXR1c0NoYW5nZXNTdWJzY3JpcHRpb24gPSB0aGlzLmZvcm1Hcm91cC5zdGF0dXNDaGFuZ2VzLnBpcGUoXG4gICAgICB0YXAoKHYpID0+IHtcbiAgICAgICAgdGhpcy5zdGF0dXNDaGFuZ2VzLmVtaXQoe1xuICAgICAgICAgIGlzUHJpc3RpbmU6IHRoaXMuZm9ybUdyb3VwLnByaXN0aW5lLFxuICAgICAgICAgIGlzRGlydHk6IHRoaXMuZm9ybUdyb3VwLmRpcnR5LFxuICAgICAgICAgIGlzSW52YWxpZDogdGhpcy5mb3JtR3JvdXAuaW52YWxpZCxcbiAgICAgICAgICBpc1ZhbGlkOiB0aGlzLmZvcm1Hcm91cC52YWxpZFxuICAgICAgICB9KTtcbiAgICAgIH0pXG4gICAgKS5zdWJzY3JpYmUoKTtcblxuICAgIHRoaXMudmFsdWVDaGFuZ2VzU3Vic2NyaXB0aW9uID0gdGhpcy5mb3JtR3JvdXAudmFsdWVDaGFuZ2VzLnBpcGUoXG4gICAgICB0YXAoKHYpID0+IHtcbiAgICAgICAgdGhpcy52YWx1ZUNoYW5nZXMuZW1pdCh2KTtcbiAgICAgIH0pXG4gICAgKS5zdWJzY3JpYmUoKTtcbiAgfVxuXG4gIG9uTmVzdGVkRm9ybUZpbmFsaXplKG5lc3RlZEZvcm1Hcm91cDogRm9ybUdyb3VwLCBmaWVsZENvbmZpZzogRmllbGRDb25maWc8YW55Pikge1xuICAgIGlmICghdGhpcy5mb3JtR3JvdXAuZ2V0KCdjaGlsZHJlbicpIHx8ICF0aGlzLmZvcm1Hcm91cC5nZXQoYGNoaWxkcmVuLiR7ZmllbGRDb25maWcuY29kZX1gKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgICh0aGlzLmZvcm1Hcm91cC5nZXQoJ2NoaWxkcmVuJykgYXMgRm9ybUdyb3VwKS5yZW1vdmVDb250cm9sKGZpZWxkQ29uZmlnLmNvZGUpO1xuXG4gICAgaWYgKCFPYmplY3Qua2V5cygodGhpcy5mb3JtR3JvdXAuZ2V0KCdjaGlsZHJlbicpIGFzIEZvcm1Hcm91cCkuY29udHJvbHMpLmxlbmd0aCkge1xuICAgICAgdGhpcy5mb3JtR3JvdXAucmVtb3ZlQ29udHJvbCgnY2hpbGRyZW4nKTtcbiAgICB9XG4gIH1cblxuICBvbk5lc3RlZEZvcm1Jbml0aWFsaXplKG5lc3RlZEZvcm1Hcm91cDogRm9ybUdyb3VwLCBmaWVsZENvbmZpZzogRmllbGRDb25maWc8YW55Pikge1xuICAgIGlmICghdGhpcy5mb3JtR3JvdXAuZ2V0KCdjaGlsZHJlbicpKSB7XG4gICAgICB0aGlzLmZvcm1Hcm91cC5hZGRDb250cm9sKCdjaGlsZHJlbicsIG5ldyBGb3JtR3JvdXAoe30pKTtcbiAgICB9XG5cbiAgICAodGhpcy5mb3JtR3JvdXAuZ2V0KCdjaGlsZHJlbicpIGFzIEZvcm1Hcm91cCkucmVtb3ZlQ29udHJvbChmaWVsZENvbmZpZy5jb2RlKTtcbiAgICAodGhpcy5mb3JtR3JvdXAuZ2V0KCdjaGlsZHJlbicpIGFzIEZvcm1Hcm91cCkuYWRkQ29udHJvbChmaWVsZENvbmZpZy5jb2RlLCBuZXN0ZWRGb3JtR3JvdXApO1xuICB9XG5cbiAgcHJpdmF0ZSBpbml0aWFsaXplRm9ybSgpIHtcbiAgICBpZiAoIXRoaXMuY29uZmlnLmxlbmd0aCkge1xuICAgICAgY29uc29sZS5lcnJvcignRk9STSBMSVNUIElTIEVNUFRZJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGZvcm1Hcm91cERhdGEgPSB7fTtcbiAgICB0aGlzLmNvbmZpZy5mb3JFYWNoKChlbGVtZW50OiBhbnksIGluZGV4KSA9PiB7XG4gICAgICBpZiAoZWxlbWVudC50eXBlICE9PSBGaWVsZENvbmZpZ0lucHV0VHlwZS5MQUJFTCkge1xuICAgICAgICBjb25zdCBmb3JtVmFsdWVMaXN0ID0gdGhpcy5wcmVwYXJlRm9ybVZhbGlkYXRpb25EYXRhKGVsZW1lbnQsIGluZGV4KTtcbiAgICAgICAgZm9ybUdyb3VwRGF0YVtlbGVtZW50LmNvZGVdID0gZm9ybVZhbHVlTGlzdDtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMuZm9ybUdyb3VwID0gdGhpcy5mb3JtQnVpbGRlci5ncm91cChmb3JtR3JvdXBEYXRhKTtcbiAgICB0aGlzLmluaXRpYWxpemUuZW1pdCh0aGlzLmZvcm1Hcm91cCk7XG4gIH1cblxuICBwcml2YXRlIHByZXBhcmVGb3JtVmFsaWRhdGlvbkRhdGEoZWxlbWVudDogRmllbGRDb25maWc8YW55PiwgaW5kZXgpIHtcbiAgICBjb25zdCBmb3JtVmFsdWVMaXN0ID0gW107XG4gICAgY29uc3QgdmFsaWRhdGlvbkxpc3QgPSBbXTtcblxuICAgIGxldCBkZWZhdWx0VmFsOiBhbnkgPSAnJztcbiAgICBzd2l0Y2ggKGVsZW1lbnQudHlwZSkge1xuICAgICAgY2FzZSBGaWVsZENvbmZpZ0lucHV0VHlwZS5JTlBVVDpcbiAgICAgICAgZGVmYXVsdFZhbCA9IGVsZW1lbnQudGVtcGxhdGVPcHRpb25zLnR5cGUgPT09ICdudW1iZXInID9cbiAgICAgICAgICAoZWxlbWVudC5kZWZhdWx0ICYmIE51bWJlci5pc0ludGVnZXIoZWxlbWVudC5kZWZhdWx0KSA/IGVsZW1lbnQuZGVmYXVsdCA6IDApIDpcbiAgICAgICAgICAoZWxlbWVudC5kZWZhdWx0ICYmICh0eXBlb2YgZWxlbWVudC5kZWZhdWx0KSA9PT0gJ3N0cmluZycgPyBlbGVtZW50LmRlZmF1bHQgOiAnJyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBGaWVsZENvbmZpZ0lucHV0VHlwZS5TRUxFQ1Q6XG4gICAgICBjYXNlIEZpZWxkQ29uZmlnSW5wdXRUeXBlLk5FU1RFRF9TRUxFQ1Q6XG4gICAgICAgIGRlZmF1bHRWYWwgPSBlbGVtZW50LnRlbXBsYXRlT3B0aW9ucy5tdWx0aXBsZSA/XG4gICAgICAgICAgKGVsZW1lbnQuZGVmYXVsdCAmJiBBcnJheS5pc0FycmF5KGVsZW1lbnQuZGVmYXVsdCkgPyBlbGVtZW50LmRlZmF1bHQgOiBbXSkgOiAoZWxlbWVudC5kZWZhdWx0IHx8IG51bGwpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgRmllbGRDb25maWdJbnB1dFR5cGUuQ0hFQ0tCT1g6XG4gICAgICAgIGRlZmF1bHRWYWwgPSBmYWxzZSB8fCAhIWVsZW1lbnQuZGVmYXVsdDtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgZm9ybVZhbHVlTGlzdC5wdXNoKGRlZmF1bHRWYWwpO1xuXG4gICAgaWYgKGVsZW1lbnQudmFsaWRhdGlvbnMgJiYgZWxlbWVudC52YWxpZGF0aW9ucy5sZW5ndGgpIHtcbiAgICAgIGVsZW1lbnQudmFsaWRhdGlvbnMuZm9yRWFjaCgoZGF0YSwgaSkgPT4ge1xuICAgICAgICBzd2l0Y2ggKGRhdGEudHlwZSkge1xuICAgICAgICAgIGNhc2UgRmllbGRDb25maWdWYWxpZGF0aW9uVHlwZS5SRVFVSVJFRDpcbiAgICAgICAgICAgIGlmIChlbGVtZW50LnR5cGUgPT09IEZpZWxkQ29uZmlnSW5wdXRUeXBlLkNIRUNLQk9YKSB7XG4gICAgICAgICAgICAgIHZhbGlkYXRpb25MaXN0LnB1c2goVmFsaWRhdG9ycy5yZXF1aXJlZFRydWUpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChlbGVtZW50LnR5cGUgPT09IEZpZWxkQ29uZmlnSW5wdXRUeXBlLlNFTEVDVCB8fCBlbGVtZW50LnR5cGUgPT09IEZpZWxkQ29uZmlnSW5wdXRUeXBlLk5FU1RFRF9TRUxFQ1QpIHtcbiAgICAgICAgICAgICAgdmFsaWRhdGlvbkxpc3QucHVzaCgoYykgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LnRlbXBsYXRlT3B0aW9ucy5tdWx0aXBsZSkge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIGMudmFsdWUgJiYgYy52YWx1ZS5sZW5ndGggPyBudWxsIDogJ2Vycm9yJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuICEhYy52YWx1ZSA/IG51bGwgOiAnZXJyb3InO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHZhbGlkYXRpb25MaXN0LnB1c2goVmFsaWRhdG9ycy5yZXF1aXJlZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIEZpZWxkQ29uZmlnVmFsaWRhdGlvblR5cGUuUEFUVEVSTjpcbiAgICAgICAgICAgIHZhbGlkYXRpb25MaXN0LnB1c2goVmFsaWRhdG9ycy5wYXR0ZXJuKGVsZW1lbnQudmFsaWRhdGlvbnNbaV0udmFsdWUgYXMgc3RyaW5nKSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIEZpZWxkQ29uZmlnVmFsaWRhdGlvblR5cGUuTUlOTEVOR1RIOlxuICAgICAgICAgICAgdmFsaWRhdGlvbkxpc3QucHVzaChWYWxpZGF0b3JzLm1pbkxlbmd0aChlbGVtZW50LnZhbGlkYXRpb25zW2ldLnZhbHVlIGFzIG51bWJlcikpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBGaWVsZENvbmZpZ1ZhbGlkYXRpb25UeXBlLk1BWExFTkdUSDpcbiAgICAgICAgICAgIHZhbGlkYXRpb25MaXN0LnB1c2goVmFsaWRhdG9ycy5tYXhMZW5ndGgoZWxlbWVudC52YWxpZGF0aW9uc1tpXS52YWx1ZSBhcyBudW1iZXIpKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBmb3JtVmFsdWVMaXN0LnB1c2goVmFsaWRhdG9ycy5jb21wb3NlKHZhbGlkYXRpb25MaXN0KSk7XG5cbiAgICByZXR1cm4gZm9ybVZhbHVlTGlzdDtcbiAgfVxuXG4gIGNsaWNrZWRMaW5rKGV2ZW50KSB7XG4gICAgdGhpcy5saW5rQ2xpY2tlZC5lbWl0KGV2ZW50KTtcbiAgfVxufVxuIl19