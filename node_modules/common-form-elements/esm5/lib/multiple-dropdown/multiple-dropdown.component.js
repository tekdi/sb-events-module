/**
 * @fileoverview added by tsickle
 * Generated from: lib/multiple-dropdown/multiple-dropdown.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, Input } from '@angular/core';
import { FormControl } from '@angular/forms';
import { from, Subject } from 'rxjs';
import { takeUntil, tap } from 'rxjs/operators';
import { fromJS, List, Map, Set } from 'immutable';
var MultipleDropdownComponent = /** @class */ (function () {
    function MultipleDropdownComponent(changeDetectionRef) {
        this.changeDetectionRef = changeDetectionRef;
        this.showModal = false;
        this.tempValue = Set();
        this.resolvedOptions = List();
        this.optionValueToOptionLabelMap = Map();
        this.fromJS = fromJS;
        this.dispose$ = new Subject();
    }
    /**
     * @return {?}
     */
    MultipleDropdownComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.context) {
            this.context.valueChanges.pipe(tap((/**
             * @return {?}
             */
            function () {
                _this.formControlRef.patchValue(null);
                _this.tempValue = _this.tempValue.clear();
                _this.setupOptions();
            })), takeUntil(this.dispose$)).subscribe();
        }
        this.formControlRef.valueChanges.pipe(tap((/**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            _this.setTempValue(value);
            _this.changeDetectionRef.detectChanges();
        })), takeUntil(this.dispose$)).subscribe();
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    MultipleDropdownComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (!changes['options'] || !changes['options'].currentValue) {
            return;
        }
        this.setupOptions();
    };
    /**
     * @return {?}
     */
    MultipleDropdownComponent.prototype.onSubmit = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var finalValue = this.tempValue.toList().toJS();
        this.formControlRef.patchValue(this.isMultiple ? finalValue : finalValue[0]);
        this.formControlRef.markAsDirty();
        this.showModal = false;
    };
    /**
     * @return {?}
     */
    MultipleDropdownComponent.prototype.openModal = /**
     * @return {?}
     */
    function () {
        if (this.context && this.context.invalid) {
            return;
        }
        this.setTempValue(this.formControlRef.value);
        this.showModal = true;
    };
    /**
     * @param {?} option
     * @return {?}
     */
    MultipleDropdownComponent.prototype.addSelected = /**
     * @param {?} option
     * @return {?}
     */
    function (option) {
        if (this.isMultiple) {
            if (this.tempValue.includes(option.get('value'))) {
                this.tempValue = this.tempValue.remove(option.get('value'));
            }
            else {
                this.tempValue = this.tempValue.add(option.get('value'));
            }
        }
        else {
            this.tempValue = this.tempValue.clear();
            this.tempValue = this.tempValue.add(option.get('value'));
        }
    };
    /**
     * @return {?}
     */
    MultipleDropdownComponent.prototype.onCancel = /**
     * @return {?}
     */
    function () {
        this.formControlRef.markAsDirty();
        this.showModal = false;
    };
    /**
     * @return {?}
     */
    MultipleDropdownComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.dispose$.next(null);
        this.dispose$.complete();
    };
    /**
     * @private
     * @return {?}
     */
    MultipleDropdownComponent.prototype.isOptionsArray = /**
     * @private
     * @return {?}
     */
    function () {
        return Array.isArray(this.options);
    };
    /**
     * @private
     * @return {?}
     */
    MultipleDropdownComponent.prototype.isOptionsClosure = /**
     * @private
     * @return {?}
     */
    function () {
        return typeof this.options === 'function';
    };
    /**
     * @private
     * @return {?}
     */
    MultipleDropdownComponent.prototype.isOptionsMap = /**
     * @private
     * @return {?}
     */
    function () {
        return !Array.isArray(this.options) && typeof this.options === 'object';
    };
    /**
     * @private
     * @param {?} value
     * @return {?}
     */
    MultipleDropdownComponent.prototype.setTempValue = /**
     * @private
     * @param {?} value
     * @return {?}
     */
    function (value) {
        if (value) {
            if (Array.isArray(value)) {
                this.tempValue = Set(fromJS(value));
            }
            else {
                this.tempValue = Set(fromJS([value]));
            }
        }
    };
    /**
     * @private
     * @return {?}
     */
    MultipleDropdownComponent.prototype.setupOptions = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.options) {
            this.options = [];
            this.resolvedOptions = this.resolvedOptions.clear();
        }
        if (this.isOptionsArray()) {
            this.resolvedOptions = fromJS(this.options);
        }
        else if (this.isOptionsMap()) {
            this.resolvedOptions = (this.context && this.context.value) ?
                fromJS(this.options[this.context.value]) :
                this.resolvedOptions;
        }
        else if (this.isOptionsClosure()) {
            from(((/** @type {?} */ (this.options)))(this.formControlRef, this.context, (/**
             * @return {?}
             */
            function () { return _this.dataLoadStatusDelegate.next('LOADING'); }), (/**
             * @return {?}
             */
            function () { return _this.dataLoadStatusDelegate.next('LOADED'); }))).pipe(tap((/**
             * @param {?=} options
             * @return {?}
             */
            function (options) {
                if (options === void 0) { options = []; }
                _this.resolvedOptions = fromJS(options);
                _this.resolvedOptions.forEach((/**
                 * @param {?} option
                 * @return {?}
                 */
                function (option) {
                    _this.optionValueToOptionLabelMap = _this.optionValueToOptionLabelMap.set(option.get('value'), option.get('label'));
                }));
                _this.setTempValue(_this.default);
                _this.changeDetectionRef.detectChanges();
            })), takeUntil(this.dispose$)).subscribe();
        }
        this.resolvedOptions.forEach((/**
         * @param {?} option
         * @return {?}
         */
        function (option) {
            _this.optionValueToOptionLabelMap = _this.optionValueToOptionLabelMap.set(option.get('value'), option.get('label'));
        }));
        this.setTempValue(this.default);
    };
    MultipleDropdownComponent.decorators = [
        { type: Component, args: [{
                    selector: 'sb-multiple-dropdown',
                    template: "<div class=\"multi-select-section\">\n  <label class=\"input-label\" *ngIf=\"label\">{{label}}</label>\n  <div *ngIf=\"labelHtml\" [innerHTML]=\"labelHtml | transposeHtml\"></div>\n  <div class=\"multi-select-container\">\n    <sb-caret-down class=\"caret-down\"\n      [attr.disabled]=\"disabled ? true : ( context ? (context.invalid ? true : null) : null )\" (click)=\"openModal()\">\n    </sb-caret-down>\n    <div class=\"list-border\" (click)=\"openModal()\">\n      <ul [attr.disabled]=\"disabled ? true : ( context ? (context.invalid ? true : null) : null )\">\n        <ng-container *ngIf=\"isMultiple\">\n          <li *ngIf=\"!formControlRef.value || !formControlRef.value.length\" class=\"placeholder\">{{placeHolder}}</li>\n\n          <ng-container *ngIf=\"formControlRef.value?.length\">\n            <span *ngFor=\"let value of formControlRef.value; let index=index\">\n              {{optionValueToOptionLabelMap.get(fromJS(value))}}<span\n            *ngIf=\"index < formControlRef.value.length - 1\">, </span>\n            </span>\n          </ng-container>\n        </ng-container>\n\n        <ng-container *ngIf=\"!isMultiple\">\n          <li *ngIf=\"!formControlRef.value\" class=\"placeholder\">{{placeHolder}}</li>\n\n          <span *ngIf=\"formControlRef.value\">{{optionValueToOptionLabelMap.get(fromJS(formControlRef.value))}}</span>\n        </ng-container>\n      </ul>\n    </div>\n    <div class=\"sb-modal-container\" [hidden]=\"!showModal\" (click)=\"showModal=false;\">\n      <div class=\"sb-modal-overlay\">\n        <div class=\"sb-modal\" (click)=\"$event.stopPropagation()\">\n          <div class=\"header\">\n            {{placeHolder}}\n          </div>\n          <div class=\"body\">\n            <ul>\n              <li *ngFor=\"let option of resolvedOptions; let i=index\">\n                <div (click)=\"addSelected(option)\" class=\"row\">\n                  <label class=\"container\" style=\"pointer-events: none\">\n                    <input [checked]=\"tempValue.includes(option.get('value'))\" class=\"sb-checkbox\" type=\"checkbox\">\n                    <span class=\"checkmark\"></span>\n                  </label>\n                  <span>{{option.get('label')}}</span>\n                </div>\n              </li>\n            </ul>\n          </div>\n          <div class=\"footer\">\n            <div class=\"sb-form-button\">\n              <button class=\"sb-btn-primary-outline\" (click)=\"onCancel()\">cancel</button>\n            </div>\n            <div class=\"sb-form-button\">\n              <button class=\"sb-btn-primary\" (click)=\"onSubmit()\">submit</button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>",
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    styles: [".multi-select-section{margin:1rem 0}label{font-size:1rem;margin:0}.multi-select-container{position:relative;margin-bottom:8px}.multi-select-container .caret-down{position:absolute;top:11px;right:19px;z-index:0}.multi-select-container .list-border .placeholder{font-size:12px;font-weight:700;margin-left:12px;color:var(--gray-100)}.multi-select-container .list-border ul[disabled]{opacity:.3;pointer-events:none}.multi-select-container .list-border ul{list-style-type:none;margin-top:3px;margin-left:8px;position:absolute;top:0;left:0}.multi-select-container .list-border{border:.5px solid var(--gray-400);padding:1.3rem;cursor:pointer}.multi-select-container .list-border li{float:left;font-size:12px;font-weight:700;margin-left:4px}.multi-select-container .dropdown li{cursor:pointer;padding:8px;border:1px solid var(--white)}.multi-select-container .dropdown ul{list-style-type:none;margin:0;padding:0}.multi-select-container .row{display:-ms-grid;display:grid;-ms-grid-columns:1fr 10fr;grid-template-columns:1fr 10fr;grid-gap:0}.multi-select-container .footer{display:-ms-grid;display:grid;-ms-grid-columns:1fr 1fr;grid-template-columns:1fr 1fr;grid-gap:0;padding-left:8px;padding-bottom:8px;padding-top:8px}.multi-select-container .sb-modal-container{position:fixed;height:100vh;overflow:hidden;width:100%;left:0;top:0;right:0;z-index:10}.multi-select-container .sb-modal-overlay{position:absolute;width:100%;height:100%;top:0;background:rgba(0,0,0,.6);left:0;z-index:10}.multi-select-container .fa .fa-close{float:right}.multi-select-container .sb-modal{display:block;position:absolute;bottom:0;width:100%;--border-top:0.5px solid var(--white);z-index:11;background:var(--white)}.multi-select-container .sb-modal ul{list-style-type:none}.multi-select-container .sb-modal li{cursor:pointer;padding-bottom:8px;padding-top:8px;padding-left:16px}.value-label{width:270px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.multi-select-container .sb-forms-radio{margin-top:6px}.multi-select-container .sb-form-button{display:inline;padding:10px}.multi-select-container .sb-btn-primary-outline{color:var(--primary-color);background-color:transparent;border:.5px solid var(--primary-color);border-radius:4px;padding:10px 40px;font-size:16px;text-transform:uppercase;width:100%}.multi-select-container .sb-btn-primary{color:var(--white);background-color:var(--primary-color);border:.5px solid var(--primary-color);border-radius:4px;padding:10px 40px;font-size:16px;text-transform:uppercase;width:100%}.multi-select-container .header{padding:16px;margin-left:8px;font-weight:700}.multi-select-container .body{padding-top:8px;border-bottom:.5px solid var(--gray-100);border-top:.5px solid var(--gray-100);max-height:300px;overflow:scroll}.list-with-ellipsis:nth-child(3){float:left;font-size:12px;font-weight:700;margin-left:4px;width:50px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.list-with-ellipsis:nth-child(n+4){visibility:hidden}.multi-select-container .container{display:block;position:relative;padding-left:35px;margin-bottom:12px;cursor:pointer;font-size:22px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.container input{position:absolute;opacity:0;cursor:pointer;height:0;width:0}.checkmark{position:absolute;top:3px;left:0;height:15px;width:15px;border:.4px solid var(--black)}.container:hover input~.checkmark{background-color:var(--white)}.container input:checked~.checkmark{background-color:var(--primary-600)}.checkmark:after{content:\"\";position:absolute;display:none}.container input:checked~.checkmark:after{display:block}.container .checkmark:after{left:5px;top:0;width:5px;height:10px;border:solid var(--white);border-width:0 2px 2px 0;-webkit-transform:rotate(45deg);transform:rotate(45deg)}"]
                }] }
    ];
    /** @nocollapse */
    MultipleDropdownComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef }
    ]; };
    MultipleDropdownComponent.propDecorators = {
        disabled: [{ type: Input }],
        options: [{ type: Input }],
        label: [{ type: Input }],
        labelHtml: [{ type: Input }],
        placeHolder: [{ type: Input }],
        isMultiple: [{ type: Input }],
        context: [{ type: Input }],
        formControlRef: [{ type: Input }],
        default: [{ type: Input }],
        contextData: [{ type: Input }],
        dataLoadStatusDelegate: [{ type: Input }]
    };
    return MultipleDropdownComponent;
}());
export { MultipleDropdownComponent };
if (false) {
    /** @type {?} */
    MultipleDropdownComponent.prototype.disabled;
    /** @type {?} */
    MultipleDropdownComponent.prototype.options;
    /** @type {?} */
    MultipleDropdownComponent.prototype.label;
    /** @type {?} */
    MultipleDropdownComponent.prototype.labelHtml;
    /** @type {?} */
    MultipleDropdownComponent.prototype.placeHolder;
    /** @type {?} */
    MultipleDropdownComponent.prototype.isMultiple;
    /** @type {?} */
    MultipleDropdownComponent.prototype.context;
    /** @type {?} */
    MultipleDropdownComponent.prototype.formControlRef;
    /** @type {?} */
    MultipleDropdownComponent.prototype.default;
    /** @type {?} */
    MultipleDropdownComponent.prototype.contextData;
    /** @type {?} */
    MultipleDropdownComponent.prototype.dataLoadStatusDelegate;
    /** @type {?} */
    MultipleDropdownComponent.prototype.showModal;
    /** @type {?} */
    MultipleDropdownComponent.prototype.tempValue;
    /** @type {?} */
    MultipleDropdownComponent.prototype.resolvedOptions;
    /** @type {?} */
    MultipleDropdownComponent.prototype.optionValueToOptionLabelMap;
    /** @type {?} */
    MultipleDropdownComponent.prototype.fromJS;
    /**
     * @type {?}
     * @private
     */
    MultipleDropdownComponent.prototype.dispose$;
    /**
     * @type {?}
     * @private
     */
    MultipleDropdownComponent.prototype.changeDetectionRef;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibXVsdGlwbGUtZHJvcGRvd24uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vY29tbW9uLWZvcm0tZWxlbWVudHMvIiwic291cmNlcyI6WyJsaWIvbXVsdGlwbGUtZHJvcGRvd24vbXVsdGlwbGUtZHJvcGRvd24uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFDLHVCQUF1QixFQUFFLGlCQUFpQixFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQThDLE1BQU0sZUFBZSxDQUFDO0FBQ3hJLE9BQU8sRUFBQyxXQUFXLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUMzQyxPQUFPLEVBQUMsSUFBSSxFQUFFLE9BQU8sRUFBQyxNQUFNLE1BQU0sQ0FBQztBQUVuQyxPQUFPLEVBQUMsU0FBUyxFQUFFLEdBQUcsRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBQzlDLE9BQU8sRUFBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUMsTUFBTSxXQUFXLENBQUM7QUFHakQ7SUEyQkUsbUNBQ1Usa0JBQXFDO1FBQXJDLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBbUI7UUFWL0MsY0FBUyxHQUFHLEtBQUssQ0FBQztRQUNsQixjQUFTLEdBQUcsR0FBRyxFQUFPLENBQUM7UUFDdkIsb0JBQWUsR0FBRyxJQUFJLEVBQXVCLENBQUM7UUFDOUMsZ0NBQTJCLEdBQUcsR0FBRyxFQUFlLENBQUM7UUFFakQsV0FBTSxHQUFHLE1BQU0sQ0FBQztRQUVSLGFBQVEsR0FBRyxJQUFJLE9BQU8sRUFBYSxDQUFDO0lBSzVDLENBQUM7Ozs7SUFDRCw0Q0FBUTs7O0lBQVI7UUFBQSxpQkFtQkM7UUFsQkMsSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ2hCLElBQUksQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLElBQUksQ0FDNUIsR0FBRzs7O1lBQUM7Z0JBQ0YsS0FBSSxDQUFDLGNBQWMsQ0FBQyxVQUFVLENBQUMsSUFBSSxD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akQsMkNBQWdCOzs7OztJQUVoQiw2Q0FBNEM7Ozs7O0lBRzFDLHVEQUE2QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Q2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksIENoYW5nZURldGVjdG9yUmVmLCBDb21wb25lbnQsIElucHV0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSwgT25Jbml0LCBTaW1wbGVDaGFuZ2VzfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7Rm9ybUNvbnRyb2x9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7ZnJvbSwgU3ViamVjdH0gZnJvbSAncnhqcyc7XG5pbXBvcnQge0ZpZWxkQ29uZmlnT3B0aW9uc0J1aWxkZXJ9IGZyb20gJy4uL2NvbW1vbi1mb3JtLWNvbmZpZyc7XG5pbXBvcnQge3Rha2VVbnRpbCwgdGFwfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQge2Zyb21KUywgTGlzdCwgTWFwLCBTZXR9IGZyb20gJ2ltbXV0YWJsZSc7XG5cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnc2ItbXVsdGlwbGUtZHJvcGRvd24nLFxuICB0ZW1wbGF0ZVVybDogJy4vbXVsdGlwbGUtZHJvcGRvd24uY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9tdWx0aXBsZS1kcm9wZG93bi5jb21wb25lbnQuY3NzJ10sXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoXG59KVxuZXhwb3J0IGNsYXNzIE11bHRpcGxlRHJvcGRvd25Db21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgT25EZXN0cm95IHtcbiAgQElucHV0KCkgZGlzYWJsZWQ/OiBib29sZWFuO1xuICBASW5wdXQoKSBvcHRpb25zOiBhbnk7XG4gIEBJbnB1dCgpIGxhYmVsPzogc3RyaW5nO1xuICBASW5wdXQoKSBsYWJlbEh0bWw6IGFueTtcbiAgQElucHV0KCkgcGxhY2VIb2xkZXI/OiBzdHJpbmc7XG4gIEBJbnB1dCgpIGlzTXVsdGlwbGU/OiBib29sZWFuO1xuICBASW5wdXQoKSBjb250ZXh0PzogRm9ybUNvbnRyb2w7XG4gIEBJbnB1dCgpIGZvcm1Db250cm9sUmVmPzogRm9ybUNvbnRyb2w7XG4gIEBJbnB1dCgpIGRlZmF1bHQ/OiBhbnk7XG4gIEBJbnB1dCgpIGNvbnRleHREYXRhOiBhbnk7XG4gIEBJbnB1dCgpIGRhdGFMb2FkU3RhdHVzRGVsZWdhdGU6IFN1YmplY3Q8J0xPQURJTkcnIHwgJ0xPQURFRCc+O1xuICBzaG93TW9kYWwgPSBmYWxzZTtcbiAgdGVtcFZhbHVlID0gU2V0PGFueT4oKTtcbiAgcmVzb2x2ZWRPcHRpb25zID0gTGlzdDxNYXA8c3RyaW5nLCBzdHJpbmc+PigpO1xuICBvcHRpb25WYWx1ZVRvT3B0aW9uTGFiZWxNYXAgPSBNYXA8YW55LCBzdHJpbmc+KCk7XG5cbiAgZnJvbUpTID0gZnJvbUpTO1xuXG4gIHByaXZhdGUgZGlzcG9zZSQgPSBuZXcgU3ViamVjdDx1bmRlZmluZWQ+KCk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBjaGFuZ2VEZXRlY3Rpb25SZWY6IENoYW5nZURldGVjdG9yUmVmXG4gICkge1xuICB9XG4gIG5nT25Jbml0KCkge1xuICAgIGlmICh0aGlzLmNvbnRleHQpIHtcbiAgICAgIHRoaXMuY29udGV4dC52YWx1ZUNoYW5nZXMucGlwZShcbiAgICAgICAgdGFwKCgpID0+IHtcbiAgICAgICAgICB0aGlzLmZvcm1Db250cm9sUmVmLnBhdGNoVmFsdWUobnVsbCk7XG4gICAgICAgICAgdGhpcy50ZW1wVmFsdWUgPSB0aGlzLnRlbXBWYWx1ZS5jbGVhcigpO1xuICAgICAgICAgIHRoaXMuc2V0dXBPcHRpb25zKCk7XG4gICAgICAgIH0pLFxuICAgICAgICB0YWtlVW50aWwodGhpcy5kaXNwb3NlJClcbiAgICAgICkuc3Vic2NyaWJlKCk7XG4gICAgfVxuXG4gICAgdGhpcy5mb3JtQ29udHJvbFJlZi52YWx1ZUNoYW5nZXMucGlwZShcbiAgICAgIHRhcCgodmFsdWUpID0+IHtcbiAgICAgICAgdGhpcy5zZXRUZW1wVmFsdWUodmFsdWUpO1xuICAgICAgICB0aGlzLmNoYW5nZURldGVjdGlvblJlZi5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgICB9KSxcbiAgICAgIHRha2VVbnRpbCh0aGlzLmRpc3Bvc2UkKVxuICAgICkuc3Vic2NyaWJlKCk7XG4gIH1cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuICAgIGlmICghY2hhbmdlc1snb3B0aW9ucyddIHx8ICFjaGFuZ2VzWydvcHRpb25zJ10uY3VycmVudFZhbHVlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5zZXR1cE9wdGlvbnMoKTtcbiAgfVxuXG4gIG9uU3VibWl0KCkge1xuICAgIGNvbnN0IGZpbmFsVmFsdWUgPSB0aGlzLnRlbXBWYWx1ZS50b0xpc3QoKS50b0pTKCk7XG4gICAgdGhpcy5mb3JtQ29udHJvbFJlZi5wYXRjaFZhbHVlKHRoaXMuaXNNdWx0aXBsZSA/IGZpbmFsVmFsdWUgOiBmaW5hbFZhbHVlWzBdKTtcbiAgICB0aGlzLmZvcm1Db250cm9sUmVmLm1hcmtBc0RpcnR5KCk7XG4gICAgdGhpcy5zaG93TW9kYWwgPSBmYWxzZTtcbiAgfVxuICBvcGVuTW9kYWwoKSB7XG4gICAgaWYgKHRoaXMuY29udGV4dCAmJiB0aGlzLmNvbnRleHQuaW52YWxpZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuc2V0VGVtcFZhbHVlKHRoaXMuZm9ybUNvbnRyb2xSZWYudmFsdWUpO1xuXG4gICAgdGhpcy5zaG93TW9kYWwgPSB0cnVlO1xuICB9XG5cbiAgYWRkU2VsZWN0ZWQob3B0aW9uOiBNYXA8c3RyaW5nLCBzdHJpbmc+KSB7XG4gICAgaWYgKHRoaXMuaXNNdWx0aXBsZSkge1xuICAgICAgaWYgKHRoaXMudGVtcFZhbHVlLmluY2x1ZGVzKG9wdGlvbi5nZXQoJ3ZhbHVlJykpKSB7XG4gICAgICAgIHRoaXMudGVtcFZhbHVlID0gdGhpcy50ZW1wVmFsdWUucmVtb3ZlKG9wdGlvbi5nZXQoJ3ZhbHVlJykpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy50ZW1wVmFsdWUgPSB0aGlzLnRlbXBWYWx1ZS5hZGQob3B0aW9uLmdldCgndmFsdWUnKSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudGVtcFZhbHVlID0gdGhpcy50ZW1wVmFsdWUuY2xlYXIoKTtcbiAgICAgIHRoaXMudGVtcFZhbHVlID0gdGhpcy50ZW1wVmFsdWUuYWRkKG9wdGlvbi5nZXQoJ3ZhbHVlJykpO1xuICAgIH1cbiAgfVxuICBvbkNhbmNlbCgpIHtcbiAgICB0aGlzLmZvcm1Db250cm9sUmVmLm1hcmtBc0RpcnR5KCk7XG4gICAgdGhpcy5zaG93TW9kYWwgPSBmYWxzZTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIHRoaXMuZGlzcG9zZSQubmV4dChudWxsKTtcbiAgICB0aGlzLmRpc3Bvc2UkLmNvbXBsZXRlKCk7XG4gIH1cblxuICBwcml2YXRlIGlzT3B0aW9uc0FycmF5KCkge1xuICAgIHJldHVybiBBcnJheS5pc0FycmF5KHRoaXMub3B0aW9ucyk7XG4gIH1cblxuICBwcml2YXRlIGlzT3B0aW9uc0Nsb3N1cmUoKSB7XG4gICAgcmV0dXJuIHR5cGVvZiB0aGlzLm9wdGlvbnMgPT09ICdmdW5jdGlvbic7XG4gIH1cblxuICBwcml2YXRlIGlzT3B0aW9uc01hcCgpIHtcbiAgICByZXR1cm4gIUFycmF5LmlzQXJyYXkodGhpcy5vcHRpb25zKSAmJiB0eXBlb2YgdGhpcy5vcHRpb25zID09PSAnb2JqZWN0JztcbiAgfVxuXG4gIHByaXZhdGUgc2V0VGVtcFZhbHVlKHZhbHVlOiBhbnkpIHtcbiAgICBpZiAodmFsdWUpIHtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgICB0aGlzLnRlbXBWYWx1ZSA9IFNldChmcm9tSlModmFsdWUpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMudGVtcFZhbHVlID0gU2V0KGZyb21KUyhbdmFsdWVdKSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXR1cE9wdGlvbnMoKSB7XG4gICAgaWYgKCF0aGlzLm9wdGlvbnMpIHtcbiAgICAgIHRoaXMub3B0aW9ucyA9IFtdO1xuICAgICAgdGhpcy5yZXNvbHZlZE9wdGlvbnMgPSB0aGlzLnJlc29sdmVkT3B0aW9ucy5jbGVhcigpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmlzT3B0aW9uc0FycmF5KCkpIHtcbiAgICAgIHRoaXMucmVzb2x2ZWRPcHRpb25zID0gZnJvbUpTKHRoaXMub3B0aW9ucyk7XG4gICAgfSBlbHNlIGlmICh0aGlzLmlzT3B0aW9uc01hcCgpKSB7XG4gICAgICB0aGlzLnJlc29sdmVkT3B0aW9ucyA9ICh0aGlzLmNvbnRleHQgJiYgdGhpcy5jb250ZXh0LnZhbHVlKSA/XG4gICAgICAgIGZyb21KUyh0aGlzLm9wdGlvbnNbdGhpcy5jb250ZXh0LnZhbHVlXSkgOlxuICAgICAgICB0aGlzLnJlc29sdmVkT3B0aW9ucztcbiAgICB9IGVsc2UgaWYgKHRoaXMuaXNPcHRpb25zQ2xvc3VyZSgpKSB7XG4gICAgICBmcm9tKCh0aGlzLm9wdGlvbnMgYXMgRmllbGRDb25maWdPcHRpb25zQnVpbGRlcjxhbnk+KShcbiAgICAgICAgdGhpcy5mb3JtQ29udHJvbFJlZixcbiAgICAgICAgdGhpcy5jb250ZXh0LFxuICAgICAgICAoKSA9PiB0aGlzLmRhdGFMb2FkU3RhdHVzRGVsZWdhdGUubmV4dCgnTE9BRElORycpLFxuICAgICAgICAoKSA9PiB0aGlzLmRhdGFMb2FkU3RhdHVzRGVsZWdhdGUubmV4dCgnTE9BREVEJylcbiAgICAgICkpLnBpcGUoXG4gICAgICAgIHRhcCgob3B0aW9ucyA9IFtdKSA9PiB7XG4gICAgICAgICAgdGhpcy5yZXNvbHZlZE9wdGlvbnMgPSBmcm9tSlMob3B0aW9ucyk7XG5cbiAgICAgICAgICB0aGlzLnJlc29sdmVkT3B0aW9ucy5mb3JFYWNoKChvcHRpb24pID0+IHtcbiAgICAgICAgICAgIHRoaXMub3B0aW9uVmFsdWVUb09wdGlvbkxhYmVsTWFwID0gdGhpcy5vcHRpb25WYWx1ZVRvT3B0aW9uTGFiZWxNYXAuc2V0KG9wdGlvbi5nZXQoJ3ZhbHVlJyksIG9wdGlvbi5nZXQoJ2xhYmVsJykpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgdGhpcy5zZXRUZW1wVmFsdWUodGhpcy5kZWZhdWx0KTtcblxuICAgICAgICAgIHRoaXMuY2hhbmdlRGV0ZWN0aW9uUmVmLmRldGVjdENoYW5nZXMoKTtcbiAgICAgICAgfSksXG4gICAgICAgIHRha2VVbnRpbCh0aGlzLmRpc3Bvc2UkKVxuICAgICAgKS5zdWJzY3JpYmUoKTtcbiAgICB9XG5cbiAgICB0aGlzLnJlc29sdmVkT3B0aW9ucy5mb3JFYWNoKChvcHRpb24pID0+IHtcbiAgICAgIHRoaXMub3B0aW9uVmFsdWVUb09wdGlvbkxhYmVsTWFwID0gdGhpcy5vcHRpb25WYWx1ZVRvT3B0aW9uTGFiZWxNYXAuc2V0KG9wdGlvbi5nZXQoJ3ZhbHVlJyksIG9wdGlvbi5nZXQoJ2xhYmVsJykpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5zZXRUZW1wVmFsdWUodGhpcy5kZWZhdWx0KTtcbiAgfVxufVxuIl19