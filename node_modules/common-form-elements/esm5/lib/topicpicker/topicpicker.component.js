/**
 * @fileoverview added by tsickle
 * Generated from: lib/topicpicker/topicpicker.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, EventEmitter, Input, Output } from '@angular/core';
import { Subject, merge } from 'rxjs';
import * as _ from 'lodash-es';
import { FormControl, FormGroup } from '@angular/forms';
import { tap, takeUntil } from 'rxjs/operators';
/**
 * @record
 */
function TopicTreeNode() { }
if (false) {
    /** @type {?} */
    TopicTreeNode.prototype.id;
    /** @type {?} */
    TopicTreeNode.prototype.name;
    /** @type {?} */
    TopicTreeNode.prototype.selectable;
    /** @type {?} */
    TopicTreeNode.prototype.nodes;
}
/**
 * @record
 */
function JQuery() { }
if (false) {
    /**
     * @param {?=} options
     * @return {?}
     */
    JQuery.prototype.treePicker = function (options) { };
}
var TopicpickerComponent = /** @class */ (function () {
    function TopicpickerComponent() {
        this.topicChange = new EventEmitter();
        this.dependencyTerms = [];
        this.dispose$ = new Subject();
    }
    /**
     * @return {?}
     */
    TopicpickerComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.formControlRef.valueChanges.pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            console.log(val);
        })), takeUntil(this.dispose$)).subscribe();
        /** @type {?} */
        var selectedTopics = _.reduce(this.default, (/**
         * @param {?} collector
         * @param {?} element
         * @return {?}
         */
        function (collector, element) {
            if (typeof element === 'string') {
                collector.unformatted.push(element);
            }
            else if (_.get(element, 'identifier')) {
                collector.formatted.push(element);
            }
            return collector;
        }), { formatted: [], unformatted: [] });
        this.formatSelectedTopics(this.field.terms, selectedTopics.unformatted, selectedTopics.formatted);
        this.default = selectedTopics.unformatted;
        this.selectedNodes = tslib_1.__assign({}, selectedTopics.formatted);
        this.topicChange.emit(this.selectedTopics);
        if (!_.isEmpty(this.default)) {
            this.placeHolder = this.default && this.default.length + ' topics selected';
            this.formControlRef.setValue(this.default);
        }
        if (!_.isEmpty(this.depends)) {
            merge.apply(void 0, tslib_1.__spread(_.map(this.depends, (/**
             * @param {?} depend
             * @return {?}
             */
            function (depend) { return depend.valueChanges; })))).pipe(tap((/**
             * @param {?} value
             * @return {?}
             */
            function (value) {
                _this.latestParentValue = value;
                _this.isDependsInvalid = _.includes(_.map(_this.depends, (/**
                 * @param {?} depend
                 * @return {?}
                 */
                function (depend) { return depend.invalid; })), true);
                _this.formControlRef.patchValue(null);
                _this.placeHolder = '';
                _this.default = [];
                _this.selectedNodes = {};
                _this.initTopicPicker(_this.formatTopics(_this.fetchAssociations()));
            })), takeUntil(this.dispose$)).subscribe();
            this.isDependsInvalid = _.includes(_.map(this.depends, (/**
             * @param {?} depend
             * @return {?}
             */
            function (depend) { return depend.invalid; })), true);
        }
    };
    // tslint:disable-next-line:use-life-cycle-interface
    // tslint:disable-next-line:use-life-cycle-interface
    /**
     * @return {?}
     */
    TopicpickerComponent.prototype.ngAfterViewInit = 
    // tslint:disable-next-line:use-life-cycle-interface
    /**
     * @return {?}
     */
    function () {
        this.initTopicPicker(this.formatTopics(this.field.terms));
    };
    /**
     * @return {?}
     */
    TopicpickerComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.dispose$.next(null);
        this.dispose$.complete();
    };
    /**
     * @private
     * @param {?} topics
     * @param {?=} subTopic
     * @return {?}
     */
    TopicpickerComponent.prototype.formatTopics = /**
     * @private
     * @param {?} topics
     * @param {?=} subTopic
     * @return {?}
     */
    function (topics, subTopic) {
        var _this = this;
        if (subTopic === void 0) { subTopic = false; }
        return _.map(topics, (/**
         * @param {?} topic
         * @return {?}
         */
        function (topic) { return ({
            id: topic.identifier,
            name: topic.name,
            selectable: subTopic ? 'selectable' : 'notselectable',
            nodes: _this.formatTopics(topic.children, true)
        }); }));
    };
    /**
     * @private
     * @param {?} topics
     * @param {?} unformatted
     * @param {?} formatted
     * @return {?}
     */
    TopicpickerComponent.prototype.formatSelectedTopics = /**
     * @private
     * @param {?} topics
     * @param {?} unformatted
     * @param {?} formatted
     * @return {?}
     */
    function (topics, unformatted, formatted) {
        var _this = this;
        _.forEach(topics, (/**
         * @param {?} topic
         * @return {?}
         */
        function (topic) {
            if (unformatted.includes(_this.field.output ? topic[_this.field.output] : topic.name) && !topic.children) {
                formatted.push({
                    identifier: topic.identifier,
                    name: topic.name
                });
            }
            if (topic.children) {
                _this.formatSelectedTopics(topic.children, unformatted, formatted);
            }
        }));
    };
    /**
     * @private
     * @param {?} data
     * @return {?}
     */
    TopicpickerComponent.prototype.initTopicPicker = /**
     * @private
     * @param {?} data
     * @return {?}
     */
    function (data) {
        var _this = this;
        $(".topic-picker-selector_" + this.field.code).treePicker({
            data: data,
            name: 'Topics',
            noDataMessage: 'noDataMessage',
            submitButtonText: 'Done',
            cancelButtonText: 'Cancel',
            removeAllText: 'Remove All',
            chooseAllText: 'Choose All',
            searchText: 'Search',
            selectedText: 'selected',
            picked: (!_.isEmpty(this.selectedNodes)) ? _.map(this.selectedNodes, 'identifier') : (!_.isEmpty(this.default) ? this.default : []),
            onSubmit: (/**
             * @param {?} selectedNodes
             * @return {?}
             */
            function (selectedNodes) {
                _this.selectedNodes = selectedNodes;
                _this.selectedTopics = _.map(selectedNodes, (/**
                 * @param {?} node
                 * @return {?}
                 */
                function (node) { return ({
                    identifier: node.id,
                    name: node.name
                }); }));
                _this.placeHolder = _this.selectedTopics.length + ' topics selected';
                _this.topicChange.emit(_this.selectedTopics);
                /** @type {?} */
                var topics = [];
                _.forEach(_this.selectedTopics, (/**
                 * @param {?} value
                 * @param {?} index
                 * @return {?}
                 */
                function (value, index) {
                    if (_this.field.output) {
                        topics.push(value[_this.field.output]);
                    }
                    else {
                        topics.push(value.name);
                    }
                }));
                _this.formControlRef.setValue(topics);
            }),
            nodeName: "topicSelector_" + this.field.code,
            displayFormat: (/**
             * @param {?} picked
             * @return {?}
             */
            function (picked) { return this.placeHolder; }),
            minSearchQueryLength: 1,
            disabled: (/**
             * @param {?} node
             * @return {?}
             */
            function (node) {
                return _this.disabled ? true : (_this.depends ? (_this.isDependsInvalid ? true : false) : false);
            })
        });
        setTimeout((/**
         * @return {?}
         */
        function () { return document.getElementById("topicSelector_" + _this.field.code).classList.add(_this.topicPickerClass); }), 0);
    };
    /**
     * @return {?}
     */
    TopicpickerComponent.prototype.fetchAssociations = /**
     * @return {?}
     */
    function () {
        var _this = this;
        // && this.context.value && this.field.association
        if (!_.isEmpty(this.depends)) {
            /** @type {?} */
            var filteredTerm = _.find(this.dependencyTerms, (/**
             * @param {?} terms
             * @return {?}
             */
            function (terms) {
                return !_.isEmpty(_this.field.output) ? _.includes(_this.getParentValue(), terms[_this.field.output]) :
                    _.includes(_this.getParentValue(), terms.name);
            }));
            if (filteredTerm) {
                this.tempAssociation = _.filter(filteredTerm.associations, (/**
                 * @param {?} association
                 * @return {?}
                 */
                function (association) {
                    return (_this.field.sourceCategory) ? (association.category === _this.field.sourceCategory) :
                        association.category === _this.field.code;
                }));
                return this.tempAssociation;
            }
            else {
                return this.field.terms;
            }
        }
        else {
            return this.field.terms;
        }
    };
    /**
     * @return {?}
     */
    TopicpickerComponent.prototype.getParentValue = /**
     * @return {?}
     */
    function () {
        return this.latestParentValue || _.compact(_.map(this.depends, 'value'));
    };
    TopicpickerComponent.decorators = [
        { type: Component, args: [{
                    selector: 'sb-topicpicker',
                    template: "<div class=\"treepicker-parent\">\n  <label *ngIf=\"label\">{{label}}</label>\n  <div [attr.disabled]=\"disabled ? true : ( depends ? (isDependsInvalid ? true : null) : null )\" id=\"treePicker\" class=\"topic-picker-selector_{{field.code}} cursor-pointer list-border\">\n  {{placeHolder}}\n  </div>\n\n  <input [attr.disabled]=\"disabled ? true : ( depends ? (isDependsInvalid ? true : null) : null )\" [formControl]=\"formControlRef\" [placeholder]=\"placeHolder\" readonly hidden/>\n  <ng-container *ngFor=\"let validation of validations\">\n    <div class=\"cf-error\"\n      *ngIf=\"(validation.type && (validation.type).toLowerCase() && validation.message && formControlRef.errors && formControlRef.errors[(validation.type).toLowerCase()] && (formControlRef.dirty || formControlRef.touched))\">\n      {{ validation.message }}\n    </div>\n  </ng-container>\n</div>\n",
                    styles: [".treepicker-parent{margin:1rem 0}label{display:block;font-size:1rem;margin:0}.topic-picker-selector{width:100%;padding:8px 16px;border:.5px solid #333;box-sizing:border-box}.cf-error{color:red;font-family:\"Noto Sans\";font-size:12px}.treepicker-parent .list-border{border:.5px solid var(--gray-400);padding:1.3rem;cursor:pointer;display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;left:0;height:40px}"]
                }] }
    ];
    /** @nocollapse */
    TopicpickerComponent.ctorParameters = function () { return []; };
    TopicpickerComponent.propDecorators = {
        selectedTopics: [{ type: Input }],
        topicPickerClass: [{ type: Input }],
        label: [{ type: Input }],
        disabled: [{ type: Input }],
        placeholder: [{ type: Input }],
        formControlRef: [{ type: Input }],
        field: [{ type: Input }],
        topicChange: [{ type: Output }],
        validations: [{ type: Input }],
        formGroup: [{ type: Input }],
        default: [{ type: Input }],
        depends: [{ type: Input }],
        dependencyTerms: [{ type: Input }]
    };
    return TopicpickerComponent;
}());
export { TopicpickerComponent };
if (false) {
    /** @type {?} */
    TopicpickerComponent.prototype.selectedTopics;
    /** @type {?} */
    TopicpickerComponent.prototype.topicPickerClass;
    /** @type {?} */
    TopicpickerComponent.prototype.label;
    /** @type {?} */
    TopicpickerComponent.prototype.disabled;
    /** @type {?} */
    TopicpickerComponent.prototype.placeholder;
    /** @type {?} */
    TopicpickerComponent.prototype.formControlRef;
    /** @type {?} */
    TopicpickerComponent.prototype.field;
    /** @type {?} */
    TopicpickerComponent.prototype.topicChange;
    /** @type {?} */
    TopicpickerComponent.prototype.validations;
    /** @type {?} */
    TopicpickerComponent.prototype.formGroup;
    /** @type {?} */
    TopicpickerComponent.prototype.default;
    /** @type {?} */
    TopicpickerComponent.prototype.depends;
    /** @type {?} */
    TopicpickerComponent.prototype.dependencyTerms;
    /** @type {?} */
    TopicpickerComponent.prototype.selectedNodes;
    /** @type {?} */
    TopicpickerComponent.prototype.placeHolder;
    /** @type {?} */
    TopicpickerComponent.prototype.isDependsInvalid;
    /**
     * @type {?}
     * @private
     */
    TopicpickerComponent.prototype.dispose$;
    /** @type {?} */
    TopicpickerComponent.prototype.latestParentValue;
    /** @type {?} */
    TopicpickerComponent.prototype.tempAssociation;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9waWNwaWNrZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vY29tbW9uLWZvcm0tZWxlbWVudHMvIiwic291cmNlcyI6WyJsaWIvdG9waWNwaWNrZXIvdG9waWNwaWNrZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBcUIsTUFBTSxFQUFpQixNQUFNLGVBQWUsQ0FBQztBQUN6RyxPQUFPLEVBQStCLE9BQU8sRUFBRSxLQUFLLEVBQVEsTUFBTSxNQUFNLENBQUM7QUFDekUsT0FBTyxLQUFLLENBQUMsTUFBTSxXQUFXLENBQUM7QUFDL0IsT0FBTyxFQUFFLFdBQVcsRUFBRyxTQUFTLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUV4RCxPQUFPLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDOzs7O0FBSWhELDRCQUtDOzs7SUFKQywyQkFBVzs7SUFDWCw2QkFBYTs7SUFDYixtQ0FBbUI7O0lBQ25CLDhCQUE0Qjs7Ozs7QUFFOUIscUJBRUM7Ozs7OztJQURDLHFEQUEwQjs7QUFJNUI7SUE2QkU7UUFmVSxnQkFBVyxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFNbEMsb0JBQWUsR0FBUyxFQUFFLENBQUM7UUFLNUIsYUFBUSxHQUFHLElBQUksT0FBTyxFQUFhLENBQUM7SUFJNUIsQ0FBQzs7OztJQUVqQix1Q0FBUTs7O0lBQVI7UUFBQSxpQkFnREM7UUE5Q0MsSUFBSSxDQUFDLGNBQWMsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUNuQyxHQUFHOzs7O1FBQUMsVUFBQSxHQUFHO1lBQ0wsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNuQixDQUFDLEVBQUMsRUFDRixTQUFTLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUN6QixDQUFDLFNBQVMsRUFBRSxDQUFDOztZQUNSLGNBQWMsR0FBRyxD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OztJQUV2Qix1Q0FBaUM7O0lBQ2pDLCtDQUFvQzs7SUFDcEMsNkNBQTBCOztJQUMxQiwyQ0FBMkI7O0lBRTNCLGdEQUE2Qjs7Ozs7SUFDN0Isd0NBQTRDOztJQUM1QyxpREFBMEI7O0lBQzFCLCtDQUFxQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT25EZXN0cm95LCBPbkluaXQsIE91dHB1dCwgQWZ0ZXJWaWV3SW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgU3Vic2NyaXB0aW9uLCBjb21iaW5lTGF0ZXN0LCBTdWJqZWN0LCBtZXJnZSwgZnJvbSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0ICogYXMgXyBmcm9tICdsb2Rhc2gtZXMnO1xuaW1wb3J0IHsgRm9ybUNvbnRyb2wgLCBGb3JtR3JvdXB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IEZpZWxkQ29uZmlnIH0gZnJvbSAnLi4vY29tbW9uLWZvcm0tY29uZmlnJztcbmltcG9ydCB7IHRhcCwgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5kZWNsYXJlIHZhciB0cmVlUGlja2VyOiBhbnk7XG5kZWNsYXJlIHZhciAkOiBhbnk7XG5pbnRlcmZhY2UgVG9waWNUcmVlTm9kZSB7XG4gIGlkOiBzdHJpbmc7XG4gIG5hbWU6IHN0cmluZztcbiAgc2VsZWN0YWJsZTogc3RyaW5nO1xuICBub2RlczogQXJyYXk8VG9waWNUcmVlTm9kZT47XG59XG5pbnRlcmZhY2UgSlF1ZXJ5IHtcbiAgdHJlZVBpY2tlcihvcHRpb25zPzogYW55KTtcbn1cblxuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdzYi10b3BpY3BpY2tlcicsXG4gIHRlbXBsYXRlVXJsOiAnLi90b3BpY3BpY2tlci5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3RvcGljcGlja2VyLmNvbXBvbmVudC5jc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBUb3BpY3BpY2tlckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95LCBBZnRlclZpZXdJbml0IHtcblxuICBASW5wdXQoKSBzZWxlY3RlZFRvcGljczogYW55O1xuICBASW5wdXQoKSB0b3BpY1BpY2tlckNsYXNzOiBzdHJpbmc7XG4gIEBJbnB1dCgpIGxhYmVsOiBTdHJpbmc7XG4gIEBJbnB1dCgpIGRpc2FibGVkPzogYm9vbGVhbjtcbiAgQElucHV0KCkgcGxhY2Vob2xkZXI6IFN0cmluZztcbiAgQElucHV0KCkgZm9ybUNvbnRyb2xSZWY6IEZvcm1Db250cm9sO1xuICBASW5wdXQoKSBmaWVsZDogRmllbGRDb25maWc8U3RyaW5nPjtcbiAgQE91dHB1dCgpIHRvcGljQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICBASW5wdXQoKSB2YWxpZGF0aW9ucz86IGFueTtcbiAgQElucHV0KCkgZm9ybUdyb3VwPzogRm9ybUdyb3VwO1xuICBASW5wdXQoKSBkZWZhdWx0PzogYW55O1xuXG4gIEBJbnB1dCgpIGRlcGVuZHM/OiBGb3JtQ29udHJvbFtdO1xuICBASW5wdXQoKSBkZXBlbmRlbmN5VGVybXM/OiBhbnkgPSBbXTtcbiAgcHVibGljIHNlbGVjdGVkTm9kZXM6IGFueTtcbiAgcHVibGljIHBsYWNlSG9sZGVyOiBzdHJpbmc7XG5cbiAgcHVibGljIGlzRGVwZW5kc0ludmFsaWQ6IGFueTtcbiAgcHJpdmF0ZSBkaXNwb3NlJCA9IG5ldyBTdWJqZWN0PHVuZGVmaW5lZD4oKTtcbiAgbGF0ZXN0UGFyZW50VmFsdWU6IHN0cmluZztcbiAgdGVtcEFzc29jaWF0aW9uOiBhbnk7XG5cbiAgY29uc3RydWN0b3IoKSB7IH1cblxuICBuZ09uSW5pdCgpIHtcblxuICAgIHRoaXMuZm9ybUNvbnRyb2xSZWYudmFsdWVDaGFuZ2VzLnBpcGUoXG4gICAgICB0YXAodmFsID0+IHtcbiAgICAgICAgY29uc29sZS5sb2codmFsKTtcbiAgICAgIH0pLFxuICAgICAgdGFrZVVudGlsKHRoaXMuZGlzcG9zZSQpXG4gICAgKS5zdWJzY3JpYmUoKTtcbiAgICBjb25zdCBzZWxlY3RlZFRvcGljcyA9IF8ucmVkdWNlKHRoaXMuZGVmYXVsdCwgKGNvbGxlY3RvciwgZWxlbWVudCkgPT4ge1xuICAgICAgaWYgKHR5cGVvZiBlbGVtZW50ID09PSAnc3RyaW5nJykge1xuICAgICAgICBjb2xsZWN0b3IudW5mb3JtYXR0ZWQucHVzaChlbGVtZW50KTtcbiAgICAgIH0gZWxzZSBpZiAoXy5nZXQoZWxlbWVudCwgJ2lkZW50aWZpZXInKSkge1xuICAgICAgICBjb2xsZWN0b3IuZm9ybWF0dGVkLnB1c2goZWxlbWVudCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gY29sbGVjdG9yO1xuICAgIH0sIHsgZm9ybWF0dGVkOiBbXSwgdW5mb3JtYXR0ZWQ6IFtdIH0pO1xuXG4gICAgdGhpcy5mb3JtYXRTZWxlY3RlZFRvcGljcyh0aGlzLmZpZWxkLnRlcm1zLCBzZWxlY3RlZFRvcGljcy51bmZvcm1hdHRlZCwgc2VsZWN0ZWRUb3BpY3MuZm9ybWF0dGVkKTtcbiAgICB0aGlzLmRlZmF1bHQgPSBzZWxlY3RlZFRvcGljcy51bmZvcm1hdHRlZDtcbiAgICB0aGlzLnNlbGVjdGVkTm9kZXMgPSB7IC4uLnNlbGVjdGVkVG9waWNzLmZvcm1hdHRlZCB9O1xuICAgIHRoaXMudG9waWNDaGFuZ2UuZW1pdCh0aGlzLnNlbGVjdGVkVG9waWNzKTtcblxuXG5cblxuICAgIGlmICghXy5pc0VtcHR5KHRoaXMuZGVmYXVsdCkpIHtcbiAgICAgIHRoaXMucGxhY2VIb2xkZXIgPSB0aGlzLmRlZmF1bHQgJiYgIHRoaXMuZGVmYXVsdC5sZW5ndGggKyAnIHRvcGljcyBzZWxlY3RlZCc7XG4gICAgICB0aGlzLmZvcm1Db250cm9sUmVmLnNldFZhbHVlKHRoaXMuZGVmYXVsdCk7XG4gICAgfVxuXG5cbiAgICBpZiAoIV8uaXNFbXB0eSh0aGlzLmRlcGVuZHMpKSB7XG4gICAgICBtZXJnZSguLi5fLm1hcCh0aGlzLmRlcGVuZHMsIGRlcGVuZCA9PiBkZXBlbmQudmFsdWVDaGFuZ2VzKSkucGlwZShcbiAgICAgICB0YXAoKHZhbHVlOiBhbnkpID0+IHtcbiAgICAgICAgIHRoaXMubGF0ZXN0UGFyZW50VmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgIHRoaXMuaXNEZXBlbmRzSW52YWxpZCA9IF8uaW5jbHVkZXMoXy5tYXAodGhpcy5kZXBlbmRzLCBkZXBlbmQgPT4gZGVwZW5kLmludmFsaWQpLCB0cnVlKTtcbiAgICAgICAgIHRoaXMuZm9ybUNvbnRyb2xSZWYucGF0Y2hWYWx1ZShudWxsKTtcbiAgICAgICAgIHRoaXMucGxhY2VIb2xkZXIgPSAnJztcbiAgICAgICAgIHRoaXMuZGVmYXVsdCA9IFtdO1xuICAgICAgICAgdGhpcy5zZWxlY3RlZE5vZGVzID0ge307XG4gICAgICAgICB0aGlzLmluaXRUb3BpY1BpY2tlcih0aGlzLmZvcm1hdFRvcGljcyh0aGlzLmZldGNoQXNzb2NpYXRpb25zKCkpKTtcbiAgICAgICB9KSxcbiAgICAgICB0YWtlVW50aWwodGhpcy5kaXNwb3NlJClcbiAgICAgICApLnN1YnNjcmliZSgpO1xuXG4gICAgICAgdGhpcy5pc0RlcGVuZHNJbnZhbGlkID0gXy5pbmNsdWRlcyhfLm1hcCh0aGlzLmRlcGVuZHMsIGRlcGVuZCA9PiBkZXBlbmQuaW52YWxpZCksIHRydWUpO1xuICAgICB9XG5cbiAgfVxuXG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTp1c2UtbGlmZS1jeWNsZS1pbnRlcmZhY2VcbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIHRoaXMuaW5pdFRvcGljUGlja2VyKHRoaXMuZm9ybWF0VG9waWNzKHRoaXMuZmllbGQudGVybXMpKTtcblxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy5kaXNwb3NlJC5uZXh0KG51bGwpO1xuICAgIHRoaXMuZGlzcG9zZSQuY29tcGxldGUoKTtcbiAgfVxuXG4gIHByaXZhdGUgZm9ybWF0VG9waWNzKHRvcGljcywgc3ViVG9waWMgPSBmYWxzZSk6IEFycmF5PFRvcGljVHJlZU5vZGU+IHtcbiAgICByZXR1cm4gXy5tYXAodG9waWNzLCAodG9waWMpID0+ICh7XG4gICAgICBpZDogdG9waWMuaWRlbnRpZmllcixcbiAgICAgIG5hbWU6IHRvcGljLm5hbWUsXG4gICAgICBzZWxlY3RhYmxlOiBzdWJUb3BpYyA/ICdzZWxlY3RhYmxlJyA6ICdub3RzZWxlY3RhYmxlJyxcbiAgICAgIG5vZGVzOiB0aGlzLmZvcm1hdFRvcGljcyh0b3BpYy5jaGlsZHJlbiwgdHJ1ZSlcbiAgICB9KSk7XG4gIH1cblxuICBwcml2YXRlIGZvcm1hdFNlbGVjdGVkVG9waWNzKHRvcGljcywgdW5mb3JtYXR0ZWQsIGZvcm1hdHRlZCkge1xuICAgIF8uZm9yRWFjaCh0b3BpY3MsICh0b3BpYykgPT4ge1xuICAgICAgaWYgKHVuZm9ybWF0dGVkLmluY2x1ZGVzKHRoaXMuZmllbGQub3V0cHV0ID8gdG9waWNbdGhpcy5maWVsZC5vdXRwdXRdIDogdG9waWMubmFtZSkgJiYgIXRvcGljLmNoaWxkcmVuKSB7XG4gICAgICAgIGZvcm1hdHRlZC5wdXNoKHtcbiAgICAgICAgICBpZGVudGlmaWVyOiB0b3BpYy5pZGVudGlmaWVyLFxuICAgICAgICAgIG5hbWU6IHRvcGljLm5hbWVcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBpZiAodG9waWMuY2hpbGRyZW4pIHtcbiAgICAgICAgdGhpcy5mb3JtYXRTZWxlY3RlZFRvcGljcyh0b3BpYy5jaGlsZHJlbiwgdW5mb3JtYXR0ZWQsIGZvcm1hdHRlZCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGluaXRUb3BpY1BpY2tlcihkYXRhOiBBcnJheTxUb3BpY1RyZWVOb2RlPikge1xuICAgICAgJChgLnRvcGljLXBpY2tlci1zZWxlY3Rvcl8ke3RoaXMuZmllbGQuY29kZX1gKS50cmVlUGlja2VyKHtcbiAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgbmFtZTogJ1RvcGljcycsXG4gICAgICAgIG5vRGF0YU1lc3NhZ2U6ICdub0RhdGFNZXNzYWdlJyxcbiAgICAgICAgc3VibWl0QnV0dG9uVGV4dDogJ0RvbmUnLFxuICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiAnQ2FuY2VsJyxcbiAgICAgICAgcmVtb3ZlQWxsVGV4dDogJ1JlbW92ZSBBbGwnLFxuICAgICAgICBjaG9vc2VBbGxUZXh0OiAnQ2hvb3NlIEFsbCcsXG4gICAgICAgIHNlYXJjaFRleHQ6ICdTZWFyY2gnLFxuICAgICAgICBzZWxlY3RlZFRleHQ6ICdzZWxlY3RlZCcsXG4gICAgICAgIHBpY2tlZDogKCFfLmlzRW1wdHkodGhpcy5zZWxlY3RlZE5vZGVzKSkgPyBfLm1hcCh0aGlzLnNlbGVjdGVkTm9kZXMsICdpZGVudGlmaWVyJykgOiAoIV8uaXNFbXB0eSh0aGlzLmRlZmF1bHQpID8gdGhpcy5kZWZhdWx0IDogW10pLFxuICAgICAgICBvblN1Ym1pdDogKHNlbGVjdGVkTm9kZXMpID0+IHtcbiAgICAgICAgICB0aGlzLnNlbGVjdGVkTm9kZXMgPSBzZWxlY3RlZE5vZGVzO1xuICAgICAgICAgIHRoaXMuc2VsZWN0ZWRUb3BpY3MgPSBfLm1hcChzZWxlY3RlZE5vZGVzLCBub2RlID0+ICh7XG4gICAgICAgICAgICBpZGVudGlmaWVyOiBub2RlLmlkLFxuICAgICAgICAgICAgbmFtZTogbm9kZS5uYW1lXG4gICAgICAgICAgfSkpO1xuICAgICAgICAgIHRoaXMucGxhY2VIb2xkZXIgPSB0aGlzLnNlbGVjdGVkVG9waWNzLmxlbmd0aCArICcgdG9waWNzIHNlbGVjdGVkJztcbiAgICAgICAgICB0aGlzLnRvcGljQ2hhbmdlLmVtaXQodGhpcy5zZWxlY3RlZFRvcGljcyk7XG4gICAgICAgICAgY29uc3QgdG9waWNzID0gW107XG4gICAgICAgICAgXy5mb3JFYWNoKHRoaXMuc2VsZWN0ZWRUb3BpY3MsICh2YWx1ZSwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLmZpZWxkLm91dHB1dCkge1xuICAgICAgICAgICAgIHRvcGljcy5wdXNoKHZhbHVlW3RoaXMuZmllbGQub3V0cHV0XSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0b3BpY3MucHVzaCh2YWx1ZS5uYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICB0aGlzLmZvcm1Db250cm9sUmVmLnNldFZhbHVlKHRvcGljcyk7XG4gICAgICAgIH0sXG4gICAgICAgIG5vZGVOYW1lOiBgdG9waWNTZWxlY3Rvcl8ke3RoaXMuZmllbGQuY29kZX1gLFxuICAgICAgICBkaXNwbGF5Rm9ybWF0OiBmdW5jdGlvbihwaWNrZWQpIHsgcmV0dXJuIHRoaXMucGxhY2VIb2xkZXI7IH0gLFxuICAgICAgICBtaW5TZWFyY2hRdWVyeUxlbmd0aDogMSxcbiAgICAgICAgZGlzYWJsZWQ6IChub2RlKSAgPT4ge1xuICAgICAgICAgIHJldHVybiB0aGlzLmRpc2FibGVkID8gdHJ1ZSA6ICggdGhpcy5kZXBlbmRzID8gKHRoaXMuaXNEZXBlbmRzSW52YWxpZCA/IHRydWUgOiBmYWxzZSkgOiBmYWxzZSApXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgc2V0VGltZW91dCgoKSA9PiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgdG9waWNTZWxlY3Rvcl8ke3RoaXMuZmllbGQuY29kZX1gKS5jbGFzc0xpc3QuYWRkKHRoaXMudG9waWNQaWNrZXJDbGFzcyksIDApO1xuICB9XG5cbiAgZmV0Y2hBc3NvY2lhdGlvbnMoKSB7XG4gICAgLy8gJiYgdGhpcy5jb250ZXh0LnZhbHVlICYmIHRoaXMuZmllbGQuYXNzb2NpYXRpb25cbiAgICBpZiAoIV8uaXNFbXB0eSh0aGlzLmRlcGVuZHMpKSB7XG4gICAgICBjb25zdCBmaWx0ZXJlZFRlcm0gPSBfLmZpbmQodGhpcy5kZXBlbmRlbmN5VGVybXMsIHRlcm1zID0+IHtcbiAgICAgICAgcmV0dXJuICFfLmlzRW1wdHkodGhpcy5maWVsZC5vdXRwdXQpID8gXy5pbmNsdWRlcyh0aGlzLmdldFBhcmVudFZhbHVlKCksIHRlcm1zW3RoaXMuZmllbGQub3V0cHV0XSkgOlxuICAgICAgICAgXy5pbmNsdWRlcyh0aGlzLmdldFBhcmVudFZhbHVlKCksIHRlcm1zLm5hbWUpIDtcbiAgICAgIH0pO1xuICAgICAgaWYgKGZpbHRlcmVkVGVybSkge1xuICAgICAgICB0aGlzLnRlbXBBc3NvY2lhdGlvbiA9ICBfLmZpbHRlcihmaWx0ZXJlZFRlcm0uYXNzb2NpYXRpb25zLCBhc3NvY2lhdGlvbiA9PiB7XG4gICAgICAgICAgcmV0dXJuICh0aGlzLmZpZWxkLnNvdXJjZUNhdGVnb3J5KSA/IChhc3NvY2lhdGlvbi5jYXRlZ29yeSA9PT0gdGhpcy5maWVsZC5zb3VyY2VDYXRlZ29yeSkgOlxuICAgICAgICAgICBhc3NvY2lhdGlvbi5jYXRlZ29yeSA9PT0gdGhpcy5maWVsZC5jb2RlO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudGVtcEFzc29jaWF0aW9uO1xuICAgICAgfSBlbHNlICB7XG4gICAgICAgIHJldHVybiB0aGlzLmZpZWxkLnRlcm1zO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy5maWVsZC50ZXJtcztcbiAgICB9XG4gIH1cblxuICBnZXRQYXJlbnRWYWx1ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5sYXRlc3RQYXJlbnRWYWx1ZSB8fCBfLmNvbXBhY3QoXy5tYXAodGhpcy5kZXBlbmRzLCAndmFsdWUnKSk7XG4gIH1cblxufVxuIl19