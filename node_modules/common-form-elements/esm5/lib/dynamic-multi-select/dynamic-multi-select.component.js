/**
 * @fileoverview added by tsickle
 * Generated from: lib/dynamic-multi-select/dynamic-multi-select.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input, Output, EventEmitter } from '@angular/core';
import { FormControl, FormGroup } from '@angular/forms';
import { Subject, merge } from 'rxjs';
import { tap } from 'rxjs/operators';
import * as _ from 'lodash-es';
import { ValueComparator } from '../utilities/value-comparator';
var DynamicMultiSelectComponent = /** @class */ (function () {
    function DynamicMultiSelectComponent() {
        this.ValueComparator = ValueComparator;
        this.onChangeFilter = new EventEmitter();
        this.dependencyTerms = [];
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    DynamicMultiSelectComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        var _this = this;
        if (!this.options) {
            this.options = [];
        }
        if (this.isOptionsClosure(this.options)) {
            this.options$ = (/** @type {?} */ (((/** @type {?} */ (this.options)))(this.formControlRef, this.depends, this.formGroup, (/**
             * @return {?}
             */
            function () { return _this.dataLoadStatusDelegate.next('LOADING'); }), (/**
             * @return {?}
             */
            function () { return _this.dataLoadStatusDelegate.next('LOADED'); }))));
        }
    };
    /**
     * @return {?}
     */
    DynamicMultiSelectComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        // if (this.context) {
        // this.contextValueChangesSubscription = this.context.valueChanges.pipe(
        //   tap(() => {
        //     this.formControlRef.patchValue(null);
        //   })
        // ).subscribe();
        // }
        var _this = this;
        this.dataLoadStatusDelegate.subscribe(console.log);
        if (this.field && this.field.range) {
            this.options = this.field.range;
        }
        if (!_.isEmpty(this.depends) && !this.isOptionsClosure(this.options)) {
            this.contextValueChangesSubscription = merge.apply(void 0, tslib_1.__spread(_.map(this.depends, (/**
             * @param {?} depend
             * @return {?}
             */
            function (depend) { return depend.valueChanges; })))).pipe(tap((/**
             * @param {?} value
             * @return {?}
             */
            function (value) {
                _this.latestParentValue = value;
            }))).subscribe();
        }
        if (!_.isEmpty(this.field.depends)) {
            merge.apply(void 0, tslib_1.__spread(_.map(this.depends, (/**
             * @param {?} depend
             * @return {?}
             */
            function (depend) { return depend.valueChanges; })))).pipe(tap((/**
             * @return {?}
             */
            function () {
                // _.forEach(this.field.depends, depend => {
                //   if (!_.isEmpty(this.formGroup.get(depend))) {
                //     this.formGroup.get(depend).patchValue(null);
                //   }
                // });
                _this.formControlRef.patchValue(null);
            }))).subscribe();
        }
        if (this.isOptionsClosure(this.options)) {
            // tslint:disable-next-line:max-line-length
            this.options$ = (/** @type {?} */ (((/** @type {?} */ (this.options)))(this.formControlRef, this.depends, this.formGroup, (/**
             * @return {?}
             */
            function () { return _this.dataLoadStatusDelegate.next('LOADING'); }), (/**
             * @return {?}
             */
            function () { return _this.dataLoadStatusDelegate.next('LOADED'); }))));
        }
    };
    /**
     * @return {?}
     */
    DynamicMultiSelectComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this.contextValueChangesSubscription) {
            this.contextValueChangesSubscription.unsubscribe();
        }
    };
    /**
     * @param {?} options
     * @return {?}
     */
    DynamicMultiSelectComponent.prototype.isOptionsArray = /**
     * @param {?} options
     * @return {?}
     */
    function (options) {
        return Array.isArray(options);
    };
    /**
     * @param {?} options
     * @return {?}
     */
    DynamicMultiSelectComponent.prototype.isOptionsClosure = /**
     * @param {?} options
     * @return {?}
     */
    function (options) {
        return typeof options === 'function';
    };
    /**
     * @param {?} input
     * @return {?}
     */
    DynamicMultiSelectComponent.prototype.isOptionsMap = /**
     * @param {?} input
     * @return {?}
     */
    function (input) {
        return !Array.isArray(input) && typeof input === 'object';
    };
    /**
     * @param {?} input
     * @return {?}
     */
    DynamicMultiSelectComponent.prototype.isOptionsArrayMap = /**
     * @param {?} input
     * @return {?}
     */
    function (input) {
        return Array.isArray(input) && typeof input[0] === 'object';
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    DynamicMultiSelectComponent.prototype.onChangeFacet = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        /** @type {?} */
        var selectedObject = this.options.data[$event.currentTarget.options.selectedIndex - 1];
        /** @type {?} */
        var emitPayload = JSON.parse(JSON.stringify(this.options));
        emitPayload['data'] = selectedObject;
        emitPayload['selectedLabel'] = selectedObject.label;
        emitPayload['selectedValue'] = selectedObject.value;
        this.onChangeFilter.emit(emitPayload);
    };
    /**
     * @return {?}
     */
    DynamicMultiSelectComponent.prototype.fetchAssociations = /**
     * @return {?}
     */
    function () {
        var _this = this;
        // && this.context.value && this.field.association
        if (!_.isEmpty(this.depends)) {
            /** @type {?} */
            var filteredTerm = _.find(this.dependencyTerms, (/**
             * @param {?} terms
             * @return {?}
             */
            function (terms) {
                return _.includes(_this.getParentValue(), terms.identifier);
            }));
            if (filteredTerm) {
                this.tempAssociation = _.filter(filteredTerm.associations, (/**
                 * @param {?} association
                 * @return {?}
                 */
                function (association) {
                    return association.category === _this.field.code;
                }));
                return this.tempAssociation;
            }
            else {
                return this.options;
            }
        }
        else {
            return this.options;
        }
    };
    /**
     * @return {?}
     */
    DynamicMultiSelectComponent.prototype.getParentValue = /**
     * @return {?}
     */
    function () {
        return this.latestParentValue || _.compact(_.map(this.depends, 'value'));
    };
    DynamicMultiSelectComponent.decorators = [
        { type: Component, args: [{
                    selector: 'sb-dynamic-multi-select',
                    template: "<div class=\"sb-dropdown\" *ngIf=\"!type\">\n  <label>{{label}} {{context && 'has context'}}  {{context ?  field.context : '' }}</label>\n  <ng-container *ngIf=\"options\">\n    <div class=\"dropdown-container\">\n      <sb-icon-dropdown class=\"dropdown-icon\"></sb-icon-dropdown>\n      <!-- [attr.disabled]=\"disabled ? true : ( context ? (context.invalid ? true : null) : null )\" -->\n      <select [formControl]=\"formControlRef\"\n              [compareWith]=\"ValueComparator.valueComparator\" class=\"sb-dropdown-select\" id=\"sb-dropdown\"\n              name=\"sb-dropdown\" multiple>\n        <option [defaultSelected]=\"!default\" [ngValue]=\"null\" disabled>{{placeHolder}}\n        </option>\n        <ng-container *ngIf=\"field.range && isOptionsArrayMap(field.range) && !field.association\">\n          <option class=\"optionsArrayMap\" *ngFor=\"let option of field.range\" [ngValue]=\"option.value\">{{option.label}}</option>\n        </ng-container>\n        <ng-container *ngIf=\"field.range && isOptionsArray(field.range) && !isOptionsArrayMap(field.range) && !field.association\">\n          <option class=\"optionsArray\" *ngFor=\"let option of field.range\" [ngValue]=\"option || option\">{{option.name || option}}</option>\n        </ng-container>\n\n        <ng-container *ngIf=\"field.range && isOptionsClosure(field.range)\">\n          <option class=\"closure\" *ngFor=\"let option of options$ | async\" [ngValue]=\"option.value\">{{option.label}}</option>\n        </ng-container>\n\n        <!-- <ng-container *ngIf=\"isOptionsMap(options) && context && context.value && !field.association\">\n          <option *ngFor=\"let option of options[context.value]\" [ngValue]=\"option.value\">{{option.label}}</option>\n        </ng-container> -->\n\n        <ng-container *ngIf=\"!field.range && field.terms\">\n          <option class=\"optionsLast\" *ngFor=\"let option of fetchAssociations()\" [ngValue]=\"option.identifier\">{{option.name}}</option>\n        </ng-container>\n      </select>\n    </div>\n  </ng-container>\n</div>\n\n<!-- Dropdown for filters component -->\n<div class=\"sb-dropdown\" *ngIf=\"type === 'facet'\">\n  <label>{{label}}</label>\n  <ng-container *ngIf=\"options && options.data\">\n    <div class=\"dropdown-container\">\n      <sb-icon-dropdown class=\"dropdown-icon\"></sb-icon-dropdown>\n      <select [attr.disabled]=\"disabled ? true : ( context ? (context.invalid ? true : null) : null )\"\n        class=\"sb-dropdown-select\" [ngClass]=\"(styleClass ? styleClass : 'default-dropdown')\" id=\"sb-dropdown\" name=\"sb-dropdown\"\n        (change)=\"onChangeFacet($event)\" placeholder=\"placeHolder\">\n        <option *ngIf=\"!default\" [disabled]=\"true\" selected>{{placeHolder}}</option>\n        <option *ngFor=\"let option of options.data\" [ngValue]=\"option\" [selected]=\"options.default === option.value\">{{option.label}}</option>\n      </select>\n    </div>\n  </ng-container>\n</div>\n<ng-container *ngFor=\"let validation of validations\">\n  <div class=\"cf-error\"\n    *ngIf=\"(validation.type && (validation.type).toLowerCase() && validation.message && formControlRef.errors && formControlRef.errors[(validation.type).toLowerCase()] && (formControlRef.dirty || formControlRef.touched))\">\n    {{ validation.message }}\n  </div>\n</ng-container>\n\n<!-- Dropdown for filters component -->\n",
                    styles: ["label{display:block;padding:10px;font-size:1rem}.dropdown-icon{position:absolute;top:.5rem;right:18px;z-index:1}.dropdown-container{position:relative}select[disabled]{opacity:.3}select{-webkit-appearance:none;-moz-appearance:none;text-indent:1px;text-overflow:''}.sb-dropdown-select{opacity:.99;color:#333;font-family:\"Noto Sans\";font-size:12px;font-weight:700;letter-spacing:0;line-height:17px}.sb-dropdown{margin-bottom:8px}.placeholder select option:first-child{color:#999}.option-default{color:#333;font-weight:700;font-size:12px}.sb-dropdown select{background-color:#fff;padding:10px 20px;font-size:14px;width:100%;border:.5px solid #333}.cf-error{color:red;font-family:\"Noto Sans\";font-size:12px}"]
                }] }
    ];
    /** @nocollapse */
    DynamicMultiSelectComponent.ctorParameters = function () { return []; };
    DynamicMultiSelectComponent.propDecorators = {
        field: [{ type: Input }],
        disabled: [{ type: Input }],
        options: [{ type: Input }],
        label: [{ type: Input }],
        placeHolder: [{ type: Input }],
        isMultiple: [{ type: Input }],
        context: [{ type: Input }],
        contextTerms: [{ type: Input }],
        formControlRef: [{ type: Input }],
        formGroup: [{ type: Input }],
        default: [{ type: Input }],
        contextData: [{ type: Input }],
        dataLoadStatusDelegate: [{ type: Input }],
        type: [{ type: Input }],
        styleClass: [{ type: Input }],
        onChangeFilter: [{ type: Output }],
        validations: [{ type: Input }],
        depends: [{ type: Input }],
        dependencyTerms: [{ type: Input }]
    };
    return DynamicMultiSelectComponent;
}());
export { DynamicMultiSelectComponent };
if (false) {
    /** @type {?} */
    DynamicMultiSelectComponent.prototype.ValueComparator;
    /** @type {?} */
    DynamicMultiSelectComponent.prototype.field;
    /** @type {?} */
    DynamicMultiSelectComponent.prototype.disabled;
    /** @type {?} */
    DynamicMultiSelectComponent.prototype.options;
    /** @type {?} */
    DynamicMultiSelectComponent.prototype.label;
    /** @type {?} */
    DynamicMultiSelectComponent.prototype.placeHolder;
    /** @type {?} */
    DynamicMultiSelectComponent.prototype.isMultiple;
    /** @type {?} */
    DynamicMultiSelectComponent.prototype.context;
    /** @type {?} */
    DynamicMultiSelectComponent.prototype.contextTerms;
    /** @type {?} */
    DynamicMultiSelectComponent.prototype.formControlRef;
    /** @type {?} */
    DynamicMultiSelectComponent.prototype.formGroup;
    /** @type {?} */
    DynamicMultiSelectComponent.prototype.default;
    /** @type {?} */
    DynamicMultiSelectComponent.prototype.contextData;
    /** @type {?} */
    DynamicMultiSelectComponent.prototype.dataLoadStatusDelegate;
    /** @type {?} */
    DynamicMultiSelectComponent.prototype.type;
    /** @type {?} */
    DynamicMultiSelectComponent.prototype.styleClass;
    /** @type {?} */
    DynamicMultiSelectComponent.prototype.onChangeFilter;
    /** @type {?} */
    DynamicMultiSelectComponent.prototype.validations;
    /** @type {?} */
    DynamicMultiSelectComponent.prototype.depends;
    /** @type {?} */
    DynamicMultiSelectComponent.prototype.dependencyTerms;
    /** @type {?} */
    DynamicMultiSelectComponent.prototype.options$;
    /** @type {?} */
    DynamicMultiSelectComponent.prototype.contextValueChangesSubscription;
    /** @type {?} */
    DynamicMultiSelectComponent.prototype.selectedType;
    /** @type {?} */
    DynamicMultiSelectComponent.prototype.tempAssociation;
    /** @type {?} */
    DynamicMultiSelectComponent.prototype.latestParentValue;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHluYW1pYy1tdWx0aS1zZWxlY3QuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vY29tbW9uLWZvcm0tZWxlbWVudHMvIiwic291cmNlcyI6WyJsaWIvZHluYW1pYy1tdWx0aS1zZWxlY3QvZHluYW1pYy1tdWx0aS1zZWxlY3QuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLE9BQU8sRUFBQyxTQUFTLEVBQUUsS0FBSyxFQUFnQyxNQUFNLEVBQWlCLFlBQVksRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUNsSCxPQUFPLEVBQUMsV0FBVyxFQUFFLFNBQVMsRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBQ3RELE9BQU8sRUFBYSxPQUFPLEVBQStCLEtBQUssRUFBQyxNQUFNLE1BQU0sQ0FBQztBQUU3RSxPQUFPLEVBQUMsR0FBRyxFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFDbkMsT0FBTyxLQUFLLENBQUMsTUFBTSxXQUFXLENBQUM7QUFDL0IsT0FBTyxFQUFDLGVBQWUsRUFBQyxNQUFNLCtCQUErQixDQUFDO0FBQzlEO0lBaUNFO1FBM0JBLG9CQUFlLEdBQUcsZUFBZSxDQUFDO1FBZ0J4QixtQkFBYyxHQUFzQixJQUFJLFlBQVksRUFBRSxDQUFDO1FBSXhELG9CQUFlLEdBQVMsRUFBRSxDQUFDO0lBUXBDLENBQUM7Ozs7O0lBRUQsaURBQVc7Ozs7SUFBWCxVQUFZLE9BQXNCO1FBQWxDLGlCQWFDO1FBWkMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDakIsSUFBSSxDQUFDLE9BQU8sR0FBRyxFQUFFLENBQUM7U0FDbkI7UUFDRCxJQUFJLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEVBQUU7WUFDdkMsSUFBSSxDQUFDLFFBQVEsR0FBRyxtQkFBQSxDQUFDLG1CQUFBLElBQUksQ0FBQyxPQUFPLEVBQXlDLENBQUMsQ0FDckUsSUFBSSxDQUFDLGNBQWMsRUFDbkIsSUFBSSxDQUFD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QUM7Q0FBQSxBQTNKRCxJQTJKQztTQXRKWSwyQkFBMkI7OztJQUN0QyxzREFBa0M7O0lBQ2xDLDRDQUFvQzs7SUFDcEMsK0NBQTRCOztJQUM1Qiw4Q0FBc0I7O0lBQ3RCLDRDQUF3Qjs7SUFDeEIsa0RBQThCOztJQUM5QixpREFBOEI7O0lBQzlCLDhDQUErQjs7SUFDL0IsbURBQTRCOztJQUM1QixxREFBc0M7O0lBQ3RDLGdEQUErQjs7SUFDL0IsOENBQXVCOztJQUN2QixrREFBMEI7O0lBQzFCLDZEQUErRDs7SUFDL0QsMkNBQXVCOztJQUN2QixpREFBNkI7O0lBQzdCLHFEQUFpRTs7SUFDakUsa0RBQTJCOztJQUUzQiw4Q0FBaUM7O0lBQ2pDLHNEQUFvQzs7SUFFcEMsK0NBQWdEOztJQUNoRCxzRUFBK0M7O0lBQy9DLG1EQUFrQjs7SUFDbEIsc0RBQXFCOztJQUNyQix3REFBMEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NvbXBvbmVudCwgSW5wdXQsIE9uQ2hhbmdlcywgT25EZXN0cm95LCBPbkluaXQsIE91dHB1dCwgU2ltcGxlQ2hhbmdlcywgRXZlbnRFbWl0dGVyfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7Rm9ybUNvbnRyb2wsIEZvcm1Hcm91cH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHtPYnNlcnZhYmxlLCBTdWJqZWN0LCBTdWJzY3JpcHRpb24sIGNvbWJpbmVMYXRlc3QsIG1lcmdlfSBmcm9tICdyeGpzJztcbmltcG9ydCB7RmllbGRDb25maWcsIEZpZWxkQ29uZmlnT3B0aW9uLCBGaWVsZENvbmZpZ09wdGlvbnNCdWlsZGVyLCBEeW5hbWljRmllbGRDb25maWdPcHRpb25zQnVpbGRlcn0gZnJvbSAnLi4vY29tbW9uLWZvcm0tY29uZmlnJztcbmltcG9ydCB7dGFwfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgKiBhcyBfIGZyb20gJ2xvZGFzaC1lcyc7XG5pbXBvcnQge1ZhbHVlQ29tcGFyYXRvcn0gZnJvbSAnLi4vdXRpbGl0aWVzL3ZhbHVlLWNvbXBhcmF0b3InO1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnc2ItZHluYW1pYy1tdWx0aS1zZWxlY3QnLFxuICB0ZW1wbGF0ZVVybDogJy4vZHluYW1pYy1tdWx0aS1zZWxlY3QuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9keW5hbWljLW11bHRpLXNlbGVjdC5jb21wb25lbnQuY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgRHluYW1pY011bHRpU2VsZWN0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSB7XG4gIFZhbHVlQ29tcGFyYXRvciA9IFZhbHVlQ29tcGFyYXRvcjtcbiAgQElucHV0KCkgZmllbGQ6IEZpZWxkQ29uZmlnPFN0cmluZz47XG4gIEBJbnB1dCgpIGRpc2FibGVkPzogYm9vbGVhbjtcbiAgQElucHV0KCkgb3B0aW9uczogYW55O1xuICBASW5wdXQoKSBsYWJlbD86IHN0cmluZztcbiAgQElucHV0KCkgcGxhY2VIb2xkZXI/OiBzdHJpbmc7XG4gIEBJbnB1dCgpIGlzTXVsdGlwbGU/OiBib29sZWFuO1xuICBASW5wdXQoKSBjb250ZXh0PzogRm9ybUNvbnRyb2w7XG4gIEBJbnB1dCgpIGNvbnRleHRUZXJtcz86IGFueTtcbiAgQElucHV0KCkgZm9ybUNvbnRyb2xSZWY/OiBGb3JtQ29udHJvbDtcbiAgQElucHV0KCkgZm9ybUdyb3VwPzogRm9ybUdyb3VwO1xuICBASW5wdXQoKSBkZWZhdWx0PzogYW55O1xuICBASW5wdXQoKSBjb250ZXh0RGF0YTogYW55O1xuICBASW5wdXQoKSBkYXRhTG9hZFN0YXR1c0RlbGVnYXRlOiBTdWJqZWN0PCdMT0FESU5HJyB8ICdMT0FERUQnPjtcbiAgQElucHV0KCkgdHlwZT86IHN0cmluZztcbiAgQElucHV0KCkgc3R5bGVDbGFzcz86IHN0cmluZztcbiAgQE91dHB1dCgpIG9uQ2hhbmdlRmlsdGVyOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgQElucHV0KCkgdmFsaWRhdGlvbnM/OiBhbnk7XG5cbiAgQElucHV0KCkgZGVwZW5kcz86IEZvcm1Db250cm9sW107XG4gIEBJbnB1dCgpIGRlcGVuZGVuY3lUZXJtcz86IGFueSA9IFtdO1xuXG4gIG9wdGlvbnMkPzogT2JzZXJ2YWJsZTxGaWVsZENvbmZpZ09wdGlvbjxhbnk+W10+O1xuICBjb250ZXh0VmFsdWVDaGFuZ2VzU3Vic2NyaXB0aW9uPzogU3Vic2NyaXB0aW9uO1xuICBzZWxlY3RlZFR5cGU6IGFueTtcbiAgdGVtcEFzc29jaWF0aW9uOiBhbnk7XG4gIGxhdGVzdFBhcmVudFZhbHVlOiBzdHJpbmc7XG4gIGNvbnN0cnVjdG9yKCkge1xuICB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuICAgIGlmICghdGhpcy5vcHRpb25zKSB7XG4gICAgICB0aGlzLm9wdGlvbnMgPSBbXTtcbiAgICB9XG4gICAgaWYgKHRoaXMuaXNPcHRpb25zQ2xvc3VyZSh0aGlzLm9wdGlvbnMpKSB7XG4gICAgICB0aGlzLm9wdGlvbnMkID0gKHRoaXMub3B0aW9ucyBhcyBEeW5hbWljRmllbGRDb25maWdPcHRpb25zQnVpbGRlcjxhbnk+KShcbiAgICAgICAgdGhpcy5mb3JtQ29udHJvbFJlZixcbiAgICAgICAgdGhpcy5kZXBlbmRzLFxuICAgICAgICB0aGlzLmZvcm1Hcm91cCxcbiAgICAgICAgKCkgPT4gdGhpcy5kYXRhTG9hZFN0YXR1c0RlbGVnYXRlLm5leHQoJ0xPQURJTkcnKSxcbiAgICAgICAgKCkgPT4gdGhpcy5kYXRhTG9hZFN0YXR1c0RlbGVnYXRlLm5leHQoJ0xPQURFRCcpXG4gICAgICApIGFzIGFueTtcbiAgICB9XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICAvLyBpZiAodGhpcy5jb250ZXh0KSB7XG4gICAgICAvLyB0aGlzLmNvbnRleHRWYWx1ZUNoYW5nZXNTdWJzY3JpcHRpb24gPSB0aGlzLmNvbnRleHQudmFsdWVDaGFuZ2VzLnBpcGUoXG4gICAgICAvLyAgIHRhcCgoKSA9PiB7XG4gICAgICAvLyAgICAgdGhpcy5mb3JtQ29udHJvbFJlZi5wYXRjaFZhbHVlKG51bGwpO1xuICAgICAgLy8gICB9KVxuICAgICAgLy8gKS5zdWJzY3JpYmUoKTtcbiAgICAvLyB9XG5cbiAgICB0aGlzLmRhdGFMb2FkU3RhdHVzRGVsZWdhdGUuc3Vic2NyaWJlKFxuICAgICAgY29uc29sZS5sb2dcbiAgICApO1xuXG4gICAgaWYgKHRoaXMuZmllbGQgJiYgdGhpcy5maWVsZC5yYW5nZSkge1xuICAgICAgdGhpcy5vcHRpb25zID0gdGhpcy5maWVsZC5yYW5nZTtcbiAgICB9XG5cblxuICAgIGlmICghXy5pc0VtcHR5KHRoaXMuZGVwZW5kcykgJiYgIXRoaXMuaXNPcHRpb25zQ2xvc3VyZSh0aGlzLm9wdGlvbnMpKSB7XG4gICAgIHRoaXMuY29udGV4dFZhbHVlQ2hhbmdlc1N1YnNjcmlwdGlvbiA9ICBtZXJnZSguLi5fLm1hcCh0aGlzLmRlcGVuZHMsIGRlcGVuZCA9PiBkZXBlbmQudmFsdWVDaGFuZ2VzKSkucGlwZShcbiAgICAgIHRhcCgodmFsdWU6IGFueSkgPT4ge1xuICAgICAgICB0aGlzLmxhdGVzdFBhcmVudFZhbHVlID0gdmFsdWU7XG4gICAgICB9KVxuICAgICAgKS5zdWJzY3JpYmUoKTtcbiAgICB9XG5cbiAgICBpZiAoIV8uaXNFbXB0eSh0aGlzLmZpZWxkLmRlcGVuZHMpKSB7XG4gICAgICBtZXJnZSguLi5fLm1hcCh0aGlzLmRlcGVuZHMsIGRlcGVuZCA9PiBkZXBlbmQudmFsdWVDaGFuZ2VzKSkucGlwZShcbiAgICAgICAgICB0YXAoKCkgPT4ge1xuICAgICAgICAgICAgLy8gXy5mb3JFYWNoKHRoaXMuZmllbGQuZGVwZW5kcywgZGVwZW5kID0+IHtcbiAgICAgICAgICAgIC8vICAgaWYgKCFfLmlzRW1wdHkodGhpcy5mb3JtR3JvdXAuZ2V0KGRlcGVuZCkpKSB7XG4gICAgICAgICAgICAvLyAgICAgdGhpcy5mb3JtR3JvdXAuZ2V0KGRlcGVuZCkucGF0Y2hWYWx1ZShudWxsKTtcbiAgICAgICAgICAgIC8vICAgfVxuICAgICAgICAgICAgLy8gfSk7XG4gICAgICAgICAgICB0aGlzLmZvcm1Db250cm9sUmVmLnBhdGNoVmFsdWUobnVsbCk7XG4gICAgICAgICAgfSlcbiAgICAgICkuc3Vic2NyaWJlKCk7XG4gICAgfVxuXG5cbiAgICBpZiAodGhpcy5pc09wdGlvbnNDbG9zdXJlKHRoaXMub3B0aW9ucykpIHtcbiAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTptYXgtbGluZS1sZW5ndGhcbiAgICAgIHRoaXMub3B0aW9ucyQgPSAodGhpcy5vcHRpb25zIGFzIER5bmFtaWNGaWVsZENvbmZpZ09wdGlvbnNCdWlsZGVyPGFueT4pKHRoaXMuZm9ybUNvbnRyb2xSZWYsIHRoaXMuZGVwZW5kcywgdGhpcy5mb3JtR3JvdXAsICgpID0+IHRoaXMuZGF0YUxvYWRTdGF0dXNEZWxlZ2F0ZS5uZXh0KCdMT0FESU5HJyksICgpID0+IHRoaXMuZGF0YUxvYWRTdGF0dXNEZWxlZ2F0ZS5uZXh0KCdMT0FERUQnKSkgYXMgYW55O1xuICAgIH1cblxuXG5cbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmNvbnRleHRWYWx1ZUNoYW5nZXNTdWJzY3JpcHRpb24pIHtcbiAgICAgIHRoaXMuY29udGV4dFZhbHVlQ2hhbmdlc1N1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgIH1cbiAgfVxuXG4gIGlzT3B0aW9uc0FycmF5KG9wdGlvbnM6IGFueSkge1xuICAgIHJldHVybiBBcnJheS5pc0FycmF5KG9wdGlvbnMpO1xuXG4gIH1cblxuICBpc09wdGlvbnNDbG9zdXJlKG9wdGlvbnM6IGFueSkge1xuICAgIHJldHVybiB0eXBlb2Ygb3B0aW9ucyA9PT0gJ2Z1bmN0aW9uJztcbiAgfVxuXG4gIGlzT3B0aW9uc01hcChpbnB1dDogYW55KSB7XG4gICAgcmV0dXJuICFBcnJheS5pc0FycmF5KGlucHV0KSAmJiB0eXBlb2YgaW5wdXQgPT09ICdvYmplY3QnO1xuICB9XG5cbiAgaXNPcHRpb25zQXJyYXlNYXAoaW5wdXQ6IGFueSkge1xuICAgIHJldHVybiBBcnJheS5pc0FycmF5KGlucHV0KSAmJiB0eXBlb2YgaW5wdXRbMF0gPT09ICdvYmplY3QnO1xuICB9XG5cbiAgb25DaGFuZ2VGYWNldCgkZXZlbnQpIHtcbiAgICBjb25zdCBzZWxlY3RlZE9iamVjdCA9IHRoaXMub3B0aW9ucy5kYXRhWyRldmVudC5jdXJyZW50VGFyZ2V0Lm9wdGlvbnMuc2VsZWN0ZWRJbmRleCAtIDFdO1xuICAgIGNvbnN0IGVtaXRQYXlsb2FkID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLm9wdGlvbnMpKTtcbiAgICBlbWl0UGF5bG9hZFsnZGF0YSddID0gc2VsZWN0ZWRPYmplY3Q7XG4gICAgZW1pdFBheWxvYWRbJ3NlbGVjdGVkTGFiZWwnXSA9IHNlbGVjdGVkT2JqZWN0LmxhYmVsO1xuICAgIGVtaXRQYXlsb2FkWydzZWxlY3RlZFZhbHVlJ10gPSBzZWxlY3RlZE9iamVjdC52YWx1ZTtcbiAgICB0aGlzLm9uQ2hhbmdlRmlsdGVyLmVtaXQoZW1pdFBheWxvYWQpO1xuICB9XG5cbiAgZmV0Y2hBc3NvY2lhdGlvbnMoKSB7XG4gICAgLy8gJiYgdGhpcy5jb250ZXh0LnZhbHVlICYmIHRoaXMuZmllbGQuYXNzb2NpYXRpb25cbiAgICBpZiAoIV8uaXNFbXB0eSh0aGlzLmRlcGVuZHMpKSB7XG4gICAgICBjb25zdCBmaWx0ZXJlZFRlcm0gPSBfLmZpbmQodGhpcy5kZXBlbmRlbmN5VGVybXMsIHRlcm1zID0+IHtcbiAgICAgICAgcmV0dXJuIF8uaW5jbHVkZXModGhpcy5nZXRQYXJlbnRWYWx1ZSgpLCB0ZXJtcy5pZGVudGlmaWVyKTtcbiAgICAgIH0pO1xuICAgICAgaWYgKGZpbHRlcmVkVGVybSkge1xuICAgICAgICB0aGlzLnRlbXBBc3NvY2lhdGlvbiA9ICBfLmZpbHRlcihmaWx0ZXJlZFRlcm0uYXNzb2NpYXRpb25zLCBhc3NvY2lhdGlvbiA9PiB7XG4gICAgICAgICAgcmV0dXJuIGFzc29jaWF0aW9uLmNhdGVnb3J5ID09PSB0aGlzLmZpZWxkLmNvZGU7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50ZW1wQXNzb2NpYXRpb247XG4gICAgICB9IGVsc2UgIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucztcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucztcbiAgICB9XG4gIH1cblxuXG4gIGdldFBhcmVudFZhbHVlKCkge1xuICAgIHJldHVybiB0aGlzLmxhdGVzdFBhcmVudFZhbHVlIHx8IF8uY29tcGFjdChfLm1hcCh0aGlzLmRlcGVuZHMsICd2YWx1ZScpKTtcbiAgfVxufVxuIl19