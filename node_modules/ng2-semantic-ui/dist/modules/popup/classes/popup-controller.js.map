{"version":3,"file":"popup-controller.js","sourceRoot":"","sources":["../../../../src/modules/popup/classes/popup-controller.ts"],"names":[],"mappings":"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","sourcesContent":["import { ComponentRef, ElementRef, HostListener, OnDestroy, Renderer2 } from \"@angular/core\";\nimport { SuiComponentFactory } from \"../../../misc/util/index\";\nimport { PopupConfig, PopupTrigger, IPopupConfig } from \"./popup-config\";\nimport { SuiPopup } from \"../components/popup\";\nimport { IPopupLifecycle } from \"./popup-lifecycle\";\n\nexport interface IPopup {\n    open():void;\n    close():void;\n    toggle():void;\n}\n\nexport abstract class SuiPopupController implements IPopup, OnDestroy {\n    // Stores reference to generated popup component.\n    private _componentRef:ComponentRef<SuiPopup>;\n\n    // Returns generated popup instance.\n    public get popup():SuiPopup {\n        // Use non-null assertion as we only access this when a popup exists.\n        return this._componentRef.instance;\n    }\n\n    // `setTimeout` timer pointer for delayed popup open.\n    private _openingTimeout:number;\n\n    // Function to remove the document click handler.\n    private _documentListener:() => void;\n\n    constructor(renderer:Renderer2,\n                protected _element:ElementRef,\n                protected _componentFactory:SuiComponentFactory,\n                config:PopupConfig) {\n\n        // Generate a new SuiPopup component and attach it to the application view.\n        this._componentRef = this._componentFactory.createComponent(SuiPopup);\n\n        // Configure popup with provided config.\n        this.popup.config = config;\n\n        // When the popup is closed (onClose fires on animation complete),\n        this.popup.onClose.subscribe(() => this.cleanup());\n\n        this._documentListener = renderer.listen(\"document\", \"click\", (e:MouseEvent) => this.onDocumentClick(e));\n    }\n\n    public configure(config?:IPopupConfig):void {\n        if (config) {\n            Object.assign(this.popup.config, config);\n        }\n    }\n\n    public openDelayed():void {\n        // Cancel the opening timer.\n        clearTimeout(this._openingTimeout);\n\n        // Start the popup opening after the specified delay interval.\n        this._openingTimeout = window.setTimeout(() => this.open(), this.popup.config.delay);\n    }\n\n    public open():void {\n        // Attach the generated component to the current application.\n        this._componentFactory.attachToApplication(this._componentRef);\n\n        // Move the generated element to the body to avoid any positioning issues.\n        this._componentFactory.moveToDocumentBody(this._componentRef);\n\n        // Attach a reference to the anchor element. We do it here because IE11 loves to complain.\n        this.popup.anchor = this._element;\n\n        // Start popup open transition.\n        this.popup.open();\n\n        // Call lifecyle hook\n        const lifecycle = (this as IPopupLifecycle).popupOnOpen;\n        if (lifecycle) {\n            lifecycle.call(this);\n        }\n    }\n\n    public close():void {\n        // Cancel the opening timer to stop the popup opening after close has been called.\n        clearTimeout(this._openingTimeout);\n\n        if (this._componentRef) {\n            // Start popup close transition.\n            this.popup.close();\n        }\n\n        // Call lifecyle hook\n        const lifecycle = (this as IPopupLifecycle).popupOnClose;\n        if (lifecycle) {\n            lifecycle.call(this);\n        }\n    }\n\n    public toggleDelayed():void {\n        // If the popup hasn't been created, or it has but it isn't currently open, open the popup.\n        if (!this._componentRef || (this._componentRef && !this.popup.isOpen)) {\n            return this.openDelayed();\n        }\n\n        // O'wise, close it.\n        return this.close();\n    }\n\n    public toggle():void {\n        // If the popup hasn't been created, or it has but it isn't currently open, open the popup.\n        if (!this._componentRef || (this._componentRef && !this.popup.isOpen)) {\n            return this.open();\n        }\n\n        // O'wise, close it.\n        return this.close();\n    }\n\n    @HostListener(\"mouseenter\")\n    private onMouseEnter():void {\n        if (this.popup.config.trigger === PopupTrigger.Hover) {\n            this.openDelayed();\n        }\n    }\n\n    @HostListener(\"mouseleave\")\n    private onMouseLeave():void {\n        if (this.popup.config.trigger === PopupTrigger.Hover) {\n            this.close();\n        }\n    }\n\n    @HostListener(\"click\")\n    private onClick():void {\n        if (this.popup.config.trigger === PopupTrigger.Click ||\n            this.popup.config.trigger === PopupTrigger.OutsideClick) {\n\n            // Repeated clicks require a toggle, rather than just opening the popup each time.\n            this.toggleDelayed();\n        } else if (this.popup.config.trigger === PopupTrigger.Focus &&\n                   (!this._componentRef || (this._componentRef && !this.popup.isOpen))) {\n            // Repeated clicks with a focus trigger requires an open (as focus isn't ever lost on repeated click).\n            this.openDelayed();\n        }\n    }\n\n    public onDocumentClick(e:MouseEvent):void {\n        // If the popup trigger is outside click,\n        if (this._componentRef && this.popup.config.trigger === PopupTrigger.OutsideClick) {\n            const target = e.target as Element;\n            // Close the popup if the click is outside of the popup element.\n            if (!(this._element.nativeElement as Element).contains(target)) {\n                this.close();\n            }\n        }\n    }\n\n    @HostListener(\"focusin\")\n    private onFocusIn():void {\n        if (this.popup.config.trigger === PopupTrigger.Focus) {\n            this.openDelayed();\n        }\n    }\n\n    @HostListener(\"focusout\", [\"$event\"])\n    private onFocusOut(e:any):void {\n        if (!this._element.nativeElement.contains(e.relatedTarget) &&\n            !this.popup.elementRef.nativeElement.contains(e.relatedTarget) &&\n            this.popup.config.trigger === PopupTrigger.Focus) {\n\n            this.close();\n        }\n    }\n\n    protected cleanup():void {\n        clearTimeout(this._openingTimeout);\n\n        if (this._componentRef.instance && this._componentRef.instance.positioningService) {\n            this._componentRef.instance.positioningService.destroy();\n        }\n\n        this._componentFactory.detachFromApplication(this._componentRef);\n    }\n\n    public ngOnDestroy():void {\n        this.cleanup();\n\n        this._documentListener();\n    }\n}\n"]}